{"version":3,"sources":["webpack:///src/app/routes/data/data-connection/dialog-handler/dialog-handler.component.html","webpack:///src/app/routes/data/data-connection/dialog-handler/dialog-handler.component.ts","webpack:///src/app/routes/data/data-connection/data-connection.component.html","webpack:///src/app/routes/data/data-connection/data-connection.component.ts","webpack:///src/app/routes/data/data-set/data-set-dialog/data-set-dialog.component.html","webpack:///src/app/routes/data/data-set/data-set-dialog/data-set-dialog.component.ts","webpack:///src/app/routes/data/data-set/data-set.component.html","webpack:///src/app/routes/data/data-set/data-set.component.ts","webpack:///src/app/routes/data/data-flow/data-flow.service.ts","webpack:///src/app/routes/data/data-flow/data-flow-stepper/data-flow-stepper.component.html","webpack:///src/app/routes/data/data-flow/data-flow-stepper/data-flow-stepper.component.ts","webpack:///src/app/routes/data/data-flow/data-flow.component.html","webpack:///src/app/routes/data/data-flow/data-flow.component.ts","webpack:///src/app/routes/data/data-connection/file-upload-form/file-upload-form.component.html","webpack:///src/app/routes/data/data-connection/file-upload-form/file-upload-form.component.ts","webpack:///src/app/routes/data/data-connection/database-form/database-form.component.html","webpack:///src/app/routes/data/data-connection/database-form/database-form.component.ts","webpack:///src/app/routes/data/data-connection/sftp-and-url-form/sftp-and-url-form.component.html","webpack:///src/app/routes/data/data-connection/sftp-and-url-form/sftp-and-url-form.component.ts","webpack:///src/app/routes/data/data.module.ts"],"names":["DialogHandlerComponent","dialogData","_fb","_data","_toaster","dialogRef","_localStorage","_utils","renderer","_snackbar","proConnectionList","enterpriseConnectionList","connectionsToRestrict","allConnectionsList","allowedNoOfRows","allowedNoOfColumns","appType","environment","color","mode","diameter","exportProjectDiameter","showSpinner","isEdit","showConnectionTypes","this","user","getItem","psFeatures","fileUploadForm","group","name","required","dataGroupForm","pattern","parentId","project","formType","formUIHandler","dialogHeading","roles","includes","setRestrictions","allowedConnectionsList","sourceType","prefillDataGroupForm","data","allowedConnectionList","filter","item","val","dataGroupData","connectionIdToUpdate","_id","patchValue","get","setValue","currentDataGroup","reset","formValue","updateDataGroupHandler","createDataGroupHandler","reqObj","dataConnection$","updateDataGroup","subscribe","res","success","closeModal","err","error","projectId","createNewDataGroup","type","formHeading","iconType","open","horizontalPosition","verticalPosition","close","unsubscribe","swal","DataConnectionComponent","_spinner","_dialog","_schedular","_window","_snackBar","_socket","_sampleDataset","dataSource","filesDataSource","pageSizeOptions","displayedColumns","displayedColumnsFiles","unsubscribe$","Subject","tempArray","breadcrumbArray","breadArray","dataListArray","isDataFlowFailed","count","callFromStartFlow","flowIdCheck","dataFlowToolTip","urlFlowPlayBtnToolTip","planType","percentDone","allowedFeaturesList","value","paginator","sort","initSocket","getAllConnectionsData","getDataGroupList","getAllSampleDatasets","schedularList","getAllDatasets","pipe","takeUntil","allSampleDatasets","filterSampleDatasets","a","b","Date","createdAt","valueOf","stopSpinner","e","message","fileName","uploadFile","encoding","dataGroupId","dataList","dataFolderName","parentFolderName","file","uploadType","resp","datasetDialog","showSnackBar","fileUpload","dismissSnackBar","dataFilterArray","length","dataGroupsList","datagroupList","connectionsList","connection","rawFilesList","filesdata","filesData","pklfilesdata","concat","temp","Object","keys","filesFilter","datagroup_id","parentFolderData","fArr","_updateChangeSubscription","snackBarRef","getDataGroupsList","getSchedularsList","schedularArray","datasetModal","minWidth","maxWidth","dataGroups","schedulars","afterClosed","pullData","selectedConnToPull","map","doc","isPulling","pullSingleData","serverBaseUrl","id","deleteRawFile","deleteDataConnetion","deleteDataGroup","connId","title","text","icon","buttons","cancel","visible","className","confirm","then","isConfirm","filteredFiles","dataId","rFiles","pFiles","t","push","filterDataGroup","undefined","find","docs","datagroup","dataconnection","rawFiles","files","deleteDataConnection","toUpperCase","connectionFilesTemplate","isDataFlowPresent","dataflowId","isDeleted","height","width","fileData","executeDataFlow","dataGroupDetails","isChanged","index","findIndex","splice","d","i","callRecursive","event","tableName","filterValue","target","trim","toLowerCase","firstPage","listen","status","parsed","info","removeListener","next","Window","breadcrumbHandler","openDatasetModal","openModalHandler","DataSetDialogComponent","_dataSetDialogRef","resizeEvent","joinTypeArray","showPreview","showReport","showMergeForm","dataSetList","mergeType","mergeForm","selectedDataset","joinType","nullValidator","commonColumn","columnsToMerge","modalHeading","console","log","previewData","listAllProjectFileList","columnDefs","myFileData","pid","key","preview","headerName","field","gridOptions","headerHeight","defaultColDef","resizable","previewrowData","getAllProjectFileList","parentFile","dataSetId","mergeDataSet","avalialbleColumnsToMerge","fileSchema","commonColumns","colName","setValidators","updateValueAndValidity","clearValidators","originalFilePath","filename","mergeFilePath","parentDatasetTasks","tasks","mergeDatasetTasks","api","setDomLayout","gridApi","setColumnDefs","setRowData","refreshCells","force","DataSetComponent","_report","_sanitizer","getDataSetList","dataListArrayId","getAllProjectDatas","dataGroupList","filesList","fileSource","content","document","createElement","innerHTML","deleteDataSet","columns","openDialog","minHeight","maxHeight","moduleName","edaReportData","DataFlowService","_http","flowData","post","flowId","delete","put","startDate","endDate","DataFlowStepperComponent","_formBuilder","_dataFlow","_router","closeNodeRed","flowFormGroup","flowName","scheduleId","prefillFlowDetails","flowIdToEdit","flowURL","bypassSecurityTrustResourceUrl","stepper","navigateByUrl","emit","isCanceled","findOneFlow","window","frames","contentDocument","getElementsByClassName","iframe","$","btn_deploy","contents","urlString","contentWindow","location","href","position","lastIndexOf","substring","click","alert","flowType","connectionID","updateFlow","createNewFlow","flowResponse","getSingleFlow","closeStepperHandler","onSubmitFlow","$event","moment","DataFlowComponent","_activatedRoute","logsDataSource","logsDisplayedColumns","showStepper","hideDialog","dateRange","directFlowNameCheck","queryParams","connectionId","dataFlowId","dateGroup","start","end","getFlowsList","subtract","getAllFlowsList","uddFlowsList","schedularsList","getNodeRedLogs","selectedFlow","errorLogsTemplate","getErrorLogs","utc","format","errorLogs","inputFlowData","deleteFlow","navigate","err_msg","FileUploadFormComponent","_connectionDialogRef","goBackFlag","allowedPSFileUploadSize","selectFolder","inputFile","ext","split","pop","size","fileToUpload","createConnection","parentFolder","UploadProgress","Math","round","loaded","total","handleFileInput","goBack","DatabaseFormComponent","_connection","hidePassword","dbConnectionForm","connectionName","database","query","parent_id","dataGroupName","validator","validateQuery","getRequiredConnectionList","prefillConnectionForm","dbConns","getConnectionsList","toPromise","getDbConnectionList","source","connectionData","getSingleDataConnection","connectionDetails","databaseConnectionId","databaseName","updateConnectionHandler","createConnectionHandler","formData","statusData","scheduledata","dataschedule","oldScheduleId","updateDataConnection","folderName","selectedFolder","queryString","str","setErrors","queryInvalid","connection$","onSubmitConnection","SftpAndUrlFormComponent","options","mouse","contextMenu","tree","node","preventDefault","dblClick","TOGGLE_EXPANDED","shiftKey","TOGGLE_ACTIVE_MULTI","TOGGLE_ACTIVE","ENTER","sftpFileTypes","urlSources","treeControl","children","showSftpSpinner","nodesArray","dataFormat","s3BucketsArray","nodes","hasChild","_","s3Form","bucket","fileExtension","bucketFolderPath","sftpForm","folderpath","urlForm","filetype","url","dynamicForm","sftpGroup","urlGroup","s3Group","s3Conns","sftpConns","getSftpConnectionList","label","expanded","lastword","src","finalRec","m","selectedPath","replace","conn","getSFTPFolders","sftpDetails","urlDetails","s3Details","sftpConnectionId","folderPath","s3ConnectionId","getS3Buckets","getS3BucketsList","isArray","buckets","conId","sftpId","getSftpFolderDetails","slice","toString","join","updateSftpConnection","updateUrlConnection","updateS3Connection","mapSchedular","schedularChanged","routes","path","component","DataModule","withComponents","forChild","F"],"mappings":"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","file":"x","sourcesContent":["<!-- HEADERS (title) -->\n<h2 *ngIf=\"dialogData.formType === 'dataSource' && showConnectionTypes\" mat-dialog-title>\n  {{ dialogHeading }}\n</h2>\n<h2 *ngIf=\"dialogData.formType === 'dataSource' && !showConnectionTypes\" mat-dialog-title>\n  {{ isEdit ? 'Update Connection' : 'Connection' }}\n</h2>\n<h2 *ngIf=\"dialogData.formType === 'dataGroup' || !dialogData.formType\" mat-dialog-title>\n  {{ isEdit ? 'Update folder' : 'Create folder' }}\n</h2>\n\n<!-- BODY (Data sources) -->\n<mat-dialog-content\n  *ngIf=\"dialogData.formType === 'dataSource' && showConnectionTypes\"\n  class=\"data-sources-container\"\n>\n  <legend style=\"font-size: 20px; margin-top: 10px\">\n    <span [matTooltip]=\"_utils.getTootip('dataSources')\"\n      ><em class=\"far fa-folder\" style=\"margin-right: 15px\"></em>\n      Choose any data source\n    </span>\n    <!-- <small class=\"linkText\" style=\"float: right; font-size: 16px; cursor: pointer\"\n      ><i class=\"fas fa-file-export\"></i>\n      <a\n        target=\"_blank\"\n        href=\"../../../../assets/sample-dataset.zip\"\n        style=\"color: inherit !important\"\n        download=\"sample-dataset.zip\"\n      >\n        Get sample datasets\n      </a>\n    </small> -->\n  </legend>\n  <hr />\n  <!-- CARDS -->\n  <div class=\"row m-1\">\n    <!--Upload file-->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('upload')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        (click)=\"formUIHandler('upload')\"\n        [matTooltip]=\"_utils.getTootip('fileUpload')\"\n        #fileUploadCard\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/icons/upload.svg\"\n              alt=\"File Upload\"\n              style=\"height: 25px\"\n            />\n            <mat-icon\n              id=\"upload\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('upload')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('upload') &&\n                enterpriseConnectionList.includes('upload')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">Upload</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Upload local files (.csv, .pkl, .xlsx)</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n    <!-- this is the icon badges logic -->\n    <!-- <mat-icon\n      id=\"upload\"\n      [ngClass]=\"\n        connectionsToRestrict?.includes('upload')? 'material-icons-outlined pro-flag'\n          : 'd-none'\n      \"\n      [innerText]=\"\n        connectionsToRestrict?.includes('upload') &&\n        enterpriseConnectionList.includes('upload')? 'browser_updated'\n          : 'workspace_premium'\n      \"\n    ></mat-icon> -->\n    <!--Pull data from URL-->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('url')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        (click)=\"formUIHandler('url')\"\n        [matTooltip]=\"_utils.getTootip('pullUrl')\"\n        #pullUrlCard\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/icons/url.svg\"\n              alt=\"URl Upload\"\n              style=\"height: 25px\"\n            />\n            <mat-icon\n              id=\"url\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('url')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('url') && enterpriseConnectionList.includes('url')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">URL</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Pull data from an open URL</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- MS SQL data -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('mssql')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        (click)=\"formUIHandler('mssql')\"\n        [matTooltip]=\"_utils.getTootip('msSql')\"\n        #mssqlCard\n      >\n        <mat-card-content class=\"text-center\">\n          <div class=\"text-right mb-2\">\n            <span class=\"text-muted text-sm\">ver-2019</span>\n          </div>\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/icons/mssql.svg\"\n              alt=\"MSSQL Upload\"\n              style=\"height: 50px\"\n            />\n            <mat-icon\n              id=\"mssql\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('mssql')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('mssql') &&\n                enterpriseConnectionList.includes('mssql')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">MS-SQL</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Query data from mssql</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- My SQL data -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('mysql')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        (click)=\"formUIHandler('mysql')\"\n        [matTooltip]=\"_utils.getTootip('mySql')\"\n        #mysqlCard\n      >\n        <mat-card-content class=\"text-center\">\n          <div class=\"text-right mb-2\">\n            <span class=\"text-muted text-sm\">ver-8.0.27</span>\n          </div>\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/icons/mysql.svg\"\n              alt=\"MYSQL Upload\"\n              style=\"height: 32px\"\n            />\n            <mat-icon\n              id=\"mysql\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('mysql')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('mysql') &&\n                enterpriseConnectionList.includes('mysql')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">MySQL</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Query data from mysql</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- PostgreSQL data -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('postgresql')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        (click)=\"formUIHandler('postgresql')\"\n        [matTooltip]=\"_utils.getTootip('postgre')\"\n        #postgreSqlCard\n      >\n        <mat-card-content class=\"text-center\">\n          <div class=\"text-right mb-2\">\n            <span class=\"text-muted text-sm\">ver-14.1</span>\n          </div>\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/icons/postgresql.svg\"\n              alt=\"PostgreSQL Upload\"\n              style=\"height: 45px\"\n            />\n            <mat-icon\n              id=\"postgresql\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('postgresql')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('postgresql') &&\n                enterpriseConnectionList.includes('postgresql')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">PostgreSQL</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Query data from postgresql</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- SFTP data -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('sftp')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        (click)=\"formUIHandler('sftp')\"\n        [matTooltip]=\"_utils.getTootip('Sftp')\"\n        #sftpCard\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/icons/sftp.svg\"\n              alt=\"SFTP Upload\"\n              style=\"height: 50px\"\n            />\n            <mat-icon\n              id=\"sftp\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('sftp')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('sftp') && enterpriseConnectionList.includes('sftp')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">SFTP</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Pull from SFTP server</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- SNOWFLAKE -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('snowflake')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        [matTooltip]=\"_utils.getTootip('snowflake')\"\n        (click)=\"formUIHandler('snowflake')\"\n        #snowflakeCard\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img src=\"../../../../../assets/img/snow.png\" alt=\"snowflake\" style=\"height: 70px\" />\n            <mat-icon\n              id=\"snowflake\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('snowflake')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('snowflake') &&\n                enterpriseConnectionList.includes('snowflake')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">Snowflake</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Pull from data cloud</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- AMAZON S3 -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('s3')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        [matTooltip]=\"_utils.getTootip('s3')\"\n        (click)=\"formUIHandler('s3')\"\n        #s3Card\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img src=\"../../../../../assets/img/s3.svg\" alt=\"s3\" style=\"height: 70px\" />\n            <mat-icon\n              id=\"s3\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('s3')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('s3') && enterpriseConnectionList.includes('s3')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">Amazon S3</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Pull from cloud object storage</p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n\n    <!-- BIG QUERY -->\n    <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('bigquery')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        [matTooltip]=\"_utils.getTootip('bigquery')\"\n        (click)=\"formUIHandler('bigquery')\"\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/bigquery.png\"\n              alt=\"bigquery\"\n              style=\"height: 70px\"\n            />\n            <mat-icon\n              id=\"s3\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('bigquery')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('bigquery') &&\n                enterpriseConnectionList.includes('bigquery')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">Google BigQuery</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">\n            Runs query from multicloud data warehouse\n          </p>\n        </mat-card-content>\n      </mat-card>\n    </div>\n    <!-- SAP -->\n    <!-- <div class=\"col-md-4\">\n      <mat-card\n        class=\"source-type-card\"\n        style=\"pointer-events: none\"\n        [matTooltip]=\"_utils.getTootip('saphana')\"\n        #sftpCard\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img src=\"../../../../../assets/img/sap1.svg\" alt=\"saphana\" style=\"height: 43px\" />\n          </picture>\n          <h4 style=\"margin-top: 10px\">SAP S/4HANA</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Coming soon...</p>\n        </mat-card-content>\n      </mat-card>\n    </div> -->\n\n    <!-- IOTSENSE -->\n    <!-- <div class=\"col-md-4\">\n      <mat-card\n        [ngClass]=\"\n          connectionsToRestrict?.includes('iotsense')\n            ? 'source-type-card pro-restrict'\n            : 'source-type-card'\n        \"\n        style=\"pointer-events: none\"\n        [matTooltip]=\"_utils.getTootip('iotsense')\"\n        #sftpCard\n      >\n        <mat-card-content class=\"text-center\">\n          <br />\n          <picture class=\"img-thumbnail circle thumb96\"\n            ><img\n              src=\"../../../../../assets/img/iotsense.svg\"\n              alt=\"iotsense\"\n              style=\"height: 45px\"\n            />\n            <mat-icon\n              id=\"iotsense\"\n              [ngClass]=\"\n                connectionsToRestrict?.includes('iotsense')\n                  ? 'material-icons-outlined pro-flag'\n                  : 'd-none'\n              \"\n              [innerText]=\"\n                connectionsToRestrict?.includes('iotsense') &&\n                enterpriseConnectionList.includes('iotsense')\n                  ? 'ENT'\n                  : 'PRO'\n              \"\n            ></mat-icon>\n          </picture>\n          <h4 style=\"margin-top: 10px\">IoTSense</h4>\n          <p class=\"text-muted\" style=\"margin-top: 16px\">Coming soon...</p>\n        </mat-card-content>\n      </mat-card>\n    </div> -->\n  </div>\n</mat-dialog-content>\n\n<!-- BODY (forms) -->\n<mat-dialog-content\n  *ngIf=\"dialogData.formType === 'dataSource' && !showConnectionTypes\"\n  class=\"connection-form\"\n>\n  <h4 *ngIf=\"!isEdit\" class=\"d-flex align-items-center mt-3 font-weight-normal\">\n    <picture class=\"mr-3 img-thumbnail circle thumb96\">\n      <img [src]=\"iconType\" [alt]=\"sourceType\" [style]=\"getHeadingIconSize()\" />\n    </picture>\n    {{ formHeading }}\n  </h4>\n  <hr *ngIf=\"!isEdit\" />\n  <!-- File upload form selector -->\n  <div class=\"mt-4\" *ngIf=\"sourceType === 'upload'\">\n    <app-file-upload-form\n      (goBackFlag)=\"showConnectionTypes = $event\"\n      [dataGroupsArray]=\"dialogData.dataGroups\"\n      [currentDataGroup]=\"dialogData.currentDataGroup\"\n    ></app-file-upload-form>\n  </div>\n  <!-- Databases (MYSQL, PGSQL, MSSQL), SNOWFLAKE, BIGQUERY form selector -->\n  <div\n    class=\"mt-4\"\n    *ngIf=\"\n      sourceType === 'mysql' ||\n      sourceType === 'mssql' ||\n      sourceType === 'postgresql' ||\n      sourceType === 'snowflake' ||\n      sourceType === 'bigquery'\n    \"\n  >\n    <app-database-form\n      (goBackFlag)=\"showConnectionTypes = $event\"\n      [dataGroupsArray]=\"dialogData.dataGroups\"\n      [schedularsArray]=\"dialogData.schedulars\"\n      [sourceType]=\"sourceType\"\n      [data]=\"dialogData.data\"\n      [currentDataGroup]=\"dialogData.currentDataGroup\"\n    ></app-database-form>\n  </div>\n  <!-- SFTP, URL, S3 form selector -->\n  <div class=\"mt-4\" *ngIf=\"sourceType === 'sftp' || sourceType === 'url' || sourceType === 's3'\">\n    <app-sftp-and-url-form\n      (goBackFlag)=\"showConnectionTypes = $event\"\n      [dataGroupsArray]=\"dialogData.dataGroups\"\n      [schedularsArray]=\"dialogData.schedulars\"\n      [sourceType]=\"sourceType\"\n      [data]=\"dialogData.data\"\n      [currentDataGroup]=\"dialogData.currentDataGroup\"\n    ></app-sftp-and-url-form>\n  </div>\n</mat-dialog-content>\n\n<!-- BODY (data group) -->\n<mat-dialog-content\n  *ngIf=\"dialogData.formType === 'dataGroup' || !dialogData.formType\"\n  class=\"mat-typography\"\n>\n  <mat-progress-spinner\n    *ngIf=\"showSpinner\"\n    class=\"spinner\"\n    [color]=\"color\"\n    [mode]=\"mode\"\n    [diameter]=\"diameter\"\n  >\n  </mat-progress-spinner>\n  <form [formGroup]=\"dataGroupForm\" role=\"form\" class=\"form-validate\" name=\"dataGroupForm\">\n    <!-- Folder name input -->\n    <div class=\"form-group\">\n      <mat-form-field appearance=\"outline\">\n        <mat-label for=\"name\">Folder name</mat-label>\n        <input\n          matInput\n          type=\"text\"\n          name=\"name\"\n          formControlName=\"name\"\n          id=\"name\"\n          placeholder=\"Enter folder name\"\n          autocomplete\n          required\n        />\n        <mat-error\n          *ngIf=\"\n            dataGroupForm.get('name').hasError('required') &&\n            (dataGroupForm.get('name').dirty || dataGroupForm.get('name').touched)\n          \"\n          >Folder name is required.</mat-error\n        >\n        <mat-error *ngIf=\"dataGroupForm.get('name').hasError('pattern')\"\n          >Only alphanumeric characters are allowed.\n        </mat-error>\n      </mat-form-field>\n    </div>\n\n    <!-- Select parent folder name -->\n    <div class=\"form-group\">\n      <mat-form-field appearance=\"outline\">\n        <mat-label>Select parent folder</mat-label>\n        <mat-select formControlName=\"parentId\" required>\n          <mat-option *ngFor=\"let folder of dialogData.dataGroups\" [value]=\"folder._id\">{{\n            folder.name\n          }}</mat-option>\n        </mat-select>\n        <mat-error\n          *ngIf=\"\n            dataGroupForm.get('parentId').hasError('required') &&\n            (dataGroupForm.get('parentId').dirty || dataGroupForm.get('parentId').touched)\n          \"\n          >Parent name is required.</mat-error\n        >\n      </mat-form-field>\n    </div>\n  </form>\n</mat-dialog-content>\n\n<!-- DIVIDERS -->\n<hr *ngIf=\"dialogData.formType === 'dataGroup' || !dialogData.formType\" />\n<hr *ngIf=\"dialogData.formType === 'dataSource' && showConnectionTypes\" />\n\n<!-- FOOTER -->\n<!-- BUTTONS (data sources) -->\n<mat-dialog-actions\n  *ngIf=\"dialogData.formType === 'dataSource' && showConnectionTypes\"\n  class=\"justify-content-end m-auto\"\n>\n  <button mat-stroked-button mat-dialog-close>Cancel</button>\n</mat-dialog-actions>\n<!-- BUTTONS (data group) -->\n<mat-dialog-actions\n  *ngIf=\"dialogData.formType === 'dataGroup' || !dialogData.formType\"\n  class=\"justify-content-end m-auto\"\n>\n  <button mat-stroked-button (click)=\"closeModal()\">Cancel</button>\n  <button\n    mat-flat-button\n    [disabled]=\"dataGroupForm.invalid\"\n    class=\"btn-primary\"\n    type=\"submit\"\n    (click)=\"onSubmitDataGroup(dataGroupForm.value)\"\n  >\n    {{ isEdit ? 'Update' : 'Create' }}\n  </button>\n</mat-dialog-actions>\n","import { Component, ElementRef, Inject, OnInit, Renderer2, ViewChild } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ThemePalette } from '@angular/material/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subscription } from 'rxjs';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { UtilsService } from 'src/app/shared/utils.service';\nimport { DataService } from '../../data.service';\nimport { DataConnectionComponent } from '../data-connection.component';\nimport { environment } from 'src/environments/environment';\n\n@Component({\n  selector: 'app-dialog-handler',\n  templateUrl: './dialog-handler.component.html',\n  styleUrls: ['./dialog-handler.component.scss'],\n})\nexport class DialogHandlerComponent implements OnInit {\n  // list of the available connection labels\n  proConnectionList: Array<string> = null;\n  enterpriseConnectionList: Array<string> = null;\n  connectionsToRestrict: Array<string> = null;\n  allConnectionsList: Array<string> = null;\n\n  // saas variables\n  allowedNoOfRows: number = 0;\n  allowedNoOfColumns: number = 0;\n  appType: string = environment.appType;\n\n  /** Progress spinner settings */\n  color: ThemePalette = 'primary';\n  mode: ProgressSpinnerMode = 'indeterminate';\n  diameter = 100;\n  exportProjectDiameter = 50;\n\n  /** Form Groups */\n  fileUploadForm: FormGroup;\n  dataGroupForm: FormGroup;\n\n  /** Subscription variables */\n  dataConnection$: Subscription;\n\n  showSpinner: boolean = false;\n  isEdit: boolean = false;\n  connectionIdToUpdate: string;\n  showConnectionTypes: boolean = true;\n  formHeading: string;\n  iconType: string;\n  sourceType: string;\n  project: any;\n  dialogHeading: string;\n  user: any;\n\n  constructor(\n    @Inject(MAT_DIALOG_DATA) public dialogData: any,\n    _fb: FormBuilder,\n    private _data: DataService,\n    private _toaster: ToastrService,\n    private dialogRef: MatDialogRef<DataConnectionComponent>,\n    private _localStorage: LocalStorageService,\n    public _utils: UtilsService,\n    private renderer: Renderer2,\n    private _snackbar: MatSnackBar\n  ) {\n    this.user = this._localStorage.getItem('user');\n    this.enterpriseConnectionList = this.user?.psFeatures?.enterpriseConnectionList || [];\n    this.allConnectionsList = this.user?.psFeatures?.allConnectionsList || [];\n    this.allowedNoOfColumns = this.user?.psFeatures?.allowedNoOfColumns;\n    this.allowedNoOfRows = this.user?.psFeatures?.allowedNoOfRows;\n    /** Form instances */\n    this.fileUploadForm = _fb.group({\n      name: ['', Validators.required],\n    });\n    this.dataGroupForm = _fb.group({\n      name: ['', [Validators.required, Validators.pattern('^[^\\\\s][A-Za-z0-9_ ]+$')]],\n      parentId: ['', Validators.required],\n    });\n  }\n\n  ngOnInit(): void {\n    this.project = this._localStorage.getItem('project');\n    this.dialogData.formType != 'dataSource' && this.formUIHandler(this.dialogData.formType);\n    switch (this.dialogData.formType) {\n      case 'dataSource':\n        this.dialogHeading = 'Data Source';\n        this.showConnectionTypes = true;\n        // init functions for the data connection dialog.\n        // console.log(\n        //   \"this is connection data : \",\n        //   this.dialogData?.allowedConnectionsList\n        // );\n        environment.appType === 'saas' &&\n          !this.user?.roles?.includes('super_admin') &&\n          !this.user?.roles?.includes('admin') &&\n          this.setRestrictions(this.dialogData?.allowedConnectionsList);\n        break;\n      case 'mysql':\n      case 'mssql':\n      case 'postgresql':\n      case 'sftp':\n      case 'url':\n      case 's3':\n      case 'snowflake':\n      case 'bigquery':\n        this.sourceType = this.dialogData.formType;\n        this.dialogData.formType = 'dataSource';\n        this.showConnectionTypes = false;\n      case 'dataGroup':\n        this.showConnectionTypes = false;\n        this.prefillDataGroupForm(this.dialogData.data);\n        break;\n      default:\n        this.prefillDataGroupForm(this.dialogData.data);\n    }\n  }\n\n  async setRestrictions(allowedConnectionList: Array<string>): Promise<any> {\n    //thinking of it not yet completed\n    this.connectionsToRestrict = this.allConnectionsList.filter(\n      (item) => !allowedConnectionList.includes(item)\n    );\n    this.proConnectionList = this.connectionsToRestrict.filter(\n      (val) => !this.enterpriseConnectionList.includes(val)\n    );\n    // console.log(\n    //   \"hi i m inside connections to restrict : \",\n    //   this.connectionsToRestrict,\n    //   this.proConnectionList,\n    //   this.enterpriseConnectionList\n    // );\n  }\n\n  /**\n   * Prefill the data group form for edit functionality\n   * @param connectionData selected data group details\n   */\n  prefillDataGroupForm(dataGroupData: any): void {\n    if (dataGroupData) {\n      this.isEdit = true;\n      this.connectionIdToUpdate = dataGroupData._id;\n      this.dataGroupForm.patchValue({\n        name: dataGroupData.name,\n        parentId: dataGroupData.parentId,\n      });\n    } else {\n      this.dataGroupForm.get('parentId').setValue(this.dialogData.currentDataGroup);\n      this.dataGroupForm.get('name').reset();\n      this.isEdit = false;\n    }\n  }\n\n  /**\n   * Handles the data group submit functionality as per the operation\n   * @param formValue\n   */\n  onSubmitDataGroup(formValue: any): void {\n    if (this.isEdit) {\n      this.updateDataGroupHandler(formValue);\n    } else {\n      this.createDataGroupHandler(formValue);\n    }\n  }\n\n  /**\n   * Updates the data group details\n   * @param formValue\n   */\n  updateDataGroupHandler(formValue: any): void {\n    delete this.dialogData.data.name;\n    let reqObj: any = { ...this.dialogData.data, name: formValue.name };\n    this.dataConnection$ = this._data.updateDataGroup(reqObj).subscribe(\n      (res: any) => {\n        if (res) {\n          this._toaster.success('Folder name updated successfully', 'Data Connection');\n          this.closeModal(res);\n        }\n      },\n      (err: Error) => {\n        this._toaster.error('Server Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Creates a new folder\n   * @param formValue\n   */\n  createDataGroupHandler(formValue: any): void {\n    let reqObj: any = { ...formValue, projectId: this.project._id };\n    this.dataConnection$ = this._data.createNewDataGroup(reqObj).subscribe(\n      (res: any) => {\n        if (res) {\n          this._toaster.success(`${res.name} folder created successfully`, 'Data Connection');\n          this.closeModal(res);\n        }\n      },\n      (err: Error) => {\n        this._toaster.error('Server Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Headings and icons handler for forms as per the type\n   * @param {*} type - upload, mysql, mssql, postgresql, url, sftp\n   */\n  formUIHandler(type: string): void {\n    if (\n      environment.appType === 'enterprise' ||\n      this.user?.roles?.includes('super_admin') ||\n      this.user?.roles?.includes('admin') ||\n      (this.connectionsToRestrict && !this.connectionsToRestrict.includes(type))\n    ) {\n      this.showConnectionTypes = false;\n      this.sourceType = type;\n      switch (type) {\n        case 'upload':\n          this.formHeading = 'Upload a file';\n          this.iconType = '../../../../../assets/img/icons/upload.svg';\n          break;\n        case 'mysql':\n          this.formHeading = 'Pull data from MYSQL server';\n          this.iconType = '../../../../../assets/img/icons/mysql.svg';\n          break;\n        case 'mssql':\n          this.formHeading = 'Pull data from MSSQL server';\n          this.iconType = '../../../../../assets/img/icons/mssql.svg';\n          break;\n        case 'postgresql':\n          this.formHeading = 'Pull data from PostgreSQl server';\n          this.iconType = '../../../../../assets/img/icons/postgresql.svg';\n          break;\n        case 'snowflake':\n          this.formHeading = 'Pull from data cloud';\n          this.iconType = '../../../../../assets/img/snow.png';\n          break;\n        case 'sftp':\n          this.formHeading = 'Pull data from SFTP server';\n          this.iconType = '../../../../../assets/img/icons/sftp.svg';\n          break;\n        case 'url':\n          this.formHeading = 'Data Downloader (Note: Works for dataset < 2MB)';\n          this.iconType = '../../../../../assets/img/icons/url.svg';\n          break;\n        case 's3':\n          this.formHeading = 'Pull data from Amazon S3 server';\n          this.iconType = '../../../../../assets/img/s3.svg';\n          break;\n        case 'bigquery':\n          this.formHeading = 'Pull data from Google BigQuery';\n          this.iconType = '../../../../../assets/img/bigquery.png';\n          break;\n      }\n    } else {\n      (this.proConnectionList?.includes(type) || this.enterpriseConnectionList?.includes(type)) &&\n        this._snackbar.open('Selected feature is under premium subscription ', 'OK', {\n          horizontalPosition: 'right',\n          verticalPosition: 'bottom',\n        });\n    }\n  }\n\n  /**\n   * Returns the style as per the source type\n   * @returns\n   */\n  getHeadingIconSize(): string {\n    switch (this.sourceType) {\n      case 'upload':\n        return 'height: 20px; width:20px';\n      case 'mysql':\n        return 'height: 20px; width:20px';\n\n      case 'mssql':\n        return 'height: 20px; width:20px';\n\n      case 'postgresql':\n        return 'height: 20px; width:20px';\n\n      case 'snowflake':\n        return 'height: 20px; width:20px';\n\n      case 'sftp':\n        return 'height: 20px; width:20px';\n\n      case 'url':\n        return 'height: 20px; width:20px';\n\n      case 's3':\n        return 'height: 20px; width:20px';\n\n      case 'bigquery':\n        return 'height: 20px; width:20px';\n    }\n  }\n\n  /**\n   * Closes the opened modal by sending the data or without data\n   */\n  closeModal(data?: any): void {\n    this.dialogRef.close(data);\n  }\n\n  /**\n   * Unsubscribes the subscriptions, only if they were subscribed\n   */\n  ngOnDestroy() {\n    if (this.dataConnection$) {\n      this.dataConnection$.unsubscribe();\n    }\n  }\n}\n","<!-- Main container -->\n<div class=\"fluid-container\">\n  <!-- HEADER -->\n  <mat-card class=\"heading\">\n    <mat-card-header>\n      <div mat-card-avatar>\n        <i class=\"far fa-folder folder-icon\"></i>\n      </div>\n      <mat-card-title>\n        <h3\n          [class]=\"breadcrumbArray.length ? 'heading-with-breadcrumb' : 'heading-title'\"\n          [matTooltip]=\"_utils.getTootip('dataConnections')\"\n          (click)=\"breadcrumbHandler('', true)\"\n          style=\"cursor: pointer\"\n        >\n          Data Connections\n        </h3>\n        <!-- Bread crumbs -->\n        <div *ngFor=\"let crumb of breadcrumbArray; last as last\" class=\"d-flex align-items-center\">\n          <!-- ICON (chevron) -->\n          <mat-icon class=\"align-middle\">chevron_right</mat-icon>\n          <!-- LABEL (breadcrumb name) -->\n          <h3\n            [class]=\"last ? 'breadcrumb-name' : 'heading-with-breadcrumb ml-0'\"\n            (click)=\"breadcrumbHandler(crumb, true)\"\n          >\n            {{ crumb.name }}\n          </h3>\n        </div>\n      </mat-card-title>\n      <!-- Buttons -->\n      <span class=\"ml-auto\">\n        <button\n          type=\"button\"\n          [matTooltip]=\"_utils.getTootip('createDataConnections')\"\n          mat-raised-button\n          *ngIf=\"fArr && fArr.length > 0\"\n          class=\"bg-primary\"\n          (click)=\"openModalHandler('dataSource')\"\n          style=\"float: right\"\n        >\n          Data Sources\n        </button>\n        <button\n          type=\"button\"\n          [matTooltip]=\"'Choose and import sample datasets.'\"\n          mat-raised-button\n          class=\"bg-primary mr-3\"\n          style=\"float: right\"\n          (click)=\"openDatasetModal(importDataset)\"\n        >\n          Sample Datasets\n        </button>\n        <button\n          type=\"button\"\n          [matTooltip]=\"_utils.getTootip('createDataGroup')\"\n          mat-stroked-button\n          (click)=\"openModalHandler('dataGroup')\"\n          style=\"float: right; margin-right: 15px\"\n        >\n          Create Folder\n        </button>\n      </span>\n    </mat-card-header>\n  </mat-card>\n\n  <!-- WIDGET (new user) -->\n  <mat-card *ngIf=\"fArr && fArr.length === 0\" class=\"first-user-widget\">\n    <mat-card-content class=\"px-5 py-3\">\n      <div class=\"row align-items-center\">\n        <div class=\"col-md-7 align-middle p-lg\">\n          <h3 style=\"font-size: 22px\">Hi {{ user.displayName }}!</h3>\n          <p style=\"font-size: 22px; margin: 30px 0\">\n            Data is my fuel, connect with wide variety of data sources to pull data and build a\n            fruitful model.\n          </p>\n          <div>\n            <button\n              type=\"button\"\n              mat-flat-button\n              class=\"btn-primary\"\n              style=\"font-size: 22px; height: 48px\"\n              (click)=\"openModalHandler('dataSource')\"\n            >\n              Data Sources\n            </button>\n          </div>\n        </div>\n        <div class=\"col-md-5 text-right\">\n          <img\n            src=\"../../../../assets/img/data-connection-infographic.svg\"\n            alt=\"Data Connection Types\"\n          />\n        </div>\n      </div>\n    </mat-card-content>\n  </mat-card>\n\n  <!-- LIST (connections) -->\n  <mat-card *ngIf=\"fArr && fArr.length > 0\" class=\"connection-listing mt-5 p-4\">\n    <mat-card-content>\n      <mat-form-field class=\"search-input\">\n        <mat-label>Search</mat-label>\n        <input matInput (keyup)=\"applyFilter($event, 'connections')\" #input />\n      </mat-form-field>\n      <!-- TABLE -->\n      <table\n        mat-table\n        [dataSource]=\"dataSource\"\n        matSort\n        matSortActive=\"createdAt\"\n        matSortDirection=\"desc\"\n        matSortDisableClear\n        class=\"mt-2\"\n      >\n        <!-- Icons Column -->\n        <ng-container matColumnDef=\"icon\">\n          <th mat-header-cell *matHeaderCellDef></th>\n          <td mat-cell *matCellDef=\"let row\">\n            <i [ngClass]=\"getIcon(row.type)\"></i>\n          </td>\n        </ng-container>\n\n        <!-- Sr. No Column -->\n        <!-- <ng-container matColumnDef=\"srNo\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Sr. No.</th>\n          <td mat-cell *matCellDef=\"let row; let i = index\">\n            {{ i + 1 + conListPaginator.pageIndex * conListPaginator.pageSize }}\n          </td>\n        </ng-container> -->\n\n        <!-- Connection name Column -->\n        <ng-container matColumnDef=\"name\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            [class.clickable]=\"!row.type\"\n            (click)=\"breadcrumbHandler(row)\"\n          >\n            {{ row.name }}\n          </td>\n        </ng-container>\n\n        <!-- Source Column -->\n        <ng-container matColumnDef=\"type\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Source</th>\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            [class.clickable]=\"row.type !== 'upload' && row.type !== 'notebook'\"\n            (click)=\"openFilesModal(connectionFilesTemplate, row)\"\n          >\n            {{ row.type ? row.type : '-' }}\n          </td>\n        </ng-container>\n        <!--parsed-->\n        <ng-container matColumnDef=\"parsed\">\n          <th mat-header-cell *matHeaderCellDef>Parsed</th>\n          <td mat-cell *matCellDef=\"let row\">\n            <div class=\"actions-buttons\">\n              <div *ngIf=\"row.parsed == false\">\n                <button mat-icon-button (click)=\"showMessage(row.message)\">\n                  <i class=\"fa fa-times-circle danger-icon\" aria-hidden=\"true\"></i>\n                </button>\n              </div>\n              <div *ngIf=\"row.parsed == true\">\n                <button mat-icon-button (click)=\"showMessage(row.message)\">\n                  <i class=\"fa fa-check-circle success-icon\" aria-hidden=\"true\"></i>\n                </button>\n              </div>\n              <div *ngIf=\"row.parsed == undefined\">\n                <button mat-icon-button>-</button>\n              </div>\n            </div>\n          </td>\n        </ng-container>\n        <!-- Schedular Column -->\n        <ng-container matColumnDef=\"schedular\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Schedule</th>\n          <td mat-cell *matCellDef=\"let row\">\n            {{ row.schedule_id ? row.schedule_id.scheduleName : '-' }}\n          </td>\n        </ng-container>\n\n        <!-- Created At Column -->\n        <ng-container matColumnDef=\"createdAt\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Created At</th>\n          <td mat-cell *matCellDef=\"let row\">\n            {{ row.createdAt | date: 'medium' }}\n          </td>\n        </ng-container>\n        <!-- Actions Column -->\n        <ng-container matColumnDef=\"actions\">\n          <th mat-header-cell *matHeaderCellDef>Actions</th>\n          <td mat-cell *matCellDef=\"let row\">\n            <div class=\"action-buttons d-flex\">\n              <div\n                *ngIf=\"\n                  row.type === 'url' ||\n                  row.type === 'mysql' ||\n                  row.type === 'mssql' ||\n                  row.type === 'sftp' ||\n                  row.type === 'postgresql' ||\n                  row.type === 's3' ||\n                  row.type === 'snowflake' ||\n                  row.type === 'bigquery'\n                \"\n              >\n                <!-- Spinner icon -->\n                <button\n                  mat-icon-button\n                  *ngIf=\"row.isPulling\"\n                  style=\"background-color: inherit; font-size: 18px\"\n                >\n                  <i class=\"fa fa-cog fa-spin\"></i>\n                </button>\n\n                <!-- Pull icon -->\n                <button\n                  [hidden]=\"row.isPulling\"\n                  mat-icon-button\n                  [matTooltip]=\"dataFlowToolTip\"\n                  [matTooltipClass]=\"isDataFlowFailed ? 'nodered-error-tooltip-custom' : ''\"\n                  (click)=\"pullConnectionData(row)\"\n                >\n                  <i class=\"fa fa-magnet\"></i>\n                  <i\n                    *ngIf=\"isDataFlowFailed && !callFromStartFlow && flowIdCheck == row.name\"\n                    class=\"nodered-error fas fa-exclamation-circle\"\n                  ></i>\n                </button>\n\n                <!-- Create indirect flow icon -->\n                <button\n                  mat-icon-button\n                  *ngIf=\"!row.dataflowId\"\n                  matTooltip=\"Data flow\"\n                  [routerLink]=\"['/project/data/dataflow']\"\n                  [queryParams]=\"{ connectionId: row._id }\"\n                  [disabled]=\"\n                    appType === 'saas' &&\n                    !user?.roles?.includes('super_admin') &&\n                    !user?.roles?.includes('admin')\n                  \"\n                >\n                  <i\n                    matBadge\n                    [matBadgeIcon]=\"'ENT'\"\n                    matBadgeOverlap=\"false\"\n                    [ngClass]=\"\n                      appType === 'enterprise' ||\n                      (appType === 'saas' &&\n                        (user?.roles?.includes('super_admin') || user?.roles?.includes('admin')))\n                        ? ''\n                        : 'disable-Btn'\n                    \"\n                    class=\"fa fa-random\"\n                  ></i>\n                </button>\n\n                <!-- Open the flow editor to edit -->\n                <button\n                  mat-icon-button\n                  *ngIf=\"row.dataflowId\"\n                  matTooltip=\"Data flow\"\n                  [routerLink]=\"['/project/data/dataflow']\"\n                  [queryParams]=\"{ dataFlowId: row.dataflowId }\"\n                >\n                  <i class=\"fa fa-random\"></i>\n                </button>\n              </div>\n\n              <!-- Download file icon -->\n              <button\n                mat-icon-button\n                *ngIf=\"row.type === 'upload' || row.type === 'notebook'\"\n                matTooltip=\"Download file\"\n                class=\"text-value\"\n                (click)=\"downloadFile(row)\"\n              >\n                <i class=\"fa fa-download\"></i>\n              </button>\n              <!-- Edit connection details -->\n              <div\n                *ngIf=\"\n                  row.type === 'url' ||\n                  row.type === 'mysql' ||\n                  row.type === 'mssql' ||\n                  row.type === 'sftp' ||\n                  row.type === 'postgresql' ||\n                  row.type === 's3' ||\n                  row.type === 'snowflake' ||\n                  row.type === 'bigquery'\n                \"\n              >\n                <!-- Edit connection icon -->\n                <button mat-icon-button matTooltip=\"Edit\" (click)=\"openModalHandler(row.type, row)\">\n                  <i class=\"fa fa-edit\"></i>\n                </button>\n              </div>\n\n              <!-- Delete icon -->\n              <button\n                class=\"delete-button\"\n                matTooltip=\"Delete\"\n                mat-icon-button\n                (click)=\"deleteHandler(row._id, row.type)\"\n              >\n                <i class=\"fa fa-trash\"></i>\n              </button>\n            </div>\n          </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumns\"></tr>\n\n        <!-- Row shown when there is no matching data. -->\n        <tr class=\"mat-row\" *matNoDataRow>\n          <td class=\"mat-cell\" colspan=\"4\">No data matching the filter \"{{ input.value }}\"</td>\n        </tr>\n      </table>\n      <!-- Paginator -->\n      <mat-paginator\n        #conListPaginator\n        class=\"mt-2\"\n        [pageSizeOptions]=\"pageSizeOptions\"\n      ></mat-paginator>\n    </mat-card-content>\n  </mat-card>\n</div>\n\n<!-- Connection files listing modal -->\n<ng-template #connectionFilesTemplate>\n  <div class=\"connection-listing\">\n    <h2 mat-dialog-title>Files</h2>\n    <mat-dialog-content>\n      <mat-form-field class=\"search-input\">\n        <mat-label>Search</mat-label>\n        <input matInput (keyup)=\"applyFilter($event, 'connectionFiles')\" #input />\n      </mat-form-field>\n      <table\n        #ConnFilesSort=\"matSort\"\n        mat-table\n        [dataSource]=\"filesDataSource\"\n        matSort\n        matSortActive=\"createdAt\"\n        matSortDirection=\"desc\"\n        matSortDisableClear\n      >\n        <!-- Sr. No Column -->\n        <!-- <ng-container matColumnDef=\"srNo\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Sr. No.</th>\n          <td mat-cell *matCellDef=\"let row; let i = index\">\n            {{ i + 1 + ConnFilesPaginator.pageIndex * ConnFilesPaginator.pageSize }}\n          </td>\n        </ng-container> -->\n        <!-- File name Column -->\n        <ng-container matColumnDef=\"name\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>\n          <td mat-cell *matCellDef=\"let row\">{{ row.name }}</td>\n        </ng-container>\n        <ng-container matColumnDef=\"parsed\">\n          <th mat-header-cell *matHeaderCellDef>Parsed</th>\n          <td mat-cell *matCellDef=\"let row\">\n            <div class=\"actions-buttons\">\n              <div *ngIf=\"row.parsed == false\">\n                <button mat-icon-button (click)=\"showMessage(row.message)\">\n                  <i class=\"fa fa-times-circle danger-icon\" aria-hidden=\"true\"></i>\n                </button>\n              </div>\n              <div *ngIf=\"row.parsed == true\">\n                <button mat-icon-button (click)=\"showMessage(row.message)\">\n                  <i class=\"fa fa-check-circle success-icon\" aria-hidden=\"true\"></i>\n                </button>\n              </div>\n              <div *ngIf=\"row.parsed == undefined\">\n                <button mat-icon-button>-</button>\n              </div>\n            </div>\n          </td>\n        </ng-container>\n        <!-- Created At Column -->\n        <ng-container matColumnDef=\"createdAt\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Created At</th>\n          <td mat-cell *matCellDef=\"let row\">\n            {{ row.createdAt | date: 'medium' }}\n          </td>\n        </ng-container>\n\n        <!-- Actions Column -->\n        <ng-container matColumnDef=\"actions\">\n          <th mat-header-cell *matHeaderCellDef>Actions</th>\n          <td mat-cell *matCellDef=\"let row\">\n            <div class=\"action-buttons d-flex\">\n              <p>{{ row.dataflowId }}</p>\n              <!-- Execute data flow file icon -->\n              <button\n                *ngIf=\"isDataFlowPresent\"\n                [matTooltip]=\"urlFlowPlayBtnToolTip\"\n                [matTooltipClass]=\"\n                  isDataFlowFailed && callFromStartFlow && flowIdCheck == row.name\n                    ? 'nodered-error-tooltip-custom'\n                    : ''\n                \"\n                mat-icon-button\n                class=\"text-value\"\n                (click)=\"executeDataFlow(row)\"\n              >\n                <i class=\"fa fa-play\"></i>\n                <i\n                  *ngIf=\"isDataFlowFailed && callFromStartFlow && flowIdCheck == row.name\"\n                  class=\"nodered-error fas fa-exclamation-circle\"\n                ></i>\n              </button>\n\n              <!-- Download file icon -->\n              <button\n                mat-icon-button\n                class=\"text-value\"\n                matTooltip=\"Download File\"\n                (click)=\"downloadFile(row)\"\n              >\n                <i class=\"fa fa-download\"></i>\n              </button>\n\n              <!-- Delete icon -->\n              <button\n                class=\"delete-button\"\n                mat-icon-button\n                matTooltip=\"Click to remove the file.\"\n                (click)=\"deleteRawFile(row._id, row.connId, 'connectionFile')\"\n              >\n                <i class=\"fa fa-trash\"></i>\n              </button>\n            </div>\n          </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumnsFiles\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumnsFiles\"></tr>\n\n        <!-- Row shown when there is no matching data. -->\n        <tr class=\"mat-row\" *matNoDataRow>\n          <td class=\"mat-cell\" colspan=\"4\">No data matching the filter \"{{ input.value }}\"</td>\n        </tr>\n      </table>\n\n      <!-- Paginator -->\n      <mat-paginator #ConnFilesPaginator [pageSizeOptions]=\"pageSizeOptions\"></mat-paginator>\n    </mat-dialog-content>\n    <mat-dialog-actions class=\"justify-content-end m-auto\">\n      <button mat-stroked-button mat-dialog-close color=\"basic\">Close</button>\n    </mat-dialog-actions>\n  </div>\n</ng-template>\n\n<!-- Import sample dataset dialog -->\n<ng-template #importDataset>\n  <h1 mat-dialog-title>Sample Dataset</h1>\n  <mat-dialog-content class=\"mat-typography\">\n    <div class=\"d-flex flex-wrap justify-content-start my-4 row\">\n      <div class=\"col-md-4 mb-4 d-flex\" *ngFor=\"let temp of allSampleDatasets\">\n        <mat-card\n          class=\"template-proj-card d-flex flex-column\"\n          style=\"background-color: whitesmoke; width: 350px\"\n        >\n          <mat-card-header>\n            <div mat-card-avatar class=\"example-header-image\">\n              <mat-icon style=\"font-size: 35px; color: orange\">dashboard</mat-icon>\n            </div>\n            <mat-card-title>\n              <h3>{{ temp.name | titlecase }}</h3>\n            </mat-card-title>\n          </mat-card-header>\n          <mat-card-content class=\"flex-grow-1\">\n            <h3>\n              Type :\n              <label>\n                {{\n                  temp.domain === 'predictive_modeling'\n                    ? 'Predictive Modeling'\n                    : (temp.domain | titlecase)\n                }}</label\n              >\n            </h3>\n            <p class=\"font-weight-normal\">{{ temp.description }}</p>\n          </mat-card-content>\n          <mat-card-actions>\n            <button\n              mat-stroked-button\n              class=\"mb-3 mr-3\"\n              matTooltip=\"Click to import dataset\"\n              style=\"float: right; font-size: medium\"\n              (click)=\"importSampleDataset(temp.file)\"\n            >\n              Import&nbsp;<i class=\"fas fa-file-import\"></i>\n            </button>\n          </mat-card-actions>\n        </mat-card>\n      </div>\n    </div>\n  </mat-dialog-content>\n  <mat-dialog-actions class=\"justify-content-end m-auto\">\n    <button mat-stroked-button mat-dialog-close color=\"basic\">Close</button>\n  </mat-dialog-actions>\n</ng-template>\n","import { SchedularService } from './../../dashboard/schedular/schedular.service';\nimport { SpinnerService } from './../../../shared/spinner.service';\nimport { Component, OnDestroy, OnInit, ViewChild, TemplateRef } from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSort } from '@angular/material/sort';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject } from 'rxjs';\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\nimport { DialogHandlerComponent } from './dialog-handler/dialog-handler.component';\nimport { ThemePalette } from '@angular/material/core';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { DataService } from '../data.service';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { SocketIoService } from 'src/app/core/socket-io.service';\nimport { takeUntil } from 'rxjs/operators';\nimport { UtilsService } from 'src/app/shared/utils.service';\nimport { MatSnackBar, MatSnackBarRef } from '@angular/material/snack-bar';\nimport { environment } from 'src/environments/environment';\nimport { SampleDatasetService } from '../../dashboard/sample-dataset/sample-dataset.service';\nimport { HttpErrorResponse, HttpEventType } from '@angular/common/http';\nimport { toasterMsg } from 'src/app/shared/static-data';\n\nconst swal = require('sweetalert');\n\n@Component({\n  selector: 'app-data-connection',\n  templateUrl: './data-connection.component.html',\n  styleUrls: ['./data-connection.component.scss'],\n  // encapsulation: ViewEncapsulation.None,\n})\nexport class DataConnectionComponent implements OnInit, OnDestroy {\n  dataSource: MatTableDataSource<[]> = new MatTableDataSource();\n  filesDataSource: MatTableDataSource<[]> = new MatTableDataSource();\n  // fileUploadRef: any;\n  @ViewChild(MatPaginator) set paginator(value: MatPaginator) {\n    this.dataSource.paginator = value;\n  }\n  @ViewChild(MatSort) set sort(value: MatSort) {\n    this.dataSource.sort = value;\n  }\n  @ViewChild('ConnFilesPaginator') set connFilesPaginator(value: MatPaginator) {\n    this.filesDataSource.paginator = value;\n  }\n  @ViewChild('ConnFilesSort') set connFilesSort(value: MatSort) {\n    this.filesDataSource.sort = value;\n  }\n  snackBarRef: MatSnackBarRef<any>;\n  pageSizeOptions: Array<number> = [10, 15, 20];\n  displayedColumns: Array<string> = [];\n  displayedColumnsFiles: Array<string> = [];\n\n  /** Usubscription subject */\n  unsubscribe$ = new Subject<boolean>();\n\n  project: any;\n  dataGroupsList: Array<any>;\n  connectionsList: any;\n  rawfilesList: any;\n  rawFilesList: any;\n  filesData: any;\n  fArr: Array<any>;\n  parentFolderData: Array<any>;\n  dataList: Array<any>;\n  schedularArray: Array<any>;\n  tempArray: Array<any> = [];\n  user: any;\n  breadcrumbArray: Array<any> = [];\n  breadArray: Array<any> = [];\n  currentDataGroup: string;\n  dataListArray: Array<any> = [];\n  selectedConnToPull: string;\n  isDataFlowFailed: boolean = false;\n  isDataFlowPresent: string;\n  count: number = 0;\n  callFromStartFlow: boolean = false;\n  flowIdCheck: string = null;\n  dataFlowToolTip: string = 'Pull data';\n  urlFlowPlayBtnToolTip: string = 'Execute data flow';\n  // this is for the restrictions\n  planType: string = null;\n  allowedConnectionsList: Array<string> = null;\n  appType: string = environment.appType;\n  allSampleDatasets: Array<any>;\n  filterSampleDatasets: Array<any>;\n  percentDone: number = 0;\n  datasetDialog: MatDialogRef<DataConnectionComponent>;\n\n  constructor(\n    private _toaster: ToastrService,\n    private _data: DataService,\n    private _localStorage: LocalStorageService,\n    private _spinner: SpinnerService,\n    private _dialog: MatDialog,\n    private _schedular: SchedularService,\n    private _window: Window,\n    private _snackBar: MatSnackBar,\n    private _socket: SocketIoService,\n    public _utils: UtilsService,\n    private _sampleDataset: SampleDatasetService\n  ) {\n    this.project = this._localStorage.getItem('project');\n    this.user = this._localStorage.getItem('user');\n    this.allowedConnectionsList = this.user?.psFeatures?.allowedFeaturesList || [];\n    this.displayedColumns = [\n      // 'srNo',\n      'icon',\n      'name',\n      'parsed',\n      'type',\n      'schedular',\n      'createdAt',\n      'actions',\n    ];\n    this.displayedColumnsFiles = ['name', 'parsed', 'createdAt', 'actions'];\n  }\n\n  /**\n   * Initializes page with all the required data\n   */\n  ngOnInit(): void {\n    this._spinner.showSpinner();\n    this.initSocket();\n    this.getAllConnectionsData();\n    this.getDataGroupList();\n    this.getAllSampleDatasets();\n    this.schedularList();\n  }\n\n  /**\n   * Fetches all sample dataset list from DB by triggering API\n   */\n  getAllSampleDatasets(): void {\n    // API call\n    this._sampleDataset\n      .getAllDatasets()\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res.data) {\n            this.allSampleDatasets = res.data;\n            /**\n             * Sorts the sample projects list by data in ascending order\n             */\n            this.filterSampleDatasets = this.allSampleDatasets.sort((a: any, b: any) => {\n              return new Date(b.createdAt).valueOf() - new Date(a.createdAt).valueOf();\n            });\n            this._spinner.stopSpinner();\n          }\n        },\n        (e: any) => {\n          this._spinner.stopSpinner();\n          this._toaster.error(e.error.message || 'Server Error', 'Project Management');\n        }\n      );\n  }\n\n  /**\n   * Imports the sample dataset\n   * @param fileName\n   */\n  importSampleDataset(fileName: any): void {\n    this._spinner.showSpinner();\n    // API call\n    // creating req object for the file upload.\n    let reqObj = {\n      encoding: 'utf_8',\n      projectId: this.project._id,\n      dataGroupId: this.currentDataGroup || this.dataList[0]._id,\n      dataFolderName: this.currentDataGroup || this.dataList[0]._id,\n      parentFolderName: '',\n      file: fileName,\n      uploadType: 'importDataset',\n    };\n    this._data.uploadFile(reqObj).subscribe(\n      (resp) => {\n        this.datasetDialog.close();\n        this._spinner.stopSpinner();\n        this._utils.showSnackBar(toasterMsg.fileUpload);\n      },\n      (err: HttpErrorResponse) => {\n        this._toaster.error(err.error.message || 'Server Error', 'Data Connection');\n        this._spinner.stopSpinner();\n        this._utils.dismissSnackBar();\n      }\n    );\n  }\n\n  /**\n   * Fetches the connections list from the DB\n   */\n  getAllConnectionsData(): void {\n    let dataFilterArray: Array<any> = [];\n    this.dataListArray.length = 0;\n    this.breadArray.length = 0;\n    this.breadcrumbArray.length = 0;\n    this._data\n      .getAllConnectionsData(this.project._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res) => {\n          if (res) {\n            this.dataGroupsList = res[0].datagroupList;\n            this.connectionsList = res[0].connection;\n            this.rawFilesList = res[0].filesdata;\n            this.filesData = res[0].pklfilesdata;\n            this.dataListArray = this.dataListArray.concat(this.dataGroupsList, this.connectionsList, this.rawFilesList);\n            dataFilterArray = this.dataListArray.filter(\n              (temp) => !Object.keys(temp).includes('parentId') && !Object.keys(temp).includes('datagroup_id')\n            );\n            dataFilterArray = dataFilterArray[0]._id;\n            let data = this.dataListArray.filter(\n              (temp) => temp.type !== 'upload_retrained' && (temp.parentId === dataFilterArray || temp.datagroup_id === dataFilterArray)\n            );\n            var filesFilter = data.filter((temp) => !Object.keys(temp).includes('connId'));\n            this.parentFolderData = filesFilter;\n            this.fArr = filesFilter;\n            // Assign the data to the dataSource for the table to show records\n            this.dataSource.data = this.fArr;\n            this.dataSource._updateChangeSubscription();\n            this.dataSource.paginator = this.paginator;\n            this.dataSource.sort = this.sort;\n            this._spinner.stopSpinner();\n          } else {\n            this._spinner.stopSpinner();\n            this._toaster.error('Cannot fetch connections list', 'Data Connection');\n          }\n          this._utils.dismissSnackBar();\n        },\n        (err: Error) => {\n          this._spinner.stopSpinner();\n          this._toaster.error('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  showMessage(message) {\n    this.snackBarRef = this._snackBar.open(message, 'OK', {\n      verticalPosition: 'bottom',\n      horizontalPosition: 'end',\n    });\n  }\n  /**\n   * Fetches all the data groups list\n   */\n  getDataGroupList(): void {\n    this._data\n      .getDataGroupsList(this.project._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.dataList = res;\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Fetches all the schedulars list\n   */\n  schedularList(): void {\n    this._schedular\n      .getSchedularsList()\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.schedularArray = res;\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Opens the select dataset dialog\n   * @param datasetModal modal reference\n   */\n  openDatasetModal(datasetModal: TemplateRef<any>) {\n    this.datasetDialog = this._dialog.open(datasetModal, {\n      minWidth: '50vw',\n      maxWidth: '75vw',\n    });\n  }\n\n  /**\n   * Handles the modal opening operation\n   * @param type dataSource/dataGroup\n   */\n  openModalHandler(type: string, data?: any): void {\n    const dialogRef = this._dialog.open(DialogHandlerComponent, {\n      minWidth: '60vw',\n      maxWidth: '60vw',\n      data: {\n        formType: type,\n        dataGroups: this.dataList,\n        schedulars: this.schedularArray,\n        data: data,\n        currentDataGroup: this.currentDataGroup || this.dataList[0]._id,\n        // this is the allowed connection list which we are passing to data connection dialog\n        allowedConnectionsList: this.allowedConnectionsList || [],\n      },\n    });\n    dialogRef.afterClosed().subscribe((data: any) => {\n      if (data) {\n        // this.fileUploadRef = data.fileUploadRef;\n        this.breadArray.length = 0;\n        this.getAllConnectionsData();\n        this.getDataGroupList();\n        this.schedularList();\n      }\n    });\n  }\n\n  /**\n   * Pulls the data for one selected connection at a time\n   * @param item\n   */\n  pullConnectionData(item: any): void {\n    this.isDataFlowFailed = false;\n    this.callFromStartFlow = false;\n    this.flowIdCheck = item.name;\n    this._utils.showSnackBar(toasterMsg.pullData);\n    this.selectedConnToPull = item._id;\n    /** Adds isPulling flag for the selected connection */\n    this.fArr = this.fArr.map((doc) => {\n      doc._id === item._id ? (doc.isPulling = true) : (doc.isPulling = false);\n      return doc;\n    });\n\n    // API call\n    this._data\n      .pullSingleData(item._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            // this.fArr = this.fArr.map((doc) => {\n            //   doc._id === item._id ? (doc.isPulling = false) : '';\n            //   return doc;\n            // });\n          } else {\n            this.fArr = this.fArr.map((doc) => {\n              doc._id === item._id ? (doc.isPulling = false) : '';\n              return doc;\n            });\n          }\n          // this._utils.dismissSnackBar();\n        },\n        (err: Error) => {\n          this._utils.dismissSnackBar();\n          this.fArr = this.fArr.map((doc) => {\n            doc._id === item._id ? (doc.isPulling = false) : '';\n            return doc;\n          });\n        }\n      );\n  }\n\n  /**\n   * Downloads the connection file\n   */\n  downloadFile(item: any): void {\n    this._window.open(`${environment.serverBaseUrl}/api/project/${this.project._id}/download/${item.name}`, '_blank');\n  }\n\n  /**\n   * Handles the delete operation to delete connection or datagroup\n   * @param {connection id} id\n   * @param {connection type} type\n   */\n  deleteHandler(id: string, type: string): void {\n    switch (type) {\n      case 'upload':\n      case 'notebook':\n      case 'connectionFile':\n        this.deleteRawFile(id, '', type);\n        break;\n      case 'mysql':\n      case 'mssql':\n      case 'postgresql':\n      case 'sftp':\n      case 'url':\n      case 's3':\n      case 'snowflake':\n      case 'bigquery':\n        this.deleteDataConnetion(id, type);\n        break;\n      default:\n        this.deleteDataGroup(id);\n    }\n  }\n\n  /**\n   * Deletes the upload and notebook files from DB\n   * @param id\n   * @param type\n   */\n  deleteRawFile(id: string, connId?: string, type?: string) {\n    swal({\n      title: 'Are you sure?',\n      text: 'You will not be able to recover this file!',\n      icon: 'warning',\n      buttons: {\n        cancel: {\n          text: 'Cancel',\n          value: null,\n          visible: true,\n          className: '',\n        },\n        confirm: {\n          text: 'Yes, delete it!',\n          value: true,\n          visible: true,\n          className: 'bg-danger',\n        },\n      },\n    }).then((isConfirm: boolean) => {\n      let filteredFiles: Array<any>;\n      if (isConfirm) {\n        this.breadArray.length = 0;\n        this._data\n          .deleteRawFile(this.project._id, id)\n          .pipe(takeUntil(this.unsubscribe$))\n          .subscribe(\n            (res: any) => {\n              if (res) {\n                this.getAllConnectionsData();\n                this._toaster.success('File deleted successfully', 'Data Connection');\n                if (type === 'connectionFile') {\n                  filteredFiles = this.rawFilesList.filter((item: any) => {\n                    if (item._id !== id && item.connId === connId) {\n                      return item;\n                    }\n                  });\n                  // Assign the data to the dataSource for the table to show records\n                  this.filesDataSource.data = filteredFiles;\n                  this.filesDataSource._updateChangeSubscription();\n                  this.filesDataSource.paginator = this.paginator;\n                  this.filesDataSource.sort = this.sort;\n                } else {\n                  filteredFiles = this.fArr.filter(function (item) {\n                    return item._id !== id;\n                  });\n                  // Assign the data to the dataSource for the table to show records\n                  this.dataSource.data = filteredFiles;\n                  this.dataSource._updateChangeSubscription();\n                  this.dataSource.paginator = this.paginator;\n                  this.dataSource.sort = this.sort;\n                }\n              } else {\n                this._toaster.error('Cannot delete file', 'Data Connection');\n              }\n            },\n            (err: Error) => {\n              this._toaster.error('Server Error', 'Data Connection');\n            }\n          );\n      }\n    });\n  }\n\n  /**\n   * Deletes the folder\n   * @param id\n   */\n  deleteDataGroup(dataId: string): void {\n    this.breadArray.length = 0;\n    let b: Array<any> = [];\n    let rFiles: Array<any> = [];\n    let pFiles: Array<any> = [];\n\n    let t = this.dataGroupsList.filter((item: any) => {\n      if (item.parentId === dataId || item._id === dataId) {\n        this.tempArray.push(item);\n      }\n      return item.parentId === dataId;\n    });\n\n    this.filterDataGroup(t);\n\n    this.connectionsList.map((item: any) => {\n      var itemfound = this.tempArray.find((docs: any) => {\n        return item.datagroup_id === docs._id;\n      });\n      if (itemfound !== undefined) {\n        let j = item;\n        b.push(j);\n      }\n    });\n\n    this.rawFilesList.map((data: any) => {\n      var item = this.tempArray.find((docs: any) => {\n        return data.datagroup_id == docs._id;\n      });\n      if (item !== undefined) {\n        let j = data;\n        rFiles.push(j);\n      }\n    });\n\n    this.filesData.map((data: any) => {\n      var item = this.tempArray.find((docs: any) => {\n        return data.datagroup_id == docs._id;\n      });\n      if (item !== undefined) {\n        var j = data;\n        pFiles.push(j);\n      }\n    });\n\n    /** Alert for confirmation */\n    swal({\n      title: 'Are you sure?',\n      text: 'You will not be able to recover this data!',\n      icon: 'warning',\n      buttons: {\n        cancel: {\n          text: 'Cancel',\n          value: null,\n          visible: true,\n          className: '',\n        },\n        confirm: {\n          text: 'Yes, delete it!',\n          value: true,\n          visible: true,\n          className: 'bg-danger',\n        },\n      },\n    }).then((isConfirm: boolean) => {\n      if (isConfirm) {\n        let reqObj: any = {\n          projectId: this.project._id,\n          dataId: dataId,\n          datagroup: this.tempArray,\n          dataconnection: b,\n          rawFiles: rFiles,\n          files: pFiles,\n        };\n        this._data\n          .deleteDataGroup(this.project._id, dataId, reqObj)\n          .pipe(takeUntil(this.unsubscribe$))\n          .subscribe(\n            (res: any) => {\n              if (res) {\n                this._toaster.success(`Folder deleted successfully`, 'Data Connection');\n                this.fArr = this.fArr.filter((item: any) => {\n                  return item._id != dataId;\n                });\n                this.dataList = this.dataList.filter((item: any) => {\n                  return item._id != dataId;\n                });\n\n                // Assign the data to the dataSource for the table to show records\n                this.dataSource.data = this.fArr;\n                this.dataSource._updateChangeSubscription();\n                this.dataSource.paginator = this.paginator;\n                this.dataSource.sort = this.sort;\n              } else {\n                this._toaster.error('Cannot delete folder', 'Data Connection');\n              }\n            },\n            (err: Error) => {\n              this._toaster.error('Server Error', 'Data Connection');\n            }\n          );\n      }\n    });\n  }\n\n  /**\n   * Deletes the data connection from DB\n   * @param id\n   * @param type\n   */\n  deleteDataConnetion(id: string, type: string): void {\n    swal({\n      title: 'Are you sure?',\n      text: 'You will not be able to recover this data!',\n      icon: 'warning',\n      buttons: {\n        cancel: {\n          text: 'Cancel',\n          value: null,\n          visible: true,\n          className: '',\n        },\n        confirm: {\n          text: 'Yes, delete it!',\n          value: true,\n          visible: true,\n          className: 'bg-danger',\n        },\n      },\n    }).then((isConfirm: boolean) => {\n      if (isConfirm) {\n        this.breadArray.length = 0;\n        this._data\n          .deleteDataConnection(this.project._id, id)\n          .pipe(takeUntil(this.unsubscribe$))\n          .subscribe(\n            (res: any) => {\n              if (res) {\n                this._toaster.success(`${type.toUpperCase()} connection deleted successfully`, 'Data Connection');\n                this.fArr = this.fArr.filter((item: any) => {\n                  return item._id != id;\n                });\n                // Assign the data to the dataSource for the table to show records\n                this.dataSource.data = this.fArr;\n                this.dataSource._updateChangeSubscription();\n                this.dataSource.paginator = this.paginator;\n                this.dataSource.sort = this.sort;\n              } else {\n                this._toaster.error('Cannot delete file', 'Data Connection');\n              }\n            },\n            (err: Error) => {\n              this._toaster.error('Server Error', 'Data Connection');\n            }\n          );\n      }\n    });\n  }\n\n  /**\n   * Opens the connection files modal pop-up\n   * @param type\n   * @param data\n   */\n  openFilesModal(connectionFilesTemplate: TemplateRef<any>, data: any): void {\n    this.isDataFlowPresent = data.dataflowId;\n    let filteredFiles: Array<any>;\n    if (data.type !== 'upload' && data.type !== 'notebook') {\n      filteredFiles = this.rawFilesList.filter((item: any) => {\n        if (item.connId === data._id && !item.isDeleted) {\n          return item;\n        }\n      });\n      // Assign the data to the dataSource for the table to show records\n      this.filesDataSource.data = filteredFiles;\n      this.filesDataSource._updateChangeSubscription();\n      this._dialog.open(connectionFilesTemplate, {\n        height: 'auto',\n        width: '60%',\n      });\n    }\n  }\n\n  /**\n   * Executes the data flow\n   * @param fileData\n   */\n  executeDataFlow(fileData: any): void {\n    this.callFromStartFlow = true;\n    this.flowIdCheck = fileData.name;\n    this._data\n      .executeDataFlow(this.project._id, fileData.connId, fileData.name)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this._toaster.success('Flow execution started', 'Data Connection');\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Handles the breadcrumbs\n   * @param dataGroupId\n   * @param name\n   * @param isChanged whether any breadcrumb is clicked to navigate\n   */\n  breadcrumbHandler(dataGroupDetails: any, isChanged?: boolean): void {\n    if (!dataGroupDetails.type) {\n      let dataGroupId = dataGroupDetails._id || dataGroupDetails.id;\n      this._spinner.showSpinner();\n      this.currentDataGroup = dataGroupId;\n      let data: Array<any> = [];\n      let filesFilter: Array<any> = [];\n      /** If bread crum is clicked, then navigates to selected folder else create new breadcrumb */\n      if (isChanged) {\n        let index = this.breadArray.findIndex((item) => {\n          return item.id == dataGroupId;\n        });\n        this.breadArray.splice(index + 1);\n        /** If clicked on root breadcrumb */\n        if (!dataGroupDetails) {\n          this.getAllConnectionsData();\n        }\n      } else {\n        this.breadArray.push({\n          id: dataGroupId,\n          name: dataGroupDetails.name,\n        });\n      }\n      this.breadcrumbArray = this.breadArray;\n      data = this.dataListArray.filter((item) => {\n        return item.parentId === dataGroupId || item.datagroup_id === dataGroupId;\n      });\n\n      filesFilter = data.filter((temp) => {\n        return !Object.keys(temp).includes('connId');\n      });\n      this.fArr = filesFilter;\n      // Assign the data to the dataSource for the table to show records\n      this.dataSource.data = filesFilter;\n      this.dataSource._updateChangeSubscription();\n      this.dataSource.paginator = this.paginator;\n      this.dataSource.sort = this.sort;\n      this._spinner.stopSpinner();\n    }\n  }\n\n  /**\n   * Filtering required while deleting data group\n   * @param id\n   */\n  filterDataGroup(id: any): void {\n    let d: any;\n    for (var i = 0; i < id.length; i++) {\n      d = this.dataGroupsList.filter((item) => {\n        if (item.parentId == id[i]._id) {\n          this.tempArray.push(item);\n        }\n        return item.parentId == id[i]._id;\n      });\n      this.callRecursive(d);\n    }\n  }\n\n  /**\n   * Recursive function\n   * @param d\n   */\n  callRecursive(d: any): void {\n    if (d.length > 0) {\n      this.filterDataGroup(d);\n    } else {\n      return;\n    }\n  }\n\n  /**\n   * Returns the icon class as per the connection type\n   * @param type\n   */\n  getIcon(type: string): string {\n    switch (type) {\n      case 'mysql':\n      case 'mssql':\n      case 'postgresql':\n      case 'sftp':\n      case 's3':\n      case 'snowflake':\n      case 'bigquery':\n        return 'fa fa-database icons';\n\n      case 'upload':\n      case 'notebook':\n        return 'fa fa-file-alt icons';\n\n      case 'url':\n        return 'fa fa-link icons';\n\n      default:\n        return 'fa fa-folder icons';\n    }\n  }\n\n  /**\n   * Called when any string is entered in search box\n   * @param event keyup event\n   */\n  applyFilter(event: Event, tableName: string): void {\n    const filterValue = (event.target as HTMLInputElement).value;\n    if (tableName === 'connections') {\n      this.dataSource.filter = filterValue.trim().toLowerCase();\n      if (this.dataSource.paginator) {\n        this.dataSource.paginator.firstPage();\n      }\n    } else if (tableName === 'connectionFiles') {\n      this.filesDataSource.filter = filterValue.trim().toLowerCase();\n      if (this.filesDataSource.paginator) {\n        this.filesDataSource.paginator.firstPage();\n      }\n    }\n  }\n\n  /**\n   * Initializes the socket to listen events when emmited\n   */\n  initSocket(): void {\n    // Listens to the pull data event\n    this._socket.listen('pullData').subscribe(\n      (res: any) => {\n        if (res.status === 'pull_success') {\n          this._utils.dismissSnackBar();\n          if (res.data.parsed) {\n            res.data.projectId === this.project._id && this._toaster.success('Data uploaded successfully', 'Data Connection');\n          } else {\n            res.data.projectId === this.project._id && this._toaster.info(res.data.message, 'Data Connection');\n          }\n          this.getAllConnectionsData();\n        } else {\n          // Stops the spinner of selected connection if error\n          this.fArr = this.fArr.map((doc) => {\n            if (doc._id === this.selectedConnToPull) {\n              doc.isPulling = false;\n              (doc.type === 'sftp' || doc.type === 's3') && res.status === 'No updated files'\n                ? this._toaster.info(res.status, 'Data Connection')\n                : this._toaster.error(res.status, 'Data Connection');\n            }\n            return doc;\n          });\n          res.status === 'No updated files'\n            ? this._toaster.info(res.status.message || res.status || 'Could not complete the operation', 'Data Connection')\n            : this._toaster.error(res.status.message || res.status || 'Could not complete the operation', 'Data Connection');\n          this._spinner.stopSpinner();\n          this._utils.dismissSnackBar();\n        }\n        this._utils.dismissSnackBar();\n        this._spinner.stopSpinner();\n      },\n      (err) => {\n        this._spinner.stopSpinner();\n        this._utils.dismissSnackBar();\n        this._toaster.error('Socket Error', 'Data Connection');\n      }\n    );\n\n    // Listens to node-red event\n    this._socket.listen('nodeRedFlowExecution').subscribe(\n      (res: any) => {\n        if (res.status === 'flow_execution_failed') {\n          this.isDataFlowFailed = true;\n          this.dataFlowToolTip = 'Data Flow Execution Failed';\n          this.urlFlowPlayBtnToolTip = 'Data Flow Execution Failed';\n        }\n        if (this.isDataFlowFailed) {\n          if (this.count < 1) {\n            this._toaster.error('Data Flow Execution Failed', 'Data Flow');\n          }\n          this.count++;\n        }\n        this._spinner.stopSpinner();\n      },\n      (err) => {\n        this._spinner.stopSpinner();\n        this._toaster.error('Socket Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Perform operations when the module is destroyed\n   */\n  ngOnDestroy() {\n    this._socket.removeListener('pullData');\n    this._socket.removeListener('nodeRedFlowExecution');\n    this._utils.dismissSnackBar();\n    this.unsubscribe$.next(false);\n    this.unsubscribe$.unsubscribe();\n  }\n}\n","<h2 mat-dialog-title>\n  {{ modalHeading }}\n  <small *ngIf=\"dialogData.type === 'preview'\">(Note: Preview of first 5 records only)</small>\n</h2>\n<!-- Merge form section -->\n<mat-dialog-content *ngIf=\"dialogData.type === 'merge'\" class=\"mat-typography mt-4\">\n  <h4 class=\"selected-dataset\">\n    Selected Data Set :\n    <mat-chip-list class=\"ml-2\">\n      <mat-chip>{{ dialogData.data.name }}</mat-chip>\n    </mat-chip-list>\n  </h4>\n  <mat-progress-spinner *ngIf=\"showSpinner\" class=\"spinner\" [color]=\"color\" [mode]=\"mode\" [diameter]=\"diameter\">\n  </mat-progress-spinner>\n\n  <form [formGroup]=\"mergeForm\" role=\"form\" class=\"form-validate\" name=\"mergeForm\">\n    <!-- Select data set files dropdown -->\n    <div class=\"row\">\n      <div class=\"col-md-12 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label [matTooltip]=\"_utils.getTootip('selectDataSetEda')\">Select data set to merge</mat-label>\n          <mat-select formControlName=\"selectedDataset\" (selectionChange)=\"dataSetChanged($event.value)\" required>\n            <mat-option *ngFor=\"let file of dataSetList\" [value]=\"file._id\">{{\n              file.filename | dropFileExtension: file.fileSource\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              mergeForm.get('selectedDataset').hasError('required') &&\n              (mergeForm.get('selectedDataset').dirty || mergeForm.get('selectedDataset').touched)\n            \">Data set is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div class=\"row\">\n      <!-- Merge type (radio) -->\n      <div class=\"col-md-5 form-group ml-1\">\n        <label id=\"project-type\">How do you want to merge data ?</label>\n        <mat-radio-group class=\"radio-group\" [(ngModel)]=\"mergeType\" (change)=\"mergeTypeChanged(mergeType)\"\n          [ngModelOptions]=\"{ standalone: true }\">\n          <mat-radio-button value=\"row\" [matTooltip]=\"_utils.getTootip('mergeDatasetRowWise')\">Row wise\n          </mat-radio-button>\n          <mat-radio-button value=\"column\" [matTooltip]=\"_utils.getTootip('mergeDatasetColumnWise')\">Column wise\n          </mat-radio-button>\n        </mat-radio-group>\n      </div>\n    </div>\n\n    <!-- Join type (dropdown) -->\n    <div class=\"row\" *ngIf=\"\n        mergeType === 'column' && mergeForm.get('selectedDataset').value && commonColumns.length\n      \">\n      <div class=\"col-md-6 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select join type</mat-label>\n          <mat-select formControlName=\"joinType\" required>\n            <mat-option *ngFor=\"let type of joinTypeArray\" [value]=\"type\">{{\n              type | titlecase\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              mergeForm.get('joinType').hasError('required') &&\n              (mergeForm.get('joinType').dirty || mergeForm.get('joinType').touched)\n            \">Join type is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div *ngIf=\"\n        mergeType === 'column' && mergeForm.get('selectedDataset').value && commonColumns.length\n      \" class=\"row\">\n      <!-- On which column -->\n      <div class=\"col-md-6 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>On which column(s) you want to merge ?</mat-label>\n          <mat-select formControlName=\"commonColumn\" multiple>\n            <mat-option *ngFor=\"let col of commonColumns\" [value]=\"col.colName\">{{\n              col.colName\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              mergeForm.get('commonColumn').hasError('required') &&\n              (mergeForm.get('commonColumn').dirty || mergeForm.get('commonColumn').touched)\n            \">This field is required.</mat-error>\n        </mat-form-field>\n      </div>\n\n      <!-- Columns to merge (multi-select) -->\n      <div class=\"col-md-6 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select column(s) to merge</mat-label>\n          <mat-select formControlName=\"columnsToMerge\" multiple>\n            <mat-option *ngFor=\"let col of avalialbleColumnsToMerge\" [value]=\"col.colName\">{{ col.colName }}\n            </mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              mergeForm.get('columnsToMerge').hasError('required') &&\n              (mergeForm.get('columnsToMerge').dirty || mergeForm.get('columnsToMerge').touched)\n            \">This field is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <mat-hint *ngIf=\"commonColumns && commonColumns.length === 0 && mergeType === 'column'\">Note : There are no common\n      columns to merge.</mat-hint>\n  </form>\n</mat-dialog-content>\n\n<!-- Preview data section -->\n<mat-dialog-content *ngIf=\"dialogData.type === 'preview'\" class=\"mat-typography preview-data-section mb-3\">\n  <!-- <mat-form-field class=\"search-input\">\n    <mat-label>Search</mat-label>\n    <input matInput (keyup)=\"applyFilter($event)\" placeholder=\"Enter the value\" #input />\n  </mat-form-field> -->\n  <ag-grid-angular #agGrid id=\"myGrid\" *ngIf=\"previewrowData\" class=\"ag-angle my-4\" [rowData]=\"previewrowData\"\n    [gridOptions]=\"gridOptions\" (gridReady)=\"gridReady($event)\">\n  </ag-grid-angular>\n\n  <!-- Paginator -->\n  <!-- <mat-paginator [pageSizeOptions]=\"pageSizeOptions\"></mat-paginator> -->\n</mat-dialog-content>\n\n<mat-dialog-actions class=\"justify-content-end m-auto\">\n  <button mat-stroked-button (click)=\"closeModal()\">Cancel</button>\n  <button *ngIf=\"dialogData.type === 'merge'\" mat-flat-button class=\"btn-primary\" type=\"submit\"\n    [disabled]=\"mergeForm.invalid\" (click)=\"onSubmitMerge(mergeForm.value)\">\n    Merge\n  </button>\n</mat-dialog-actions>","import { DataSetComponent } from '../data-set.component';\nimport { Component, Inject, OnInit, ViewChild } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { ToastrService } from 'ngx-toastr';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSort } from '@angular/material/sort';\nimport { ThemePalette } from '@angular/material/core';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { Subscription } from 'rxjs';\nimport { DataService } from '../../data.service';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { UtilsService } from 'src/app/shared/utils.service';\nimport { GridOptions } from 'ag-grid-community';\nimport { SpinnerService } from 'src/app/shared/spinner.service';\n\n@Component({\n  selector: 'app-data-set-dialog',\n  templateUrl: './data-set-dialog.component.html',\n  styleUrls: ['./data-set-dialog.component.scss']\n})\nexport class DataSetDialogComponent implements OnInit {\n\n  /** Data table settings */\n  dataSource: MatTableDataSource<[]> = new MatTableDataSource();\n  @ViewChild(MatPaginator) paginator: MatPaginator;\n  @ViewChild(MatSort) sort: MatSort;\n  gridOptions: GridOptions;\n  resizeEvent = 'resize.ag-grid';\n  private gridApi;\n  pageSizeOptions: Array<number> = [10, 15, 20];\n  displayedColumns: Array<string> = [];\n\n  /** Progress spinner settings */\n  color: ThemePalette = 'primary';\n  mode: ProgressSpinnerMode = 'indeterminate';\n  diameter = 100;\n  exportProjectDiameter = 50;\n\n  /** Subscription variables */\n  dataConnection$: Subscription;\n\n  joinTypeArray: Array<string> = ['inner', 'left', 'right', 'outer'];\n  mergeForm: FormGroup;\n  showPreview: boolean = false;\n  showReport: boolean = false;\n  showMergeForm: boolean = false;\n  modalHeading: string;\n  project: any;\n  parentFile: any;\n  showSpinner: boolean = false;\n  dataSetList: Array<any> = [];\n  mergeType: string = 'row';\n  avalialbleColumnsToMerge: Array<any>;\n  commonColumns: Array<any>;\n  mergeDataSet: any;\n  gridColumnApi: any;\n  previewrowData: any;\n  constructor(\n    @Inject(MAT_DIALOG_DATA) public dialogData: any,\n    private _spinner: SpinnerService, private _fb: FormBuilder, private _data: DataService, private _toaster: ToastrService, private _dataSetDialogRef: MatDialogRef<DataSetComponent>, private _localStorage: LocalStorageService, public _utils: UtilsService\n  ) {\n    /** Form instances */\n    this.mergeForm = this._fb.group({\n      selectedDataset: ['', Validators.required],\n      joinType: ['', Validators.nullValidator],\n      commonColumn: ['', Validators.nullValidator],\n      columnsToMerge: ['', Validators.nullValidator]\n    });\n  }\n\n  /**\n   * Assigns the references after the view is initialized\n   */\n  ngAfterViewInit() {\n    this.dataSource.paginator = this.paginator;\n    this.dataSource.sort = this.sort;\n  }\n\n  /**\n   * Initial settings for the dialog\n   */\n  ngOnInit(): void {\n    if (this.dialogData.type === 'preview') {\n      this.showPreview = true;\n      this.modalHeading = 'Data Preview';\n      console.log(this.dialogData);\n      this.previewData();\n    } else {\n      this.showMergeForm = true;\n      this.modalHeading = 'Merge Data';\n      this.project = this._localStorage.getItem('project');\n      this.listAllProjectFileList(this.dialogData.data);\n    }\n  }\n  previewData() {\n    this._spinner.showSpinner();\n    let columnDefs = [];\n    this._data.myFileData(this.dialogData.reqObj.pid, this.dialogData.dataId, this.dialogData.reqObj, true).subscribe(\n      (res: any) => {\n        if (res) {\n          for (let key in res.preview[0]) {\n            columnDefs.push({\n              headerName: key,\n              field: key,\n            });\n          }\n          console.log(columnDefs);\n          this.gridOptions = {\n            headerHeight: 40,\n            columnDefs: columnDefs,\n            // rowData: res.preview,\n            defaultColDef: { resizable: true },\n          };\n\n          this.previewrowData = res.preview;\n          this._spinner.stopSpinner();\n        } else {\n          this._spinner.stopSpinner();\n          this._toaster.error('Sorry! Cannot preview the files data.', 'Data Set');\n        }\n      },\n      (err: Error) => {\n        this.showSpinner = false;\n        this._toaster.error('Server Error', 'Data Set');\n      }\n    );\n  }\n  /**\n   * Fetches list of all the files associated with a project\n   * @param fileData \n   */\n  listAllProjectFileList(fileData: any): void {\n    this.dataConnection$ = this._data.getAllProjectFileList(this.project._id).subscribe((res: any) => {\n      if (res) {\n        this.parentFile = res.find((data: any) => data._id === fileData._id ? true : false);\n\n        // Filters the files list to remove selected file from response list\n        this.dataSetList = res.filter((item: any) => item._id !== fileData._id);\n      }\n    }, (err: Error) => {\n      this._toaster.error('Server Error', 'Data Sets');\n    });\n  }\n\n  /**\n   * Calls when the data set is changed\n   * @param dataSetId \n   */\n  dataSetChanged(dataSetId: string): void {\n    this.mergeDataSet = this.dataSetList.find((data: any) => data._id === dataSetId ? true : false);\n    this.avalialbleColumnsToMerge = this.mergeDataSet.fileSchema;\n    this.commonColumns = this.parentFile.fileSchema.filter((value: any) => {\n      let found = this.mergeDataSet.fileSchema.find((item: any) => item.colName === value.colName);\n      return found;\n    });\n  }\n\n  /**\n   * Calls when the merge type is changed for form validations\n   * @param type \n   */\n  mergeTypeChanged(type: string): void {\n    if (type === 'column') {\n      this.mergeForm.get('joinType').setValidators(Validators.required);\n      this.mergeForm.get('commonColumn').setValidators(Validators.required);\n      this.mergeForm.get('columnsToMerge').setValidators(Validators.required);\n      this.mergeForm.get('joinType').updateValueAndValidity();\n      this.mergeForm.get('commonColumn').updateValueAndValidity();\n      this.mergeForm.get('columnsToMerge').updateValueAndValidity();\n    } else {\n      this.mergeForm.get('joinType').clearValidators();\n      this.mergeForm.get('commonColumn').clearValidators();\n      this.mergeForm.get('columnsToMerge').clearValidators();\n      this.mergeForm.get('joinType').updateValueAndValidity();\n      this.mergeForm.get('commonColumn').updateValueAndValidity();\n      this.mergeForm.get('columnsToMerge').updateValueAndValidity();\n    }\n  }\n\n  /**\n   * Creates a new merged file\n   * @param formValue \n   */\n  onSubmitMerge(formValue: any): void {\n    this.showSpinner = true;\n    formValue.originalFilePath = this.parentFile.filename;\n    formValue.pid = this.project._id;\n    formValue.dataGroupId = this.dialogData.data.datagroup_id;\n    formValue.mergeFilePath = this.mergeDataSet.filename;\n    formValue.parentDatasetTasks = this.parentFile.tasks;\n    formValue.mergeDatasetTasks = this.mergeDataSet.tasks;\n    formValue.mergeType = this.mergeType;\n\n    if (this.mergeType === 'row') {\n      delete formValue.columnsToMerge;\n      delete formValue.commonColumn;\n      delete formValue.joinType;\n    }\n\n    this.dataConnection$ = this._data.mergeDataSet(this.project._id, formValue).subscribe((res: any) => {\n      if (res) {\n        this.closeModal(res);\n        this.showSpinner = false;\n        this._toaster.info('Data merging started...', 'Data Sets');\n      } else {\n        this.showSpinner = false;\n        this._toaster.error('Sorry! Cannot merge the data set.', 'Data Sets');\n      }\n    }, (err: Error) => {\n      this.closeModal();\n      this.showSpinner = false;\n      this._toaster.error(err.message, 'Data Sets');\n    });\n  }\n\n  /**\n   * Called when any string is entered in search box\n   * @param event keyup event\n   */\n  applyFilter(event: Event): void {\n    const filterValue = (event.target as HTMLInputElement).value;\n    this.dataSource.filter = filterValue.trim().toLowerCase();\n    if (this.dataSource.paginator) {\n      this.dataSource.paginator.firstPage();\n    }\n  }\n\n  /**\n   * Closes the opened modal by sending the data or without data\n   */\n  closeModal(data?: any): void {\n    this._dataSetDialogRef.close(data);\n  }\n  /**\n    * Called when ng-grid is rendered in dom\n    * @param event\n    */\n  gridReady(event: any) {\n    event.api.setDomLayout(\"autoHeight\");\n    this.gridApi = event.api;\n    this.gridApi.setColumnDefs(this.gridOptions.columnDefs);\n    this.gridApi.setRowData(this.previewrowData);\n    this.gridApi.refreshCells({ force: true });\n\n  }\n  /**\n   * Unsubscribes the subscriptions, only if they were subscribed\n   */\n  ngOnDestroy() {\n    if (this.dataConnection$) {\n      this.dataConnection$.unsubscribe();\n    }\n  }\n}\n","<!-- Main container -->\n<div class=\"fluid-container\">\n  <!-- HEADER -->\n  <mat-card class=\"heading\">\n    <mat-card-header>\n      <div mat-card-avatar>\n        <i class=\"far fa-folder folder-icon\"></i>\n      </div>\n      <mat-card-title>\n        <h3\n          [matTooltip]=\"_utils.getTootip('dataSet')\"\n          [class]=\"breadcrumbArray.length ? 'heading-with-breadcrumb' : 'heading-title'\"\n          (click)=\"breadcrumbHandler('', true)\"\n          style=\"cursor: pointer\"\n        >\n          Data Sets\n        </h3>\n        <!-- Bread crumbs -->\n        <div *ngFor=\"let crumb of breadcrumbArray; last as last\" class=\"d-flex align-items-center\">\n          <!-- ICON (chevron) -->\n          <mat-icon class=\"align-middle\">chevron_right</mat-icon>\n          <!-- LABEL (breadcrumb name) -->\n          <h3\n            [class]=\"last ? 'breadcrumb-name' : 'heading-with-breadcrumb ml-0'\"\n            (click)=\"breadcrumbHandler(crumb, true)\"\n          >\n            {{ crumb.name }}\n          </h3>\n        </div>\n      </mat-card-title>\n    </mat-card-header>\n  </mat-card>\n\n  <!-- FIRST TIME -->\n  <h4 *ngIf=\"!dataSource.data.length\" class=\"text-center mt-5 font-weight-normal\">\n    You don't have any data set or connection yet,\n    <a class=\"text-decoration-none\" href=\"#\" [routerLink]=\"['/project/data/dataconnection']\"\n      >upload now.</a\n    >\n  </h4>\n\n  <!-- LIST (dataset files) -->\n  <mat-card *ngIf=\"dataSource.data.length\" class=\"files-listing mt-5 p-4\">\n    <mat-form-field class=\"search-input\">\n      <mat-label>Search</mat-label>\n      <input matInput (keyup)=\"applyFilter($event)\" #input />\n    </mat-form-field>\n    <mat-progress-spinner\n      *ngIf=\"showSpinner\"\n      class=\"spinner\"\n      [color]=\"color\"\n      [mode]=\"mode\"\n      [diameter]=\"diameter\"\n    >\n    </mat-progress-spinner>\n    <table\n      mat-table\n      [dataSource]=\"dataSource\"\n      matSort\n      matSortActive=\"createdAt\"\n      matSortDirection=\"desc\"\n      matSortDisableClear\n      class=\"mt-2\"\n    >\n      <!-- Sr. No Column -->\n      <!-- <ng-container matColumnDef=\"srNo\">\n        <th mat-header-cell *matHeaderCellDef>Sr. No.</th>\n        <td mat-cell *matCellDef=\"let row; let i = index\">\n          {{ i + 1 + dataSetPaginator.pageIndex * dataSetPaginator.pageSize }}\n        </td>\n      </ng-container> -->\n      <!-- Icons Column -->\n      <ng-container matColumnDef=\"icon\">\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef=\"let row\">\n          <i [class]=\"row.fileSource ? 'fa fa-file-alt icons mr-3' : 'fa fa-folder icons mr-3'\"></i>\n        </td>\n      </ng-container>\n\n      <!-- File name Column -->\n      <ng-container matColumnDef=\"fileName\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>\n        <td\n          mat-cell\n          *matCellDef=\"let row\"\n          [class.clickable]=\"!row.fileSource\"\n          (click)=\"breadcrumbHandler(row)\"\n        >\n          {{ row.name | dropFileExtension: row.fileSource }}\n        </td>\n      </ng-container>\n\n      <!-- Created At Column -->\n      <ng-container matColumnDef=\"createdAt\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>Created At</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.createdAt | date: 'medium' }}\n        </td>\n      </ng-container>\n\n      <!-- No. of rows Column -->\n      <ng-container matColumnDef=\"noOfRecords\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>No. of Rows</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.noOfRows ? row.noOfRows : '-' }}\n        </td>\n      </ng-container>\n\n      <!-- No. of cols Column -->\n      <ng-container matColumnDef=\"noOfColumns\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>No. of Columns</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.noOfCols ? row.noOfCols : '-' }}\n        </td>\n      </ng-container>\n\n      <!-- File size Column -->\n      <ng-container matColumnDef=\"fileSize\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>File Size</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.fileSize ? (row.fileSize | fileSizeConverter: 2) : '-' }}\n        </td>\n      </ng-container>\n\n      <!-- Actions Column -->\n      <ng-container matColumnDef=\"actions\">\n        <th mat-header-cell *matHeaderCellDef>Actions</th>\n        <td mat-cell *matCellDef=\"let row\">\n          <div *ngIf=\"row.fileSource\" class=\"action-buttons d-flex\">\n            <!-- Data preview button -->\n            <button\n              mat-icon-button\n              class=\"text-value\"\n              matTooltip=\"Preview the data\"\n              (click)=\"openDataPreviewModal(row, 'preview')\"\n            >\n              <i class=\"fa fa-eye\"></i>\n            </button>\n\n            <!-- View detail report button -->\n            <button\n              mat-icon-button\n              class=\"text-value\"\n              matTooltip=\"Preview the detailed report about the data\"\n              (click)=\"openDataReportModal(row, 'report')\"\n              *ngIf=\"\n                user?.roles?.includes('super_admin') ||\n                (user?.planType !== 'basic' && user?.planType !== 'pro')\n              \"\n            >\n              <i class=\"fas fa-file-invoice\"></i>\n            </button>\n\n            <!-- Merge data set button -->\n            <button\n              mat-icon-button\n              class=\"text-value\"\n              matTooltip=\"Merge two datasets\"\n              (click)=\"openMergeDataModal(row, 'merge')\"\n            >\n              <i class=\"fa fa-clone\"></i>\n            </button>\n\n            <!-- Delete button -->\n            <button\n              class=\"delete-button\"\n              mat-icon-button\n              matTooltip=\"Delete\"\n              (click)=\"deleteHandler(row._id)\"\n            >\n              <i class=\"fa fa-trash\"></i>\n            </button>\n          </div>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n      <tr mat-row *matRowDef=\"let row; columns: displayedColumns\"></tr>\n\n      <!-- Row shown when there is no matching data. -->\n      <tr class=\"mat-row\" *matNoDataRow>\n        <td class=\"mat-cell\" colspan=\"4\" *ngIf=\"input.value != ''\">\n          No data matching the filter \"{{ input.value }}\"\n        </td>\n        <td class=\"mat-cell\" colspan=\"4\" *ngIf=\"input.value == ''\">No data available in table</td>\n      </tr>\n    </table>\n    <!-- Paginator -->\n    <mat-paginator\n      #dataSetPaginator\n      class=\"mt-2\"\n      [pageSizeOptions]=\"pageSizeOptions\"\n    ></mat-paginator>\n  </mat-card>\n</div>\n","import { ReportsService } from './../../dashboard/reports/reports.service';\nimport { Component, OnInit, ViewChild } from '@angular/core';\nimport { ThemePalette } from '@angular/material/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { MatSort } from '@angular/material/sort';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject } from 'rxjs';\nimport { EdaReportComponent } from 'src/app/shared/components/eda-report/eda-report.component';\nimport { SpinnerService } from 'src/app/shared/spinner.service';\nimport { DataSetDialogComponent } from './data-set-dialog/data-set-dialog.component';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { DataService } from '../data.service';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { SocketIoService } from 'src/app/core/socket-io.service';\nimport { takeUntil } from 'rxjs/operators';\nimport { UtilsService } from 'src/app/shared/utils.service';\nimport { GridOptions } from 'ag-grid-community';\n\nconst swal = require('sweetalert');\n@Component({\n  selector: 'app-data-set',\n  templateUrl: './data-set.component.html',\n  styleUrls: ['./data-set.component.scss'],\n})\nexport class DataSetComponent implements OnInit {\n  /** Data table settings */\n  dataSource: MatTableDataSource<[]> = new MatTableDataSource();\n  @ViewChild(MatPaginator) set paginator(value: MatPaginator) {\n    this.dataSource.paginator = value;\n  }\n  @ViewChild(MatSort) set sort(value: MatSort) {\n    this.dataSource.sort = value;\n  }\n\n  pageSizeOptions: Array<number> = [10, 15, 20];\n  displayedColumns: Array<string> = [];\n\n  /** Usubscription subject */\n  unsubscribe$ = new Subject<boolean>();\n  gridOptions: GridOptions;\n  resizeEvent = 'resize.ag-grid';\n  /** Progress spinner settings */\n  color: ThemePalette = 'primary';\n  mode: ProgressSpinnerMode = 'indeterminate';\n  diameter = 100;\n\n  project: any;\n  user: any;\n  showSpinner: boolean = false;\n  breadcrumbArray: Array<any> = [];\n  breadArray: Array<any> = [];\n  fArr: Array<any> = [];\n  dataFilterArray: Array<any> = [];\n  previewData: any;\n\n  constructor(\n    private _toaster: ToastrService,\n    private _data: DataService,\n    private _localStorage: LocalStorageService,\n    private _spinner: SpinnerService,\n    private _dialog: MatDialog,\n    private _report: ReportsService,\n    private _sanitizer: DomSanitizer,\n    private _socket: SocketIoService,\n    public _utils: UtilsService\n  ) {\n    this.project = this._localStorage.getItem('project');\n    this.user = this._localStorage.getItem('user');\n    this.displayedColumns = [\n      // 'srNo',\n      'icon',\n      'fileName',\n      'createdAt',\n      'noOfRecords',\n      'noOfColumns',\n      'fileSize',\n      'actions',\n    ];\n  }\n\n  /**\n   * Initializes page with all the required data\n   */\n  ngOnInit(): void {\n    this._spinner.showSpinner();\n    this.initSocket();\n    this.getDataSetList();\n  }\n\n  /**\n   * Fetches the data set list\n   */\n  getDataSetList(): void {\n    let dataListArrayId: string;\n    let dataListArray: Array<any> = [];\n    this.breadArray.length = 0;\n    this.breadcrumbArray.length = 0;\n    this._data\n      .getAllProjectDatas(this.project._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            let data: Array<any> = [];\n            this.dataFilterArray = [];\n            this.dataFilterArray = this.dataFilterArray.concat(\n              res[0].dataGroupList,\n              res[0].filesList\n            );\n            dataListArray = this.dataFilterArray.filter(\n              (temp) =>\n                !Object.keys(temp).includes('parentId') &&\n                !Object.keys(temp).includes('datagroup_id')\n            );\n            dataListArrayId = dataListArray[0]._id;\n            data = this.dataFilterArray.filter(\n              (temp) =>\n                temp.fileSource != 'upload_retrained' &&\n                (temp.parentId == dataListArrayId || temp.datagroup_id == dataListArrayId)\n            );\n            this.fArr = data;\n            // Assign the data to the dataSource for the table to show records\n            this.dataSource.data = data;\n            this.dataSource._updateChangeSubscription();\n            this.dataSource.paginator = this.paginator;\n            this.dataSource.sort = this.sort;\n            this._spinner.stopSpinner();\n          } else {\n            this._spinner.stopSpinner();\n            this._toaster.error('Cannot fetch data list', 'Data Sets');\n          }\n        },\n        (err: Error) => {\n          this._spinner.stopSpinner();\n          this._toaster.error('Server Error', 'Data Sets');\n        }\n      );\n  }\n\n  /**\n   * Handles the delete operation to delete connection or datagroup\n   * @param {connection id} id\n   * @param {connection type} type\n   */\n  deleteHandler(dataSetId: string): void {\n    let content = document.createElement('div');\n    content.innerHTML =\n      'You will not be able to recover <b>' +\n      'Eda, Training and Models ' +\n      '</b> related to this dataset!';\n    swal({\n      title: 'Are you sure?',\n      content: content,\n      icon: 'warning',\n      buttons: {\n        cancel: {\n          text: 'Cancel',\n          value: null,\n          visible: true,\n          className: '',\n        },\n        confirm: {\n          text: 'Yes, delete it!',\n          value: true,\n          visible: true,\n          className: 'bg-danger',\n        },\n      },\n    }).then((isConfirm: boolean) => {\n      if (isConfirm) {\n        this.breadArray.length = 0;\n        this._data\n          .deleteDataSet(this.project._id, dataSetId)\n          .pipe(takeUntil(this.unsubscribe$))\n          .subscribe(\n            (res: any) => {\n              if (res) {\n                this.getDataSetList();\n                this._toaster.success('File deleted successfully', 'Data Sets');\n              } else {\n                this._toaster.error('Cannot delete file', 'Data Sets');\n              }\n            },\n            (err: Error) => {\n              this._toaster.error('Server Error', 'Data Sets');\n            }\n          );\n      }\n    });\n  }\n\n  /**\n   * Opens the dialog\n   * @param type preview/report/merge\n   */\n  openDialog(data: any, type: string, columns?: Array<any>): void {\n    let dialogWidth = type === 'preview' ? '80vw' : '50vw';\n    let dialodRef = this._dialog.open(DataSetDialogComponent, {\n      minWidth: dialogWidth,\n      maxWidth: '80vw',\n      data:\n        type === 'preview'\n          ? { type: type, dataId: columns, reqObj: data }\n          : {\n              type: type,\n              columns: columns,\n              data: data,\n            },\n    });\n\n    dialodRef.afterClosed().subscribe((data) => {\n      if (data) {\n        this.getDataSetList();\n      }\n    });\n  }\n\n  /**\n   * Fetches the file data and renders in dialog\n   * @param type\n   * @param data\n   */\n  openDataPreviewModal(data: any, type: string): void {\n    this.showSpinner = true;\n    let reqObj: object = {\n      dataId: data._id,\n      pid: this.project._id,\n    };\n    this.showSpinner = false;\n    this.openDialog(reqObj, 'preview', data._id);\n  }\n\n  /**\n   * Opens the EDA report dialog to render the details\n   * @param fileData\n   * @param type\n   */\n  openDataReportModal(fileData: any, type: string): void {\n    let edaReportData: object = {\n      projectId: this.project._id,\n      dataId: fileData._id,\n    };\n    /** Opens the eda report component modal to render report */\n    this._dialog.open(EdaReportComponent, {\n      minHeight: '90vh',\n      maxHeight: '90vh',\n      minWidth: '90vw',\n      data: {\n        moduleName: 'data-set',\n        edaReportData: edaReportData,\n      },\n    });\n  }\n\n  /**\n   * Opens the dialog with form to merge the data\n   * @param parentDataSetId\n   * @param datagroup\n   */\n  openMergeDataModal(fileData: any, type: string): void {\n    this.openDialog(fileData, type);\n  }\n\n  /**\n   * Handles the breadcrumbs\n   * @param dataGroupId\n   * @param name\n   * @param isChanged whether any breadcrumb is clicked to navigate\n   */\n  breadcrumbHandler(dataGroupDetails: any, isChanged?: boolean): void {\n    if (!dataGroupDetails.fileSource) {\n      let dataGroupId = dataGroupDetails._id || dataGroupDetails.id;\n      this.showSpinner = true;\n      let data: Array<any> = [];\n      let filesFilter: Array<any> = [];\n      /** If bread crum is clicked, then navigates to selected folder else create new breadcrumb */\n      if (isChanged) {\n        let index = this.breadArray.findIndex((item) => {\n          return item.id == dataGroupId;\n        });\n        this.breadArray.splice(index + 1);\n        /** If clicked on root breadcrumb */\n        if (!dataGroupDetails) {\n          this.getDataSetList();\n        }\n      } else {\n        this.breadArray.push({\n          id: dataGroupId,\n          name: dataGroupDetails.name,\n        });\n      }\n      this.breadcrumbArray = this.breadArray;\n      data = this.dataFilterArray.filter((item) => {\n        return item.parentId === dataGroupId || item.datagroup_id === dataGroupId;\n      });\n\n      filesFilter = data.filter((temp) => {\n        return !Object.keys(temp).includes('connId');\n      });\n      this.fArr = filesFilter;\n      // Assign the data to the dataSource for the table to show records\n      this.dataSource.data = filesFilter;\n      this.dataSource._updateChangeSubscription();\n      this.dataSource.paginator = this.paginator;\n      this.dataSource.sort = this.sort;\n      this.showSpinner = false;\n    }\n  }\n\n  /**\n   * Called when any string is entered in search box\n   * @param event keyup event\n   */\n  applyFilter(event: Event): void {\n    const filterValue = (event.target as HTMLInputElement).value;\n    this.dataSource.filter = filterValue.trim().toLowerCase();\n    if (this.dataSource.paginator) {\n      this.dataSource.paginator.firstPage();\n    }\n  }\n\n  /**\n   * Initializes the socket to listen events when emmited\n   */\n  initSocket(): void {\n    this._socket.listen('merge').subscribe(\n      (res: any) => {\n        if (res.status === 'pull_success') {\n          this.getDataSetList();\n          this._toaster.success('Data merged successfully', 'Data Set');\n        } else {\n          this._toaster.error(res.status, 'Data Set');\n        }\n        this._spinner.stopSpinner();\n      },\n      (err) => {\n        this._spinner.stopSpinner();\n        this._toaster.error('Socket Error', 'Data Set');\n      }\n    );\n  }\n\n  /**\n   * Perform operations when the module is destroyed\n   */\n  ngOnDestroy() {\n    this._socket.removeListener('pullData');\n    this.unsubscribe$.next(false);\n    this.unsubscribe$.unsubscribe();\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { environment } from 'src/environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataFlowService {\n  serverBaseUrl: string = environment.serverBaseUrl;\n\n  constructor(private _http: HttpClient) { }\n\n  /**\n   * Fetches all the flows list from DB\n   * @param projectId \n   * @returns \n   */\n  getAllFlowsList(projectId: string): Observable<any> {\n    return this._http.get(`${this.serverBaseUrl}/api/udd?projectId=${projectId}`);\n  }\n\n  /**\n   * Creates a new UDD flow \n   * @param flowData \n   * @returns \n   */\n  createNewFlow(flowData: any): Observable<any> {\n    return this._http.post(`${this.serverBaseUrl}/api/udd`, flowData);\n  }\n\n  /**\n   * Deletes the flow from DB\n   * @param flowId \n   * @returns \n   */\n  deleteFlow(flowId: string): Observable<any> {\n    return this._http.delete(`${this.serverBaseUrl}/api/udd/${flowId}`);\n  }\n\n  /**\n   * Fetches the single flow details from DB\n   * @param flowId \n   * @returns \n   */\n  getSingleFlow(flowId: string): Observable<any> {\n    return this._http.get(`${this.serverBaseUrl}/api/udd/${flowId}`);\n  }\n\n  /**\n   * Updates the flow\n   * @param flowId \n   * @param flowData \n   * @returns \n   */\n  updateFlow(flowId: string, flowData: any): Observable<any> {\n    return this._http.put(`${this.serverBaseUrl}/api/udd/${flowId}`, flowData);\n  }\n\n  /**\n   * Executes the data flow\n   * @param flowId \n   * @param dataGroupId \n   * @returns \n   */\n  executeDataFlow(projectId: string, flowId: string, dataGroupId: string): Observable<any> {\n    return this._http.get(`${this.serverBaseUrl}/api/project/${projectId}/udd/${flowId}/execute?dataGroupId=${dataGroupId}`);\n  }\n\n  /**\n   * Fetches the node-red error log from DB\n   * @param flowId \n   * @returns \n   */\n  getErrorLogs(flowId: string, startDate: string, endDate: string): Observable<any> {\n    return this._http.get(`${this.serverBaseUrl}/api/node-red/errorLog/${flowId}?startDate=${startDate}&endDate=${endDate}`);\n  }\n}\n","<mat-card>\n  <mat-card-content>\n    <mat-horizontal-stepper labelPosition=\"bottom\" #stepper>\n      <!-- STEP - 1 (Fill details) -->\n      <mat-step [stepControl]=\"flowFormGroup\">\n        <form [formGroup]=\"flowFormGroup\">\n          <ng-template matStepLabel>{{\n            isEdit ? 'Update Flow Details' : 'Enter Flow Details'\n            }}</ng-template>\n          <div class=\"row mt-4\">\n            <!-- Flow name input -->\n            <div class=\"col-md-4 form-group\">\n              <mat-form-field appearance=\"outline\">\n                <mat-label>Flow name</mat-label>\n                <input matInput type=\"text\" name=\"flowName\" formControlName=\"flowName\" placeholder=\"Enter flow name\"\n                  autocomplete required />\n                <mat-error *ngIf=\"\n                    flowFormGroup.get('flowName').hasError('required') &&\n                    (flowFormGroup.get('flowName').dirty || flowFormGroup.get('flowName').touched)\n                  \">Flow name is required.</mat-error>\n              </mat-form-field>\n            </div>\n\n            <!-- Select folder (dropdown) -->\n            <div *ngIf=\"flowData?.flowType === 'direct' || !isEdit\" class=\"col-md-4 form-group\">\n              <mat-form-field appearance=\"outline\">\n                <mat-label>Select folder</mat-label>\n                <mat-select formControlName=\"dataGroupId\" required>\n                  <mat-option *ngFor=\"let folder of dataGroups\" [value]=\"folder._id\">{{\n                    folder.name\n                    }}</mat-option>\n                </mat-select>\n                <mat-error *ngIf=\"\n                    flowFormGroup.get('dataGroupId').hasError('required') &&\n                    (flowFormGroup.get('dataGroupId').dirty ||\n                      flowFormGroup.get('dataGroupId').touched)\n                  \">Folder is required.</mat-error>\n              </mat-form-field>\n            </div>\n\n            <!-- Select schedular (dropdown) -->\n            <div *ngIf=\"flowData?.flowType === 'direct' || !isEdit\" class=\"col-md-4 form-group\">\n              <mat-form-field appearance=\"outline\">\n                <mat-label>Select scheduler</mat-label>\n                <mat-select formControlName=\"scheduleId\">\n                  <mat-option value=\"None\">None</mat-option>\n                  <mat-option *ngFor=\"let schedular of schedulars\" [value]=\"schedular._id\">{{ schedular.scheduleName }}\n                  </mat-option>\n                </mat-select>\n              </mat-form-field>\n            </div>\n          </div>\n          <hr />\n          <div class=\"d-flex justify-content-end mt-4\">\n            <button type=\"button\" mat-stroked-button (click)=\"closeStepperHandler()\">Cancel</button>\n            <button type=\"button\" mat-flat-button [disabled]=\"flowFormGroup.invalid\" class=\"btn-primary ml-3\"\n              matStepperNext>\n              Next\n            </button>\n          </div>\n        </form>\n      </mat-step>\n\n      <!-- STEP - 2 (Create flow in Node-Red) -->\n      <mat-step>\n        <ng-template matStepLabel>Design Data Flow</ng-template>\n        <div class=\"iframe-container mt-4\">\n          <iframe id=\"nodeRedIframe\" [src]=\"flowURL\" allowFullScreen=\"true\"></iframe>\n        </div>\n        <div class=\"d-flex justify-content-end mt-4\">\n          <button mat-stroked-button matStepperPrevious [hidden]=\"connId ? true : false\" class=\"mr-auto\">\n            Back\n          </button>\n          <button type=\"button\" mat-stroked-button (click)=\"closeStepperHandler()\">Cancel</button>\n          <button type=\"submit\" mat-flat-button class=\"btn-primary ml-3\" matStepperNext (click)=\"onSubmitFlow()\">\n            {{ isEdit ? 'Update' : 'Create' }}\n          </button>\n        </div>\n      </mat-step>\n    </mat-horizontal-stepper>\n  </mat-card-content>\n</mat-card>","import { takeUntil } from 'rxjs/operators';\nimport { DataFlowService } from './../data-flow.service';\nimport {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild,\n} from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\nimport { environment } from 'src/environments/environment';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject } from 'rxjs';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { MatHorizontalStepper } from '@angular/material/stepper';\nimport { Router } from '@angular/router';\n\ndeclare let $: any;\n\n@Component({\n  selector: 'app-data-flow-stepper',\n  templateUrl: './data-flow-stepper.component.html',\n  styleUrls: ['./data-flow-stepper.component.scss'],\n})\nexport class DataFlowStepperComponent implements OnInit {\n  @Input() flowData: any;\n  @Input() dataGroups: Array<any>;\n  @Input() schedulars: Array<any>;\n  @Input() connId: string;\n  @Input() flowIdToEdit: string;\n  @Output() closeNodeRed = new EventEmitter<object>();\n  @ViewChild('myiframe', { static: false }) iframe: ElementRef;\n  @ViewChild(MatHorizontalStepper) stepper: MatHorizontalStepper;\n\n  /** Usubscription subject */\n  unsubscribe$ = new Subject<boolean>();\n\n  serverBaseUrl: string = environment.serverBaseUrl;\n  flowFormGroup: FormGroup;\n  flowURL: SafeHtml;\n  isEdit: boolean = false;\n  project: any;\n  doc: any;\n\n  constructor(\n    private _formBuilder: FormBuilder,\n    private _sanitizer: DomSanitizer,\n    private _dataFlow: DataFlowService,\n    private _toaster: ToastrService,\n    private _localStorage: LocalStorageService,\n    private _router: Router\n  ) {\n    this.flowFormGroup = this._formBuilder.group({\n      flowName: ['', Validators.required],\n      dataGroupId: ['', Validators.required],\n      scheduleId: [''],\n    });\n  }\n\n  /**\n   * Initializes the page with required data\n   */\n  ngOnInit() {\n    this.project = this._localStorage.getItem('project');\n    this.prefillFlowDetails(this.flowData, this.flowIdToEdit);\n    this.flowURL = this._sanitizer.bypassSecurityTrustResourceUrl(`${this.serverBaseUrl}/!/`);\n  }\n\n  /**\n   * Initializes the node-red for interceptor flow type\n   */\n  ngAfterViewInit() {\n    if (this.connId) {\n      this.stepper.next();\n    }\n  }\n\n  /**\n   * Handles the operations when the stepper is closed\n   */\n  closeStepperHandler(): void {\n    if (this.connId || this.flowIdToEdit) {\n      this._router.navigateByUrl('/project/data/dataconnection');\n    } else {\n      this.closeNodeRed.emit({ isCanceled: true });\n    }\n  }\n\n  /**\n   * Prefills the flow details form for edit operation\n   * @param flowData\n   */\n  prefillFlowDetails(flowData: any, flowIdToEdit?: string): void {\n    if (flowData || flowIdToEdit) {\n      this.isEdit = true;\n      this.flowFormGroup.patchValue({\n        flowName: flowData ? flowData.flowName : '',\n        dataGroupId: flowData ? flowData.dataGroupId : '',\n        scheduleId: flowData ? flowData.scheduleId : '',\n      });\n      this.findOneFlow(flowData ? flowData._id : flowIdToEdit);\n    } else {\n      this.isEdit = false;\n      this.flowFormGroup.reset();\n    }\n  }\n\n  /**\n   * To prohibit user to save a flow without any node in iframe\n   */\n  validateFlow(): boolean {\n    if (window.frames['myiframe'].contentDocument.getElementsByClassName('red-ui-header-toolbar')) {\n      let iframeHtml =\n        window.frames['myiframe'].contentDocument.getElementsByClassName('red-ui-header-toolbar');\n      if (!iframeHtml[0].innerHTML.includes('red-ui-deploy-button disabled')) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  }\n\n  /**\n   * Handles the flow submition as per the functionality - edit/create\n   */\n  onSubmitFlow(): void {\n    // const iframe = document.getElementById(\"myiframe\");\n    // const iframe = document.getElementById('myiframe');\n    // console.log(\" ~ onSubmitFlow ~ iframe\", iframe[0]);\n\n    // // console.log(\" ~ onSubmitFlow ~ iframe\", iframe[0].iframe.contentDocument);\n    // // console.log(\" ~ onSubmitFlow ~ iframe\", iframe[0].contentWindow.document);\n\n    // let btn_deploy = iframe.getElementsByClassName('red-ui-deploy-button-group');\n    // // console.log(\" ~ createNewFlow ~ btn_deploy\", btn_deploy);\n\n    // let urlString = document.getElementById(\"myiframe\")[0].contentWindow.location.href;\n    // // console.log(\" ~ createNewFlow ~ urlString\", urlString);\n\n    // let position = urlString.lastIndexOf(\"/\");\n    // let flowId = urlString.substring(position + 1, urlString.length);\n    // // btn_deploy.click();\n\n    // // {\n    // //   \"stack\": \"Error: Blocked a frame with origin \\\"http://localhost:4200\\\" from accessing a cross-origin frame.\\n    at o (<anonymous>:1:83)\"\n    // // }\n    // console.log(iframe.querySelectorAll('#red-ui-header'));\n\n    // let od = $('iframe');\n    // console.log(\" ~ onSubmitFlow ~ od\", od);\n\n    // $(od)\n    //   .contents()\n    //   .find('*')\n    //   .each(function (i, item) {\n    //     console.log(item);\n\n    //     if ($(item).is('#red-ui-header-button-deploy')) {\n    //       console.log('got button');\n\n    //     }\n    //   })\n\n    let iframe: any = $('#nodeRedIframe');\n    let btn_deploy = iframe.contents().find('#red-ui-header-button-deploy')[0];\n\n    let urlString = iframe[0].contentWindow.location.href;\n\n    let position = urlString.lastIndexOf('/');\n    let flowId = urlString.substring(position + 1, urlString.length);\n    btn_deploy.click();\n    if (flowId == '#' || flowId == '' || undefined) {\n      alert('Something went wrong, please refresh');\n    }\n\n    let reqObj: any = {\n      flowName: this.flowFormGroup.value.flowName,\n      flowId: flowId,\n      flowType: this.connId ? 'interceptor' : 'direct',\n      projectId: this.project._id,\n      connectionID: this.connId ? this.connId : null,\n      dataGroupId: this.flowFormGroup.value.dataGroupId,\n    };\n    //if schedulerId is present add the schedulerId key\n    this.flowFormGroup.value.scheduleId &&\n      (reqObj.scheduleId = this.flowFormGroup.value.scheduleId);\n\n    /** Creates dynamic request object as per the flow types */\n    if (this.connId) {\n      // delete reqObj.flowName;\n      delete reqObj.scheduleId;\n      delete reqObj.dataGroupId;\n    } else {\n      delete reqObj.connectionID;\n    }\n\n    if (this.isEdit) {\n      reqObj.flowType = this.flowData.flowType;\n      if (!this.flowData.dataGroupId) {\n        delete reqObj.dataGroupId;\n      }\n      this.updateFlow(reqObj);\n    } else {\n      this.createNewFlow(reqObj);\n    }\n  }\n\n  /**\n   * Creates a new UDD flow\n   */\n  createNewFlow(flowData: any): void {\n    this._dataFlow\n      .createNewFlow(flowData)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this._toaster.success('Data flow created successfully', 'Data Flows');\n            this.closeNodeRed.emit({ flowResponse: res, isCanceled: true });\n          }\n        },\n        (err: Error) => {\n          this._toaster.error(err.message, 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Updates the flow by triggering API\n   * @param flowData\n   */\n  updateFlow(flowData: any): void {\n    let flowIdToUpdate = this.flowData._id || this.flowIdToEdit;\n    this._dataFlow\n      .updateFlow(flowIdToUpdate, flowData)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this._toaster.success('Data flow updated successfully', 'Data Flows');\n            this.closeNodeRed.emit({ flowResponse: res, isCanceled: true });\n          }\n        },\n        (err: Error) => {\n          this._toaster.error(err.message, 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Fetches the single existing Udd Flow data from DB\n   * @param flowId\n   */\n  findOneFlow(flowId: any): void {\n    this._dataFlow\n      .getSingleFlow(flowId)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.flowData = res;\n            this.flowFormGroup.get('flowName').setValue(res.flowName);\n            this.flowFormGroup.get('dataGroupId').clearValidators();\n            this.flowFormGroup.get('dataGroupId').updateValueAndValidity();\n            this.flowURL = this._sanitizer.bypassSecurityTrustResourceUrl(\n              `${this.serverBaseUrl}/!/#flow/${res.flowId}`\n            );\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Cannot fetch flows details', 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Unsubscribes the subscriptions after destroy\n   */\n  ngOnDestroy() {\n    this.unsubscribe$.next(false);\n    this.unsubscribe$.unsubscribe();\n  }\n}\n","<!-- Main container -->\n<div class=\"fluid-container\">\n  <!-- HEADER -->\n  <mat-card class=\"heading\">\n    <mat-card-header>\n      <div mat-card-avatar>\n        <mat-icon class=\"folder-icon\">account_tree</mat-icon>\n      </div>\n      <mat-card-title>\n        <h3 class=\"heading-title\">Data Flows</h3>\n      </mat-card-title>\n      <!-- BUTTON (new flow) -->\n      <button\n        *ngIf=\"!showStepper\"\n        mat-raised-button\n        class=\"bg-primary ml-auto\"\n        (click)=\"inputFlowData = null; showStepper = true\"\n      >\n        Create\n      </button>\n    </mat-card-header>\n  </mat-card>\n\n  <!-- FIRST TIME -->\n  <h4 *ngIf=\"!showStepper && !dataSource.data.length\" class=\"text-center mt-5 font-weight-normal\">\n    You haven't created any data flow yet,\n    <a class=\"text-decoration-none\" href=\"#\" (click)=\"inputFlowData = null; showStepper = true\">\n      create now.</a\n    >\n  </h4>\n\n  <!-- LIST (data flows) -->\n  <mat-card *ngIf=\"!showStepper && dataSource.data.length\" class=\"flows-listing mt-5 p-4\">\n    <mat-card-content>\n      <!-- Search input -->\n      <mat-form-field class=\"search-input\">\n        <mat-label>Search</mat-label>\n        <input matInput (keyup)=\"applyFilter($event)\" #input />\n      </mat-form-field>\n      <table  mat-table [dataSource]=\"dataSource\" class=\"mt-2\" matSort #dataflowSort=\"matSort\" matSortDisableClear>\n        <!-- Sr. No. Column -->\n        <ng-container matColumnDef=\"srNo\">\n          <th mat-header-cell *matHeaderCellDef>Sr. No.</th>\n          <td mat-cell *matCellDef=\"let row; let i = index\">\n            {{ i + 1 + flowPaginator.pageIndex * flowPaginator.pageSize }}\n          </td>\n        </ng-container>\n\n        <!-- Flow name Column -->\n        <ng-container matColumnDef=\"flowName\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>\n          <td mat-cell *matCellDef=\"let row\">\n            {{ row.flowName }}\n          </td>\n        </ng-container>\n\n        <!-- Flow Id Column -->\n        <ng-container matColumnDef=\"flowId\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Flow Id</th>\n          <td mat-cell *matCellDef=\"let row\">\n            {{ row.flowId }}\n          </td>\n        </ng-container>\n\n        <!-- Flow type Column -->\n        <ng-container matColumnDef=\"flowType\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Flow Type</th>\n          <td mat-cell *matCellDef=\"let row\">\n            {{ row.flowType }}\n          </td>\n        </ng-container>\n\n        <!-- Actions Column -->\n        <ng-container matColumnDef=\"actions\">\n          <th mat-header-cell *matHeaderCellDef>Actions</th>\n          <td mat-cell *matCellDef=\"let row\">\n            <div class=\"action-buttons d-flex\">\n              <!-- Start flow button -->\n              <button\n                matTooltip=\"Start data flow\"\n                *ngIf=\"row.flowType === 'direct'\"\n                mat-icon-button\n                class=\"text-value\"\n                (click)=\"startFlow(row)\"\n              >\n                <i class=\"fa fa-play\"></i>\n              </button>\n\n              <!-- Edit flow button -->\n              <button\n                matTooltip=\"Edit data flow\"\n                mat-icon-button\n                class=\"text-value\"\n                (click)=\"editFlow(row)\"\n              >\n                <i class=\"fa fa-edit\"></i>\n              </button>\n\n              <!-- Flow error log file -->\n              <button\n                matTooltip=\"View logs\"\n                [matTooltipClass]=\"\n                  isDataFlowFailed && directFlowNameCheck == row.flowId\n                    ? 'nodered-error-tooltip-custom'\n                    : ''\n                \"\n                mat-icon-button\n                class=\"text-value\"\n                (click)=\"viewNodeRedLogs(row, errorLogsTemplate)\"\n              >\n                <i class=\"fas fa-file-invoice\"></i>\n                <i\n                  *ngIf=\"isDataFlowFailed && directFlowNameCheck == row.flowId\"\n                  class=\"nodered-error fas fa-exclamation-circle\"\n                ></i>\n              </button>\n\n              <!-- Delete button -->\n              <button\n                matTooltip=\"Remove data flow\"\n                class=\"delete-button\"\n                mat-icon-button\n                (click)=\"deleteHandler(row._id)\"\n              >\n                <i class=\"fa fa-trash\"></i>\n              </button>\n            </div>\n          </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumns\"></tr>\n\n        <!-- Row shown when there is no matching data. -->\n        <tr class=\"mat-row\" *matNoDataRow>\n          <td class=\"mat-cell\" colspan=\"4\" *ngIf=\"input.value != ''\">\n            No data matching the filter \"{{ input.value }}\"\n          </td>\n          <td class=\"mat-cell\" colspan=\"4\" *ngIf=\"input.value == ''\">No data available in table</td>\n        </tr>\n      </table>\n      <!-- Paginator -->\n      <mat-paginator\n        #flowPaginator\n        class=\"mt-2\"\n        [pageSizeOptions]=\"pageSizeOptions\"\n      ></mat-paginator>\n    </mat-card-content>\n  </mat-card>\n\n  <!-- Data flow stepper section -->\n  <div *ngIf=\"showStepper\" class=\"mt-5\">\n    <app-data-flow-stepper\n      [flowData]=\"inputFlowData\"\n      [dataGroups]=\"dataGroupList\"\n      [schedulars]=\"schedularsList\"\n      [connId]=\"connId\"\n      [flowIdToEdit]=\"flowIdToEdit\"\n      (closeNodeRed)=\"nodeRedClosed($event)\"\n    ></app-data-flow-stepper>\n  </div>\n</div>\n\n<!-- Error log dialog -->\n<ng-template #errorLogsTemplate>\n  <h2 mat-dialog-title class=\"selected-flow\">\n    Data Flow Error Logs :\n    <mat-chip-list class=\"ml-2\">\n      <mat-chip>{{ selectedFlow.flowName }}</mat-chip>\n    </mat-chip-list>\n  </h2>\n\n  <!-- Date range picker -->\n  <div class=\"row mt-3\">\n    <div class=\"col-md-6\">\n      <mat-form-field appearance=\"outline\">\n        <mat-label>Select date (From and To)</mat-label>\n        <mat-date-range-input [formGroup]=\"dateGroup\" [rangePicker]=\"picker\">\n          <input\n            matStartDate\n            formControlName=\"start\"\n            placeholder=\"Start date\"\n            (dateChange)=\"dateChanged('start', $event.value)\"\n          />\n          <input\n            matEndDate\n            formControlName=\"end\"\n            placeholder=\"End date\"\n            (dateChange)=\"dateChanged('end', $event.value)\"\n          />\n        </mat-date-range-input>\n        <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n        <mat-date-range-picker #picker></mat-date-range-picker>\n\n        <mat-error\n          *ngIf=\"\n            dateGroup.controls.start.hasError('matStartDateInvalid') ||\n            dateGroup.controls.end.hasError('matEndDateInvalid')\n          \"\n          >Invalid start/end date.</mat-error\n        >\n        <mat-error\n          *ngIf=\"\n            (dateGroup.controls.start.dirty ||\n              dateGroup.controls.end.dirty ||\n              dateGroup.controls.start.touched ||\n              dateGroup.controls.end.touched) &&\n            (!dateGroup.controls.start.hasError('matStartDateInvalid') ||\n              !dateGroup.controls.end.hasError('matEndDateInvalid'))\n          \"\n          >Date range is required.</mat-error\n        >\n      </mat-form-field>\n    </div>\n  </div>\n\n  <mat-dialog-content class=\"mat-typography mt-4\">\n    <!-- Search input -->\n    <mat-form-field class=\"search-input\">\n      <mat-label>Search</mat-label>\n      <input matInput (keyup)=\"applyFilter($event)\" placeholder=\"Enter value to search\" #input />\n    </mat-form-field>\n\n    <table mat-table [dataSource]=\"logsDataSource\" matSort matSortDisableClear>\n      <!-- Date Column -->\n      <ng-container matColumnDef=\"date\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.createdAt | date: 'medium' }}\n        </td>\n      </ng-container>\n\n      <!-- Level Column -->\n      <ng-container matColumnDef=\"level\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>Level</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.level }}\n        </td>\n      </ng-container>\n\n      <!-- Node Column -->\n      <ng-container matColumnDef=\"node\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>Node</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.metaData.nodeType }}\n        </td>\n      </ng-container>\n\n      <!-- Description Column -->\n      <ng-container matColumnDef=\"message\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>Message</th>\n        <td mat-cell *matCellDef=\"let row\">\n          {{ row.message }}\n        </td>\n      </ng-container>\n      <tr mat-header-row *matHeaderRowDef=\"logsDisplayedColumns\"></tr>\n      <tr mat-row *matRowDef=\"let row; columns: logsDisplayedColumns\"></tr>\n\n      <!-- Row shown when there is no matching data. -->\n      <tr class=\"mat-row\" *matNoDataRow>\n        <td class=\"mat-cell\" colspan=\"4\">No data matching the filter \"{{ input.value }}\"</td>\n      </tr>\n    </table>\n\n    <!-- Paginator -->\n    <mat-paginator [pageSizeOptions]=\"pageSizeOptions\"></mat-paginator>\n  </mat-dialog-content>\n  <mat-dialog-actions class=\"justify-content-end m-auto\">\n    <button mat-stroked-button mat-dialog-close>Close</button>\n  </mat-dialog-actions>\n</ng-template>\n","import { SchedularService } from './../../dashboard/schedular/schedular.service';\nimport { DataFlowService } from './data-flow.service';\nimport {\n  Component,\n  OnInit,\n  ViewChild,\n  TemplateRef,\n  AfterViewInit,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSort } from '@angular/material/sort';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject } from 'rxjs';\nimport { SpinnerService } from 'src/app/shared/spinner.service';\nimport { takeUntil } from 'rxjs/operators';\nimport { MatDialog } from '@angular/material/dialog';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { DataService } from '../data.service';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { SocketIoService } from 'src/app/core/socket-io.service';\nimport { UtilsService } from 'src/app/shared/utils.service';\n\nconst swal = require('sweetalert');\nconst moment = require('moment');\n@Component({\n  selector: 'app-data-flow',\n  templateUrl: './data-flow.component.html',\n  styleUrls: ['./data-flow.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n})\nexport class DataFlowComponent implements OnInit {\n  /** Data table settings */\n  dataSource: MatTableDataSource<[]> = new MatTableDataSource();\n  logsDataSource: MatTableDataSource<[]> = new MatTableDataSource();\n  @ViewChild('flowPaginator') set paginator(value: MatPaginator) {\n    this.dataSource.paginator = value;\n  }\n  @ViewChild('dataflowSort') set sort(value: MatSort) {\n    this.dataSource.sort = value;\n  }\n\n  pageSizeOptions: Array<number> = [10, 15, 20];\n  displayedColumns: Array<string> = [];\n  logsDisplayedColumns: Array<string> = [];\n\n  /** Usubscription subject */\n  unsubscribe$ = new Subject<boolean>();\n\n  project: any;\n  user: any;\n  showStepper: boolean = false;\n  hideDialog: boolean = true;\n  uddFlowsList: Array<any>;\n  inputFlowData: any;\n  dataGroupList: Array<any>;\n  schedularsList: Array<any>;\n  errorLogs: Array<any>;\n  selectedFlow: any;\n  dateGroup: FormGroup;\n  dateRange: any = {};\n  connId: string;\n  flowIdToEdit: string;\n  isDataFlowFailed: boolean = false;\n  directFlowNameCheck: string = null;\n\n  constructor(\n    private _toaster: ToastrService,\n    private _data: DataService,\n    private _localStorage: LocalStorageService,\n    private _spinner: SpinnerService,\n    private _dataFlow: DataFlowService,\n    private _schedular: SchedularService,\n    private _dialog: MatDialog,\n    private _activatedRoute: ActivatedRoute,\n    private _socket: SocketIoService,\n    private _router: Router,\n    public _utils: UtilsService\n  ) {\n    this.project = this._localStorage.getItem('project');\n    this.user = this._localStorage.getItem('user');\n    /** Handles the stepper when user try to create/update flow from data-connection page */\n    if (this._activatedRoute.queryParams) {\n      this._activatedRoute.queryParams.subscribe((val) => {\n        if (val.connectionId) {\n          this.connId = val.connectionId;\n          this.showStepper = true;\n        } else if (val.dataFlowId) {\n          this.flowIdToEdit = val.dataFlowId;\n          this.showStepper = true;\n        } else {\n          this.showStepper = false;\n        }\n      });\n    }\n    this.displayedColumns = ['srNo', 'flowName', 'flowId', 'flowType', 'actions'];\n    this.logsDisplayedColumns = ['date', 'level', 'node', 'message'];\n    /** Date input form instance */\n    this.dateGroup = new FormGroup({\n      start: new FormControl('', Validators.required),\n      end: new FormControl('', Validators.required),\n    });\n  }\n\n  /**\n   * Assigns the references after the view is initialized\n   */\n  // ngAfterViewInit() {\n  //   this.dataSource.paginator = this.paginator;\n  //   this.dataSource.sort = this.sort;\n  // }\n\n  /**\n   * Initialize page with all the required data\n   */\n  ngOnInit(): void {\n    this._spinner.showSpinner();\n    this.initSocket();\n    this.getFlowsList();\n    this.getDataGroupList();\n    this.schedularList();\n    this.dateGroup.get('start').setValue(moment().subtract(3, 'days'));\n    this.dateGroup.get('end').setValue(moment());\n  }\n\n  /**\n   * Fetches all the flows list from DB\n   */\n  getFlowsList(): void {\n    this._dataFlow\n      .getAllFlowsList(this.project._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.uddFlowsList = res;\n            this.dataSource.data = res;\n            this.dataSource.paginator = this.paginator;\n            this.dataSource.sort = this.sort;\n            this.dataSource._updateChangeSubscription();\n            console.log(' ~ this.dataSource', this.dataSource);\n            this._spinner.stopSpinner();\n          } else {\n            this._spinner.stopSpinner();\n          }\n        },\n        (err: Error) => {\n          this._spinner.stopSpinner();\n          this._toaster.error('Server Error', 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Fetches all the data groups list\n   */\n  getDataGroupList(): void {\n    this._data\n      .getDataGroupsList(this.project._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.dataGroupList = res;\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Fetches all the schedulars list\n   */\n  schedularList(): void {\n    this._schedular\n      .getSchedularsList()\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.schedularsList = res;\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Starts the execution of the flow\n   * @param uddFlow\n   */\n  startFlow(flowData: any): void {\n    this.directFlowNameCheck = flowData.flowId;\n    this._dataFlow\n      .executeDataFlow(this.project._id, flowData._id, flowData.dataGroupId)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this._toaster.success('Flow execution started', 'Data Flows');\n          }\n        },\n        (err: Error) => {\n          this._toaster.error(err.message, 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Called when the start/end date is changed\n   * @param type\n   * @param value\n   */\n  dateChanged(type: string, value: any): void {\n    if (type === 'start') {\n      this.dateRange.startDate = value;\n    } else {\n      this.dateRange.endDate = value;\n    }\n    if (this.dateRange.endDate) {\n      this.getNodeRedLogs(this.selectedFlow._id, this.dateRange.startDate, this.dateRange.endDate);\n    }\n  }\n\n  /**\n   * Get the list of logs present in the auditlog from DB and renders it in the dialog\n   * @param flowData\n   * @param errorLogsTemplate\n   */\n  viewNodeRedLogs(flowData: any, errorLogsTemplate: TemplateRef<any>): void {\n    this.selectedFlow = flowData;\n    let startDate = this.dateGroup.get('start').value;\n    let endDate = this.dateGroup.get('end').value;\n    this.getNodeRedLogs(flowData._id, startDate, endDate);\n    this.hideDialog = false;\n    this._dialog.open(errorLogsTemplate, {\n      height: 'auto',\n      width: '60%',\n    });\n  }\n\n  /**\n   * Fetches the error logs from DB as per the specified date\n   * @param flowId\n   * @param startDate\n   * @param endDate\n   */\n  getNodeRedLogs(flowId: string, startDate: string, endDate: string): void {\n    this._dataFlow\n      .getErrorLogs(flowId, moment.utc(startDate).format(), moment.utc(endDate).format())\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.errorLogs = res;\n            this.logsDataSource.data = this.errorLogs;\n            this.logsDataSource.paginator = this.paginator;\n            this.logsDataSource.sort = this.sort;\n          } else {\n            this._toaster.error('Cannot fetch error logs', 'Data Flows');\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Flows');\n        }\n      );\n  }\n\n  /**\n   * Opens the stepper to edits the flow\n   * @param flowData\n   */\n  editFlow(flowData: any): void {\n    this.showStepper = true;\n    this.inputFlowData = flowData;\n  }\n\n  /**\n   * Deletes the data flow\n   * @param {connection id} id\n   * @param {connection type} type\n   */\n  deleteHandler(flowId: string): void {\n    swal({\n      title: 'Are you sure?',\n      text: 'You will not be able to recover this data flow!',\n      icon: 'warning',\n      buttons: {\n        cancel: {\n          text: 'Cancel',\n          value: null,\n          visible: true,\n          className: '',\n        },\n        confirm: {\n          text: 'Yes, delete it!',\n          value: true,\n          visible: true,\n          className: 'bg-danger',\n        },\n      },\n    }).then((isConfirm: boolean) => {\n      if (isConfirm) {\n        this._dataFlow\n          .deleteFlow(flowId)\n          .pipe(takeUntil(this.unsubscribe$))\n          .subscribe(\n            (res: any) => {\n              if (res) {\n                this.uddFlowsList = this.uddFlowsList.filter((item: any) => item._id !== flowId);\n                this.dataSource.data = this.uddFlowsList;\n                this.dataSource._updateChangeSubscription();\n                this.dataSource.paginator = this.paginator;\n                this.dataSource.sort = this.sort;\n                this._toaster.success(`${res.flowName} deleted successfully`, 'Data Flows');\n              } else {\n                this._toaster.error('Sorry! Cannot delete the flow', 'Data Flows');\n              }\n            },\n            (err: Error) => {\n              this._toaster.error('Server Error', 'Data Flows');\n            }\n          );\n      }\n    });\n  }\n\n  /**\n   * Function is called when node-red stepper is closed or cancelled\n   * @param event\n   */\n  nodeRedClosed(event: any): void {\n    if (event.flowResponse) {\n      this.showStepper = !event.isCanceled;\n      this.flowIdToEdit = '';\n      this.connId = '';\n      this.inputFlowData = [];\n      this._spinner.stopSpinner();\n      this._router.navigate(['/project/data/dataflow']);\n      this.getFlowsList();\n    } else {\n      this.flowIdToEdit = '';\n      this.connId = '';\n      this.inputFlowData = [];\n      this.showStepper = !event.isCanceled;\n    }\n  }\n\n  /**\n   * Called when any string is entered in search box\n   * @param event keyup event\n   */\n  applyFilter(event: Event): void {\n    const filterValue = (event.target as HTMLInputElement).value;\n    this.dataSource.filter = filterValue.trim().toLowerCase();\n    if (this.dataSource.paginator) {\n      this.dataSource.paginator.firstPage();\n    }\n  }\n\n  /**\n   * Initializes the socket to listen events when emmited\n   */\n  initSocket(): void {\n    // Listens to the pull data event\n    this._socket.listen('pullData').subscribe(\n      (res: any) => {\n        this._spinner.stopSpinner();\n        if (res.status === 'pull_success') {\n          (res.data.projectId === this.project._id) && this._toaster.success('Flow execution completed successfully', 'Data Flows');\n          (res.data.projectId === this.project._id) && this._router.navigate(['/project/data/dataset']);\n        } else {\n          (res.data.projectId === this.project._id) && this._toaster.success(res.err_msg, 'Data Flows');\n        }\n      },\n      (err) => {\n        this._spinner.stopSpinner();\n        this._toaster.error('Socket Error', 'Data Flows');\n      }\n    );\n\n    // Listens to node-red event\n    this._socket.listen('nodeRedFlowExecution').subscribe(\n      (res: any) => {\n        if (res.status === 'flow_execution_failed') {\n          this.isDataFlowFailed = true;\n        }\n        this._spinner.stopSpinner();\n      },\n      (err) => {\n        this._spinner.stopSpinner();\n        this._toaster.error('Socket Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Perform operations when the module is destroyed\n   */\n  ngOnDestroy() {\n    this._socket.removeListener('pullData');\n    this._socket.removeListener('nodeRedFlowExecution');\n    this.unsubscribe$.next(false);\n    this.unsubscribe$.unsubscribe();\n  }\n}\n","<div class=\"mat-typography\">\n  <form [formGroup]=\"fileUploadForm\" role=\"form\" class=\"form-validate\" name=\"fileUploadForm\">\n    <div class=\"row\">\n      <!-- Select encoding -->\n      <div class=\"col-md-6 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select encoding</mat-label>\n          <mat-select formControlName=\"encoding\" required>\n            <mat-option value=\"utf_8\">utf_8</mat-option>\n            <mat-option value=\"latin_1\">latin_1</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              fileUploadForm.get('encoding').hasError('required') &&\n              (fileUploadForm.get('encoding').dirty || fileUploadForm.get('encoding').touched)\n            \">Encoding is required.</mat-error>\n        </mat-form-field>\n      </div>\n\n      <!-- Select folder -->\n      <div class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select folder</mat-label>\n          <mat-select formControlName=\"selectFolder\" (selectionChange)=\"selectedFolder = $event.value\" required>\n            <mat-option value=\"Add\">Create new folder</mat-option>\n            <mat-option *ngFor=\"let folder of dataGroupsArray\" [value]=\"folder._id\">{{\n              folder.name\n              }}</mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Add new folder block -->\n    <div *ngIf=\"selectedFolder === 'Add'\">\n      <div class=\"row\">\n        <div class=\"col-md-6 form-group\">\n          <!-- Folder name input -->\n          <mat-form-field appearance=\"outline\">\n            <mat-label for=\"dataFolderName\">Folder name</mat-label>\n            <input matInput type=\"text\" name=\"dataFolderName\" id=\"dataFolderName\" formControlName=\"dataFolderName\"\n              placeholder=\"Enter folder name\" required />\n            <mat-error *ngIf=\"\n                fileUploadForm.get('dataFolderName').hasError('required') &&\n                (fileUploadForm.get('dataFolderName').dirty ||\n                  fileUploadForm.get('dataFolderName').touched)\n              \">Folder name is required.\n            </mat-error>\n          </mat-form-field>\n        </div>\n        <div class=\"col-md-6 form-group\">\n          <!-- Parent folder selection -->\n          <mat-form-field appearance=\"outline\">\n            <mat-label>Select parent folder</mat-label>\n            <mat-select formControlName=\"parentFolderName\" required>\n              <mat-option *ngFor=\"let folder of dataGroupsArray\" [value]=\"folder._id\">{{\n                folder.name\n                }}</mat-option>\n            </mat-select>\n            <mat-error *ngIf=\"\n                fileUploadForm.get('parentFolderName').hasError('required') &&\n                (fileUploadForm.get('parentFolderName').dirty ||\n                  fileUploadForm.get('parentFolderName').touched)\n              \">Parent folder is required.</mat-error>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n\n    <!-- Select the input file -->\n    <div class=\"form-group mb-4\">\n      <input type=\"file\" name=\"file\" accept=\".csv,.zip,.xlsx,.xls,.pkl,.pk,.pl,.pickle,.json,.html\"\n        (change)=\"handleFileInput($event.target.files,fileUploadForm.value)\" />\n    </div>\n    <!-- <mat-hint>Note: Only UTF-8 encoding files are allowed.</mat-hint> -->\n  </form>\n  <div class=\"my-3 d-flex align-items-center\" *ngIf=\"percentDone\">\n    <mat-progress-bar *ngIf=\"percentDone\" color=\"#07509d\" [value]=\"percentDone\">\n    </mat-progress-bar> <span class=\"ml-1\">{{percentDone}}%</span>\n    <!-- <div class=\"d-flex\">\n     \n    </div> -->\n  </div>\n\n</div>\n<hr />\n<!-- <div class=\"progress\" *ngIf=\"percentDone\">\n  <div class=\"progress-bar\" [style.width]=\"percentDone + '%'\">{{percentDone}}%</div>\n</div> -->\n<div class=\"d-flex justify-content-end m-auto\">\n  <button mat-stroked-button class=\"mr-auto\" (click)=\"goBack()\">Back</button>\n  <button mat-stroked-button mat-dialog-close>Cancel</button>\n  <!-- <button mat-flat-button [disabled]=\"(fileUploadForm.invalid && selectedFolder === 'Add') || !fileToUpload\"\n    class=\"btn-primary ml-3\" type=\"submit\" (click)=\"createConnection(fileUploadForm.value)\">\n    Create\n  </button> -->\n</div>","import { UtilsService } from 'src/app/shared/utils.service';\nimport { HttpErrorResponse, HttpEventType } from '@angular/common/http';\nimport { SpinnerService } from './../../../../shared/spinner.service';\nimport { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { DataConnectionComponent } from '../data-connection.component';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject, Subscription } from 'rxjs';\nimport { DataService } from '../../data.service';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { environment } from 'src/environments/environment';\nimport { toasterMsg } from 'src/app/shared/static-data';\nimport { takeUntil } from 'rxjs/operators';\n@Component({\n  selector: 'app-file-upload-form',\n  templateUrl: './file-upload-form.component.html',\n  styleUrls: ['./file-upload-form.component.scss'],\n})\nexport class FileUploadFormComponent implements OnInit {\n  @Output() goBackFlag = new EventEmitter<boolean>();\n  @Input() dataGroupsArray: Array<any>;\n  @Input() currentDataGroup: string;\n\n  /** Usubscription subject */\n  unsubscribe$ = new Subject<boolean>();\n\n  // Progress spinner settings\n  // color: ThemePalette = \"primary\";\n  //color = 'primary'\n  mode: ProgressSpinnerMode = 'indeterminate';\n  diameter = 100;\n  exportProjectDiameter = 50;\n\n  fileUploadForm: FormGroup;\n  fileToUpload: any;\n  project: any;\n  selectedFolder: any;\n  fileUploadApi: string;\n  user: any;\n  //configure it to change the file size - this is in mb.\n  allowedPSFileUploadSize: number;\n  progress: number;\n  serverBaseUrl = environment.serverBaseUrl;\n  percentDone;\n  constructor(\n    private _fb: FormBuilder,\n    private _data: DataService,\n    private _localStorage: LocalStorageService,\n    private _connectionDialogRef: MatDialogRef<DataConnectionComponent>,\n    private _toaster: ToastrService,\n    private _snackbar: MatSnackBar,\n    private _spinner: SpinnerService,\n    private _utils: UtilsService\n  ) {\n    this.project = this._localStorage.getItem('project');\n    this.user = this._localStorage.getItem('user');\n    this.allowedPSFileUploadSize = this.user?.psFeatures?.allowedPSFileUploadSize || 50;\n    this.fileUploadForm = this._fb.group({\n      encoding: ['utf_8', Validators.required],\n      selectFolder: ['', Validators.required],\n      dataFolderName: ['', Validators.required],\n      parentFolderName: ['', Validators.required],\n    });\n  }\n\n  /**\n   * Sets the default values\n   */\n  ngOnInit(): void {\n    this.fileUploadForm.get('selectFolder').setValue(this.currentDataGroup);\n  }\n\n  /**\n   * Navigates to the data source type selection page\n   */\n  goBack(): void {\n    this.goBackFlag.emit(true);\n  }\n\n  /**\n   * Stores the file data to be uploaded into the variable\n   * @param inputFile files object\n   */\n  handleFileInput(inputFile: any, formValue: any): void {\n    const ext = inputFile[0].name.split('.').pop();\n    if (inputFile && ['csv', 'xlsx', 'xls', 'pkl', 'pk', 'pl', 'pickle'].includes(ext)) {\n      if (inputFile[0].size < this.allowedPSFileUploadSize * 1024 * 1024) {\n        this.fileToUpload = inputFile[0];\n        this.createConnection(formValue);\n      } else {\n        this._snackbar.open(\n          'File size should be less than ' + this.allowedPSFileUploadSize + 'Mb',\n          'OK',\n          {\n            horizontalPosition: 'right',\n            verticalPosition: 'bottom',\n          }\n        );\n      }\n    } else {\n      this._snackbar.open(`.${ext} file type is not supported`, 'OK');\n    }\n  }\n\n  /**\n   * Uploads the file and create a connection\n   * @param formValue\n   */\n  createConnection(formValue: any): void {\n    this._spinner.showSpinner();\n    let dataGroupId: string;\n    let parentFolder: string;\n\n    if (formValue.selectFolder === 'Add') {\n      dataGroupId = formValue.dataFolderName;\n      parentFolder = formValue.parentFolderName;\n    } else {\n      dataGroupId = formValue.selectFolder;\n    }\n\n    let reqObj = {\n      encoding: formValue.encoding,\n      projectId: this.project._id,\n      dataGroupId: dataGroupId,\n      dataFolderName: dataGroupId,\n      parentFolderName: parentFolder,\n      file: this.fileToUpload,\n    };\n    this._data\n      .uploadFile(reqObj)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (resp) => {\n          if (resp.type === HttpEventType.UploadProgress) {\n            this.percentDone = Math.round((100 * resp.loaded) / resp.total);\n          }\n          if (this.percentDone === 100) {\n            this._utils.showSnackBar(toasterMsg.fileUpload);\n            this._spinner.stopSpinner();\n            resp.type === 4 && resp.status === 200 ? this._connectionDialogRef.close() : null;\n          }\n        },\n        (err: HttpErrorResponse) => {\n          this._toaster.error(err.error.message || 'Server Error', 'Data Connection');\n          this._spinner.stopSpinner();\n          this._utils.dismissSnackBar();\n        }\n      );\n  }\n\n  /**\n   * Unsubscribes the subscriptions, only if they were subscribed\n   */\n  ngOnDestroy() {\n    this.unsubscribe$.next(false);\n    this.unsubscribe$.unsubscribe();\n  }\n}\n","<div class=\"mat-typography\">\n  <form [formGroup]=\"dbConnectionForm\" role=\"form\" class=\"form-validate\" name=\"dbConnectionForm\">\n    <!-- Connection Name -->\n    <div class=\"row\">\n      <div class=\"col-md-12 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"connectionName\">Connection name</mat-label>\n          <input\n            matInput\n            type=\"text\"\n            name=\"connectionName\"\n            formControlName=\"connectionName\"\n            id=\"connectionName\"\n            placeholder=\"Enter connection name\"\n            autocomplete\n            required\n          />\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('connectionName').hasError('required') &&\n              (dbConnectionForm.get('connectionName').dirty ||\n                dbConnectionForm.get('connectionName').touched)\n            \"\n            >Connection name is required.</mat-error\n          >\n          <mat-error *ngIf=\"dbConnectionForm.get('connectionName').hasError('pattern')\"\n            >Invalid connection name\n          </mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div class=\"row\">\n      <!-- Select connection dropdown -->\n      <div\n        class=\"\n          {{ sourceType === 'sftp' ? 'col-md-12 form-group' : 'col-md-6 form-group' }}\"\n      >\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"inputdatabase\">Select connection</mat-label>\n          <mat-select formControlName=\"connection\" required>\n            <mat-option *ngFor=\"let con of dbConns\" [value]=\"con\">{{ con.name }}</mat-option>\n          </mat-select>\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('connection').hasError('required') &&\n              (dbConnectionForm.get('connection').dirty ||\n                dbConnectionForm.get('connection').touched)\n            \"\n            >Connection is required.</mat-error\n          >\n        </mat-form-field>\n        <!-- <p>Add new</p> -->\n      </div>\n\n      <!-- <div class=\"col-md-2\">\n        <p>Add new</p>\n      </div> -->\n\n      <!-- Database name input -->\n      <div *ngIf=\"sourceType !== 'sftp'\" class=\"col-md-6 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"database\">Database name</mat-label>\n          <input\n            matInput\n            type=\"text\"\n            name=\"database\"\n            formControlName=\"database\"\n            id=\"database\"\n            placeholder=\"Enter database name\"\n            autocomplete\n            required\n          />\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('database').hasError('required') &&\n              (dbConnectionForm.get('database').dirty || dbConnectionForm.get('database').touched)\n            \"\n            >Database name is required.</mat-error\n          >\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Query input -->\n    <div class=\"row\">\n      <div class=\"col-md-12 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"query\">Query</mat-label>\n          <textarea\n            matInput\n            type=\"text\"\n            name=\"query\"\n            formControlName=\"query\"\n            id=\"query\"\n            placeholder=\"Enter SELECT query\"\n            autocomplete\n            required\n            #queryString\n          ></textarea>\n          <mat-hint>Only SELECT query is allowed.</mat-hint>\n          <mat-hint align=\"end\" *ngIf=\"!(user?.roles?.includes('super_admin') || user?.roles?.includes('admin'))\">Note: Only {{ allowedNoOfRows | rowColValConverter }} rows will be fetched from the data source.</mat-hint>\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('query').hasError('required') &&\n              (dbConnectionForm.get('query').dirty || dbConnectionForm.get('query').touched)\n            \"\n            >Query is required.</mat-error\n          >\n          <mat-error *ngIf=\"dbConnectionForm.get('query').hasError('queryInvalid')\"\n            >Invalid query.\n          </mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Password input -->\n    <!-- <div *ngIf=\"!isEdit\" class=\"row\">\n      <div class=\"col-md-12 form-group\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"predictsensePwd\">PredictSense password</mat-label>\n          <input\n            matInput\n            [type]=\"hidePassword ? 'password' : 'text'\"\n            name=\"predictsensePwd\"\n            id=\"predictsensePwd\"\n            formControlName=\"predictsensePwd\"\n            placeholder=\"Enter PredictSense password\"\n            required\n          />\n          <button mat-icon-button matSuffix (click)=\"hidePassword = !hidePassword\">\n            <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>\n          </button>\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('predictsensePwd').hasError('required') &&\n              (dbConnectionForm.get('predictsensePwd').dirty ||\n                dbConnectionForm.get('predictsensePwd').touched)\n            \"\n            >Password is required.\n          </mat-error>\n          <mat-error *ngIf=\"dbConnectionForm.get('predictsensePwd').hasError('pattern')\"\n            >Invalid predictsense password\n          </mat-error>\n        </mat-form-field>\n      </div>\n    </div> -->\n\n    <div class=\"row\">\n      <!-- select schedular -->\n      <div\n        class=\"col-md-6\"\n        *ngIf=\"\n          appType === 'enterprise' ||\n          (appType === 'saas' &&\n            (user?.roles?.includes('super_admin') || user?.roles?.includes('admin')))\n        \"\n      >\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"scheduleId\">Select scheduler</mat-label>\n          <mat-select\n            formControlName=\"scheduleId\"\n            (selectionChange)=\"schedularChanged($event.value)\"\n          >\n            <mat-option *ngIf=\"!isEdit\">None</mat-option>\n            <mat-option *ngIf=\"isEdit\" value=\"None\">None</mat-option>\n            <mat-option *ngFor=\"let item of schedularsArray\" [value]=\"item._id\">{{\n              item.scheduleName\n            }}</mat-option>\n          </mat-select>\n          <mat-hint *ngIf=\"!schedularsArray.length\" class=\"redirect-link\">\n            <a class=\"text-decoration-none\" (click)=\"navigateToScheduler()\" style=\"cursor: pointer\"\n              >Add scheduler</a\n            >\n          </mat-hint>\n        </mat-form-field>\n      </div>\n\n      <!-- select folder -->\n      <div *ngIf=\"!isEdit\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select folder</mat-label>\n          <mat-select\n            formControlName=\"dataGroupId\"\n            (selectionChange)=\"onFolderChange($event.value)\"\n            required\n          >\n            <mat-option value=\"Add\">Create new folder</mat-option>\n            <mat-option *ngFor=\"let folder of dataGroupsArray\" [value]=\"folder._id\">{{\n              folder.name\n            }}</mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Add new folder block -->\n    <div *ngIf=\"selectedFolder === 'Add' && !isEdit\" class=\"row my-4\">\n      <!-- Folder name input -->\n      <div class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"dataGroupName\">Folder name</mat-label>\n          <input\n            matInput\n            type=\"text\"\n            name=\"dataGroupName\"\n            id=\"dataGroupName\"\n            formControlName=\"dataGroupName\"\n            placeholder=\"Enter folder name\"\n            required\n          />\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('dataGroupName').hasError('required') &&\n              (dbConnectionForm.get('dataGroupName').dirty ||\n                dbConnectionForm.get('dataGroupName').touched)\n            \"\n            >Folder name is required.\n          </mat-error>\n          <!-- <mat-error *ngIf=\"dbConnectionForm.get('dataGraoupName').hasError('pattern')\">Folder Name can not\n            start with white space</mat-error> -->\n        </mat-form-field>\n      </div>\n\n      <!-- Parent folder selection -->\n      <div class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select parent folder</mat-label>\n          <mat-select formControlName=\"parent_id\" required>\n            <mat-option *ngFor=\"let folder of dataGroupsArray\" [value]=\"folder._id\">{{\n              folder.name\n            }}</mat-option>\n          </mat-select>\n          <mat-error\n            *ngIf=\"\n              dbConnectionForm.get('parent_id').hasError('required') &&\n              (dbConnectionForm.get('parent_id').dirty || dbConnectionForm.get('parent_id').touched)\n            \"\n            >Parent folder is required.</mat-error\n          >\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Pull data checkbox -->\n    <div *ngIf=\"!isEdit\" class=\"mt-5 ml-1\">\n      <mat-checkbox [(ngModel)]=\"isPulling\" [ngModelOptions]=\"{ standalone: true }\"\n        >Pull data</mat-checkbox\n      >\n    </div>\n  </form>\n</div>\n<hr />\n<div class=\"d-flex justify-content-end m-auto\">\n  <button *ngIf=\"!isEdit\" mat-stroked-button class=\"mr-auto\" (click)=\"goBack()\">Back</button>\n  <button mat-stroked-button mat-dialog-close>Cancel</button>\n  <button\n    mat-flat-button\n    [disabled]=\"dbConnectionForm.invalid\"\n    class=\"btn-primary ml-3\"\n    type=\"submit\"\n    (click)=\"onSubmitConnection(dbConnectionForm.value)\"\n  >\n    {{ isEdit ? 'Update' : 'Create' }}\n  </button>\n</div>\n","import { SpinnerService } from './../../../../shared/spinner.service';\nimport { Router } from '@angular/router';\nimport { CreateConnectionService } from './../../../dashboard/create-connection/create-connection.service';\nimport { Component, EventEmitter, Inject, Input, OnDestroy, OnInit, Output } from '@angular/core';\nimport { AbstractControl, FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ThemePalette } from '@angular/material/core';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { ToastrService } from 'ngx-toastr';\nimport { DataConnectionComponent } from '../data-connection.component';\nimport { Subject, Subscription } from 'rxjs';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { DataService } from '../../data.service';\nimport { environment } from 'src/environments/environment';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { takeUntil } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-database-form',\n  templateUrl: './database-form.component.html',\n  styleUrls: ['./database-form.component.scss'],\n})\nexport class DatabaseFormComponent implements OnInit, OnDestroy {\n  @Output() goBackFlag = new EventEmitter<boolean>();\n  @Input() dataGroupsArray: Array<any>;\n  @Input() schedularsArray: Array<any>;\n  @Input() sourceType: string;\n  @Input() data: any;\n  @Input() currentDataGroup: string;\n\n  /** Progress spinner settings */\n  color: ThemePalette = 'primary';\n  mode: ProgressSpinnerMode = 'indeterminate';\n  diameter = 100;\n  exportProjectDiameter = 50;\n\n  /** Subscription variables */\n  connection$: Subscription;\n  unsubscribe$ = new Subject<boolean>();\n\n  dbConnectionForm: FormGroup;\n  fileToUpload: any;\n  project: any;\n  selectedFolder: string;\n  fileUploadApi: string;\n  dbConns: Array<any>;\n  hidePassword: boolean = true;\n  isPulling: boolean = true;\n  isEdit: boolean = false;\n  connectionIdToUpdate: string;\n  connectionDetails: any;\n  dataschedule: string;\n  // restriction variables\n  appType: string = environment.appType;\n  user: any;\n  allowedNoOfRows: number = 0;\n\n  constructor(\n    private _fb: FormBuilder,\n    private _connection: CreateConnectionService,\n    private _toaster: ToastrService,\n    private _connectionDialogRef: MatDialogRef<DataConnectionComponent>,\n    private _data: DataService,\n    private _localStorage: LocalStorageService,\n    private _router: Router,\n    private _spinner: SpinnerService\n  ) {\n    this.dbConnectionForm = this._fb.group(\n      {\n        connectionName: [\n          '',\n          [Validators.required, Validators.pattern('^[^\\\\s][A-Za-z0-9_\\\\- ]+$')],\n        ],\n        connection: ['', Validators.required],\n        database: ['', Validators.required],\n        query: ['', Validators.required],\n        //predictsensePwd: ['', Validators.required],\n        dataGroupId: ['', Validators.required],\n        parent_id: ['', Validators.nullValidator],\n        dataGroupName: ['', Validators.nullValidator],\n        scheduleId: [''],\n      },\n      {\n        validator: this.validateQuery,\n      }\n    );\n  }\n\n  /**\n   * Initial settings for this page\n   */\n  async ngOnInit(): Promise<any> {\n    this.project = this._localStorage.getItem('project');\n    this.user = this._localStorage.getItem('user');\n    this.allowedNoOfRows = this.user?.psFeatures?.allowedNoOfRows;\n    await this.getRequiredConnectionList();\n    /** Prefills the connection form as per the operation - edit/create */\n    this.prefillConnectionForm(this.data);\n  }\n\n  /**\n   * Fetches all required connections list\n   */\n  async getRequiredConnectionList(): Promise<any> {\n    if (this.sourceType === 'snowflake' || this.sourceType === 'bigquery') {\n      this.dbConns = await this._connection\n        .getConnectionsList(this.sourceType)\n        .pipe(takeUntil(this.unsubscribe$))\n        .toPromise();\n    } else {\n      this.dbConns = await this._connection\n        .getDbConnectionList()\n        .pipe(takeUntil(this.unsubscribe$))\n        .toPromise();\n      this.dbConns = this.dbConns?.filter((item: any) => item.source === this.sourceType);\n    }\n  }\n\n  /**\n   * Prefills the connection form for edit and create functionality\n   * @param connectionData selected connection details\n   */\n  prefillConnectionForm(connectionData: any): void {\n    if (connectionData) {\n      this.isEdit = true;\n      this.connectionIdToUpdate = connectionData._id;\n      this._data.getSingleDataConnection(this.project._id, connectionData._id).subscribe(\n        (res: any) => {\n          if (res) {\n            this.connectionDetails = res;\n            this.dbConnectionForm.patchValue({\n              connectionName: res.connectionName,\n              connection: this.dbConns.filter((item) => item._id === res.databaseConnectionId)[0],\n              database: res.databaseName,\n              query: res.query,\n              scheduleId: res.scheduleId,\n            });\n            this.dbConnectionForm.get('dataGroupId').clearValidators();\n            this.dbConnectionForm.get('dataGroupId').updateValueAndValidity();\n           // this.dbConnectionForm.get('predictsensePwd').clearValidators();\n           // this.dbConnectionForm.get('predictsensePwd').updateValueAndValidity();\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Connection');\n        }\n      );\n    } else {\n      this.dbConnectionForm.reset();\n      this.dbConnectionForm.get('dataGroupId').setValue(this.currentDataGroup);\n      this.isEdit = false;\n    }\n  }\n\n  /**\n   * Handles the connection type whether DB or SFTP connection\n   * @param formValue connection details\n   */\n  onSubmitConnection(formValue: any): void {\n    if (this.isEdit) {\n      this.updateConnectionHandler(formValue);\n    } else {\n      this.createConnectionHandler(formValue);\n    }\n  }\n\n  /**\n   * Updates the connection details in DB\n   * @param formData\n   */\n  updateConnectionHandler(formData: any): void {\n    this.connectionDetails.databaseConnectionId = formData.connection._id;\n    this.connectionDetails.connectionName = formData.connectionName;\n    this.connectionDetails.databaseName = formData.database;\n    this.connectionDetails.query = formData.query;\n    this.connectionDetails.projectId = this.project._id;\n\n    /** Logic to update schedulars when we edit */\n    if (formData.scheduleId == 'None') {\n      this.connectionDetails.statusData = 'None';\n    }\n    if (this.dataschedule === undefined) {\n      this.connectionDetails.scheduledata = 'noupdate';\n    } else {\n      this.connectionDetails.scheduledata = this.dataschedule;\n    }\n    this.connectionDetails.scheduleId\n      ? (this.connectionDetails.oldScheduleId = this.connectionDetails.scheduleId)\n      : null;\n    formData.scheduleId ? (this.connectionDetails.scheduleId = formData.scheduleId) : null;\n\n    this._data\n      .updateDataConnection(this.project._id, this.connectionDetails._id, this.connectionDetails)\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.closeModal(res);\n            this._toaster.success(\n              `${this.sourceType.toUpperCase()} connection updated successfully`,\n              'Data Connection'\n            );\n          }\n        },\n        (err: Error) => {\n          this._toaster.success('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Pull the data from the db\n   */\n  createConnectionHandler(formData: any): void {\n    formData.scheduleId ? formData.scheduleId : delete formData.scheduleId;\n    formData.dataGroupName ? formData.dataGroupName : delete formData.dataGroupName;\n    formData.parent_id ? formData.parent_id : delete formData.parent_id;\n\n    let reqObj: object = {\n      ...formData,\n      source: this.sourceType,\n      isPulling: this.isPulling,\n    };\n    this._data.pullData(this.project._id, reqObj).subscribe(\n      (res: any) => {\n        if (res) {\n          this.closeModal(res);\n          this._toaster.success(\n            `${this.sourceType.toUpperCase()} connection created successfully`,\n            'Data Connection'\n          );\n        }\n      },\n      (err: HttpErrorResponse) => {\n        this._toaster.error(err.error.message || 'Server Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Calls whenever the schedular is changed\n   * @param event\n   */\n  schedularChanged(scheduleId: any): void {\n    if (!this.connectionDetails?.scheduleId) {\n      this.dataschedule = 'new';\n    } else if (this.connectionDetails.scheduleId !== scheduleId) {\n      this.dataschedule = 'update';\n    } else {\n      this.dataschedule = 'noupdate';\n    }\n  }\n\n  /**\n   * Navigates to the data source type selection page\n   */\n  goBack(): void {\n    this.goBackFlag.emit(true);\n  }\n\n  /**\n   * Call when the folder selection is changed\n   */\n  onFolderChange(folderName: string) {\n    this.selectedFolder = folderName;\n    if (this.selectedFolder === 'Add') {\n      this.dbConnectionForm.get('dataGroupName').setValidators(Validators.required);\n      this.dbConnectionForm.get('dataGroupName').updateValueAndValidity();\n      this.dbConnectionForm.get('parent_id').setValidators(Validators.required);\n      this.dbConnectionForm.get('parent_id').updateValueAndValidity();\n    } else {\n      this.dbConnectionForm.get('dataGroupName').clearValidators();\n      this.dbConnectionForm.get('dataGroupName').updateValueAndValidity();\n      this.dbConnectionForm.get('parent_id').clearValidators();\n      this.dbConnectionForm.get('parent_id').updateValueAndValidity();\n    }\n  }\n\n  /**\n   * Closes the opened modal by sending the data or without data\n   */\n  closeModal(data?: any): void {\n    this._connectionDialogRef.close(data);\n  }\n\n  /**\n   * Navigates the user to the schedular page to create new\n   */\n  navigateToScheduler() {\n    this.closeModal();\n    this._spinner.stopSpinner();\n    this._router.navigateByUrl('/dashboard/scheduler?type=scheduler');\n  }\n\n  /**\n   * Custom validator for query string, it returns boolean value\n   * @param queryString input query string\n   */\n  validateQuery(queryString: AbstractControl): void {\n    let str: string = queryString.get('query').value;\n    if (str?.length) {\n      str = str.toLowerCase();\n      if (!str.includes('select')) {\n        queryString.get('query').setErrors({ queryInvalid: true });\n      }\n    }\n  }\n\n  /**\n   * Unsubscribes the subscriptions, only if they were subscribed\n   */\n  ngOnDestroy() {\n    if (this.connection$) {\n      this.connection$.unsubscribe();\n    }\n  }\n}\n","<div class=\"mat-typography\">\n  <form [formGroup]=\"dynamicForm\" role=\"form\" class=\"form-validate\" name=\"dynamicForm\">\n    <div class=\"row\">\n      <!-- Connection Name -->\n      <div class=\"{{\n          (sourceType === 'sftp' && !isEdit) || sourceType === 's3' ? 'col-md-6' : 'col-md-12 '\n        }}\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"connectionName\">Connection name</mat-label>\n          <input matInput type=\"text\" name=\"connectionName\" formControlName=\"connectionName\" id=\"connectionName\"\n            placeholder=\"Enter connection name\" autocomplete required />\n          <mat-error *ngIf=\"\n              dynamicForm.get('connectionName').hasError('required') &&\n              (dynamicForm.get('connectionName').dirty || dynamicForm.get('connectionName').touched)\n            \">Connection name is required.</mat-error>\n          <mat-error *ngIf=\"dynamicForm.get('connectionName').hasError('pattern')\">Invalid connection name</mat-error>\n        </mat-form-field>\n      </div>\n      <!-- Select connection dropdown (SFTP) -->\n      <div *ngIf=\"sourceType === 'sftp' && !isEdit\" formGroupName=\"sftpGroup\"\n        class=\"{{ sourceType === 'sftp' ? 'col-md-6 ' : 'd-none' }}\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"inputdatabase\">Select connection</mat-label>\n          <mat-select formControlName=\"connection\" (selectionChange)=\"connectionChanged($event)\" required>\n            <mat-option *ngFor=\"let con of sftpConns\" [value]=\"con\">{{ con.name }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('sftpGroup.connection').hasError('required') &&\n              (dynamicForm.get('sftpGroup.connection').dirty ||\n                dynamicForm.get('sftpGroup.connection').touched)\n            \">Connection is required.</mat-error>\n        </mat-form-field>\n      </div>\n      <!-- Select connection dropdown (S3) -->\n      <div *ngIf=\"sourceType === 's3'\" formGroupName=\"s3Group\"\n        class=\"{{ sourceType === 's3' ? 'col-md-6' : 'd-none' }}\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"inputdatabase\">Select connection</mat-label>\n          <mat-select formControlName=\"connection\" (selectionChange)=\"connectionChanged($event)\" required>\n            <mat-option *ngFor=\"let con of s3Conns\" [value]=\"con\">{{ con.name }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('s3Group.connection').hasError('required') &&\n              (dynamicForm.get('s3Group.connection').dirty ||\n                dynamicForm.get('s3Group.connection').touched)\n            \">Connection is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div *ngIf=\"sourceType === 's3'\" class=\"row\">\n      <!-- BUCKETS dropdown (S3) -->\n      <div formGroupName=\"s3Group\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"inputdatabase\">Select bucket</mat-label>\n          <mat-select formControlName=\"bucket\" required>\n            <mat-option *ngFor=\"let con of s3BucketsArray\" [value]=\"con\">{{ con }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('s3Group.bucket').hasError('required') &&\n              (dynamicForm.get('s3Group.bucket').dirty || dynamicForm.get('s3Group.bucket').touched)\n            \">Bucket is required.</mat-error>\n        </mat-form-field>\n      </div>\n      <!-- BUCKET folder path (S3) -->\n      <div formGroupName=\"s3Group\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"bucketFolderPath\">Bucket folder path (optional)</mat-label>\n          <input matInput type=\"text\" name=\"bucketFolderPath\" formControlName=\"bucketFolderPath\" id=\"bucketFolderPath\"\n            placeholder=\"Eg: upload or upload/demo\" />\n          <!-- <mat-hint>Note: Will pull all files from the provided path</mat-hint> -->\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div class=\"row mb-5\" *ngIf=\"(isEdit || sourceType === 'sftp')\">\n      <!-- Folder tree structure -->\n      <div *ngIf=\"!isEdit\" class=\"col-md-6 overflow-auto\">\n        <mat-label for=\"folder-path\" class=\"ml-2\">Folder path tree</mat-label>\n        <!-- <i class=\"fa fa-level-up\" (click)=\"previousTree()\"></i> -->\n        <a class=\"text-decoration-none ml-2\" (click)=\"previousTree()\" style=\"cursor: pointer\">Back</a>\n        <!-- <button class=\"mr-1 btn btn-labeled mb-2\" type=\"button\">\n          <span class=\"btn-label\"><i class=\"fa fa-exclamation\"></i>\n          </span>Info</button> -->\n        <tree-root #tree [nodes]=\"nodes\" [focused]=\"true\" [options]=\"options\" [ngClass]=\"'expand_tree'\">\n          <ng-template #treeNodeTemplate let-node>\n            <span title=\"{{node.data.subTitle}}\" (click)=\"treeHandler(node)\">{{ node.data.label }}</span>\n            <!-- <span class=\"float-right\">{{ childrenCount(node) }}</span> -->\n          </ng-template>\n          <ng-template #loadingTemplate>Loading, please hold....</ng-template>\n        </tree-root>\n        <mat-hint class=\"text-sm ml-3 mb-3\">Note: Above tree is supported upto 2 levels only.</mat-hint>\n      </div>\n      <!-- Selected folder path -->\n      <div *ngIf=\"sourceType === 'sftp'\" formGroupName=\"sftpGroup\" class=\"{{ isEdit ? 'col-md-12 ' : 'col-md-6 ' }}\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"folderpath\">Selected folder path</mat-label>\n          <input matInput type=\"text\" name=\"connectionName\" formControlName=\"folderpath\" id=\"folderpath\"\n            placeholder=\"Enter selected folder path\" required [value]=\"selectedPath\" />\n          <button mat-button matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"\n              selectedPath = '';\n              nodesArray = [];\n              dynamicForm.get('sftpGroup.folderpath').setValue('');\n              resetTreeNode();\n            \">\n            <mat-icon>close</mat-icon>\n          </button>\n          <mat-error *ngIf=\"\n              dynamicForm.get('sftpGroup.folderpath').hasError('required') &&\n              (dynamicForm.get('sftpGroup.folderpath').dirty ||\n                dynamicForm.get('sftpGroup.folderpath').touched)\n            \">Folder path is required.</mat-error>\n          <mat-hint>Note: You can use folder path input for more nested structure.</mat-hint>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div class=\"row mt-2\">\n      <!-- select file extentsion (SFTP) -->\n      <div *ngIf=\"sourceType === 'sftp'\" formGroupName=\"sftpGroup\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select file extentsion</mat-label>\n          <mat-select formControlName=\"fileExtension\" required>\n            <mat-option *ngFor=\"let type of sftpFileTypes\" [value]=\"type.value\">{{\n              type.name\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('sftpGroup.fileExtension').hasError('required') &&\n              (dynamicForm.get('sftpGroup.fileExtension').dirty ||\n                dynamicForm.get('sftpGroup.fileExtension').touched)\n            \">File extentsion is required.\n          </mat-error>\n        </mat-form-field>\n      </div>\n      <!-- select file type for (URL connection) -->\n      <div *ngIf=\"sourceType === 'url' && !isEdit\" formGroupName=\"urlGroup\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select resource type</mat-label>\n          <mat-select formControlName=\"filetype\" required>\n            <mat-option *ngFor=\"let type of urlSources\" [value]=\"type.value\">{{\n              type.name\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('urlGroup.filetype').hasError('required') &&\n              (dynamicForm.get('urlGroup.filetype').dirty ||\n                dynamicForm.get('urlGroup.filetype').touched)\n            \">URL resource type is required.\n          </mat-error>\n        </mat-form-field>\n      </div>\n      <!-- select schedular -->\n      <div class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"scheduleId\">Select scheduler</mat-label>\n          <mat-select formControlName=\"scheduleId\" (selectionChange)=\"schedularChanged($event.value)\">\n            <mat-option value=\"None\">None</mat-option>\n            <!-- <mat-option value=\"\">None</mat-option> -->\n            <mat-option *ngFor=\"let item of schedularsArray\" [value]=\"item._id\">{{\n              item.scheduleName\n              }}</mat-option>\n          </mat-select>\n          <mat-hint *ngIf=\"!schedularsArray.length\" class=\"redirect-link\">\n            <a class=\"text-decoration-none\" (click)=\"navigateToScheduler()\" style=\"cursor: pointer\">Add scheduler</a>\n          </mat-hint>\n        </mat-form-field>\n      </div>\n      <!-- select file extentsion (S3) -->\n      <div *ngIf=\"sourceType === 's3'\" formGroupName=\"s3Group\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select file extentsion</mat-label>\n          <mat-select formControlName=\"fileExtension\" required>\n            <mat-option *ngFor=\"let type of sftpFileTypes\" [value]=\"type.value\">{{\n              type.name\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('s3Group.fileExtension').hasError('required') &&\n              (dynamicForm.get('s3Group.fileExtension').dirty ||\n                dynamicForm.get('s3Group.fileExtension').touched)\n            \">File extentsion is required.\n          </mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div class=\"row\">\n      <!-- Select data format radio buttons for URL connection -->\n      <div *ngIf=\"\n          sourceType === 'url' && (dynamicForm.get('urlGroup.filetype').value === 'url' || isEdit)\n        \" class=\"col-md-6\">\n        <label id=\"dataFormat\">Data format</label>\n        <mat-radio-group aria-labelledby=\"dataFormat\" class=\"radio-group my-2 ml-1\" [(ngModel)]=\"dataFormat\"\n          [ngModelOptions]=\"{ standalone: true }\">\n          <mat-radio-button value=\"csv\">CSV</mat-radio-button>\n          <mat-radio-button value=\"json\">JSON</mat-radio-button>\n        </mat-radio-group>\n      </div>\n      <!-- select folder -->\n      <div *ngIf=\"!isEdit\" class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select folder</mat-label>\n          <mat-select formControlName=\"dataGroupId\" (selectionChange)=\"folderChangedHandler($event)\" required>\n            <mat-option value=\"Add\">Create new folder</mat-option>\n            <mat-option *ngFor=\"let folder of dataGroupsArray\" [value]=\"folder._id\">{{\n              folder.name\n              }}</mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Add new folder block -->\n    <div class=\"row\" *ngIf=\"selectedFolder === 'Add' && !isEdit\">\n      <!-- Folder name input -->\n      <div class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"dataGroupName\">Folder name</mat-label>\n          <input matInput type=\"text\" name=\"dataGroupName\" id=\"dataGroupName\" formControlName=\"dataGroupName\"\n            placeholder=\"Enter folder name\" required />\n          <mat-error *ngIf=\"\n              dynamicForm.get('dataGroupName').hasError('required') &&\n              (dynamicForm.get('dataGroupName').dirty || dynamicForm.get('dataGroupName').touched)\n            \">Folder name is required.\n          </mat-error>\n        </mat-form-field>\n      </div>\n      <!-- Parent folder selection -->\n      <div class=\"col-md-6\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label>Select parent folder</mat-label>\n          <mat-select formControlName=\"parent_id\" required>\n            <mat-option *ngFor=\"let folder of dataGroupsArray\" [value]=\"folder._id\">{{\n              folder.name\n              }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"\n              dynamicForm.get('parent_id').hasError('required') &&\n              (dynamicForm.get('parent_id').dirty || dynamicForm.get('parent_id').touched)\n            \">Parent folder is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- URL input -->\n    <div class=\"row\" *ngIf=\"sourceType === 'url'\">\n      <div formGroupName=\"urlGroup\" class=\"col-md-12\">\n        <mat-form-field appearance=\"outline\">\n          <mat-label for=\"url\">URL</mat-label>\n          <input matInput type=\"url\" name=\"url\" formControlName=\"url\" id=\"url\" placeholder=\"Enter URL\" autocomplete\n            required />\n          <mat-error *ngIf=\"\n              dynamicForm.get('urlGroup.url').hasError('required') &&\n              (dynamicForm.get('urlGroup.url').dirty || dynamicForm.get('urlGroup.url').touched)\n            \">URL is required.</mat-error>\n          <mat-error *ngIf=\"dynamicForm.get('urlGroup.url').hasError('url')\">Invalid URL.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Pull data checkbox -->\n    <div *ngIf=\"!isEdit\" class=\"mt-3 ml-1\">\n      <mat-checkbox [(ngModel)]=\"isPulling\" [ngModelOptions]=\"{ standalone: true }\">Pull data</mat-checkbox>\n    </div>\n\n    <!-- HINT -->\n    <div *ngIf=\"sourceType === 'sftp' || sourceType === 's3'\" class=\"mt-3\">\n      <mat-hint>Note:\n        <ul>\n          <li *ngIf=\"sourceType === 's3'\">\n            It will pull all files from selected bucket or folder path (optional)\n          </li>\n          <li *ngIf=\"sourceType === 'sftp'\">It will pull all files from selected folder path</li>\n          <li>Files will be pulled, only if they have been modified or new are added</li>\n        </ul>\n      </mat-hint>\n    </div>\n  </form>\n</div>\n<hr />\n<div class=\"d-flex justify-content-end m-auto\">\n  <button *ngIf=\"!isEdit\" mat-stroked-button class=\"mr-auto\" ccolor=\"basic\" (click)=\"goBack()\">\n    Back\n  </button>\n  <button mat-stroked-button mat-dialog-close>Cancel</button>\n  <button mat-flat-button [disabled]=\"dynamicForm.invalid\" class=\"btn-primary ml-3\" type=\"submit\"\n    (click)=\"onSubmitConnection(dynamicForm.value)\">\n    {{ isEdit ? 'Update' : 'Create' }}\n  </button>\n</div>","import { takeUntil } from 'rxjs/operators';\nimport { Router } from '@angular/router';\nimport { SpinnerService } from './../../../../shared/spinner.service';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { Component, EventEmitter, Inject, Input, OnDestroy, OnInit, Output } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ThemePalette } from '@angular/material/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { ProgressSpinnerMode } from '@angular/material/progress-spinner';\nimport { MatTreeNestedDataSource, MatTreeModule, MatTree } from '@angular/material/tree';\nimport { CustomValidators } from 'ngx-custom-validators';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject, Subscription } from 'rxjs';\nimport { CreateConnectionService } from 'src/app/routes/dashboard/create-connection/create-connection.service';\nimport { LocalStorageService } from 'src/app/shared/local-storage.service';\nimport { DataService } from '../../data.service';\nimport { DataConnectionComponent } from '../data-connection.component';\nimport { UtilsService } from 'src/app/shared/utils.service';\nimport { toasterMsg } from 'src/app/shared/static-data';\nimport { TreeNode, TREE_ACTIONS, KEYS, IActionMapping } from '@circlon/angular-tree-component';\nimport { isArray } from 'rxjs/internal-compatibility';\n\n@Component({\n  selector: 'app-sftp-and-url-form',\n  templateUrl: './sftp-and-url-form.component.html',\n  styleUrls: ['./sftp-and-url-form.component.scss'],\n  providers: [MatTree],\n})\nexport class SftpAndUrlFormComponent implements OnInit, OnDestroy {\n  @Output() goBackFlag = new EventEmitter<boolean>();\n  @Input() dataGroupsArray: Array<any>;\n  @Input() schedularsArray: Array<any>;\n  @Input() sourceType: string;\n  @Input() data: any;\n  @Input() currentDataGroup: string;\n\n  options: IActionMapping = {\n    mouse: {\n      contextMenu: (tree, node, $event) => {\n        $event.preventDefault();\n        alert(`context menu for ${node.data.name}`);\n      },\n      dblClick: TREE_ACTIONS.TOGGLE_EXPANDED,\n      click: (tree, node, $event) => {\n        $event.shiftKey\n          ? TREE_ACTIONS.TOGGLE_ACTIVE_MULTI(tree, node, $event)\n          : TREE_ACTIONS.TOGGLE_ACTIVE(tree, node, $event);\n      },\n    },\n    keys: {\n      [KEYS.ENTER]: (tree, node, $event) => alert(`This is ${node.data.name}`),\n    },\n  };\n  /** Usubscription subject */\n  unsubscribe$ = new Subject<boolean>();\n\n  /** SFTP file extensions */\n  sftpFileTypes: Array<object> = [\n    {\n      name: 'XLS',\n      value: '.xls',\n      type: 'xls',\n    },\n    {\n      name: 'XLSX',\n      value: '.xlsx',\n      type: 'xlsx',\n    },\n    {\n      name: 'CSV',\n      value: '.csv',\n      type: 'csv',\n    },\n    // {\n    //   name: 'PDF',\n    //   value: '.pdf',\n    //   type: 'pdf',\n    // },\n    // {\n    //   name: 'EDI',\n    //   value: '.edi',\n    //   type: 'edi',\n    // },\n    // {\n    //   name: 'HTML',\n    //   value: '.html',\n    //   type: 'html',\n    // },\n  ];\n\n  /** URL source file extensions */\n  urlSources: Array<object> = [\n    {\n      name: 'URL',\n      value: 'url',\n      type: 'url',\n    },\n  ];\n\n  /** Progress spinner settings */\n  color: ThemePalette = 'primary';\n  mode: ProgressSpinnerMode = 'indeterminate';\n  diameter = 100;\n  exportProjectDiameter = 50;\n\n  /** Subscription variables */\n  connection$: Subscription;\n  dataConnection$: Subscription;\n\n  /** Tree settings */\n  treeControl = new NestedTreeControl<any>((node) => node.children);\n  dataSource = new MatTreeNestedDataSource<any>();\n\n  sftpForm: FormGroup;\n  s3Form: FormGroup;\n  urlForm: FormGroup;\n  dynamicForm: FormGroup;\n  fileToUpload: any;\n  project: any;\n  selectedFolder: string;\n  sftpConns: Array<any>;\n  s3Conns: Array<any>;\n  hidePassword: boolean = true;\n  isPulling: boolean = true;\n  isEdit: boolean = false;\n  showSftpSpinner: boolean = false;\n  nodesArray: Array<any> = [];\n  sftpId: string;\n  selectedPath: string;\n  dataFormat: string = 'csv';\n  connectionIdToUpdate: string;\n  sftpDetails: any;\n  urlDetails: any;\n  dataschedule: string;\n  s3BucketsArray: Array<any> = [];\n  s3Details: any;\n  nodes: any[] = null;\n  constructor(\n    @Inject(MAT_DIALOG_DATA) public dialogData: any,\n    private _fb: FormBuilder,\n    private _connection: CreateConnectionService,\n    private _toaster: ToastrService,\n    private _connectionDialogRef: MatDialogRef<DataConnectionComponent>,\n    private _data: DataService,\n    private _localStorage: LocalStorageService,\n    private _spinner: SpinnerService,\n    private _router: Router,\n    private _utils: UtilsService\n  ) {\n    /** Form instances */\n    this.s3Form = this._fb.group({\n      connection: ['', Validators.required],\n      bucket: ['', Validators.required],\n      fileExtension: ['', Validators.required],\n      bucketFolderPath: [''],\n    });\n    this.sftpForm = this._fb.group({\n      connection: ['', this.dialogData.data ? Validators.nullValidator : Validators.required],\n      fileExtension: ['', this.dialogData.data ? Validators.nullValidator : Validators.required],\n      folderpath: ['', this.dialogData.data ? Validators.nullValidator : Validators.required],\n    });\n    this.urlForm = this._fb.group({\n      filetype: ['', this.dialogData.data ? Validators.nullValidator : Validators.required],\n      url: [\n        '',\n        this.dialogData.data\n          ? Validators.nullValidator\n          : [Validators.required, CustomValidators.url],\n      ],\n    });\n  }\n\n  /**\n   * Initial settings for this page\n   */\n  async ngOnInit(): Promise<any> {\n    this.dynamicForm = this._fb.group({\n      connectionName: ['', [Validators.required, Validators.pattern('^[^\\\\s][A-Za-z0-9_\\\\- ]+$')]],\n      dataGroupId: ['', Validators.required],\n      dataGroupName: ['', Validators.nullValidator],\n      parent_id: ['', Validators.nullValidator],\n      scheduleId: [''],\n      sftpGroup: this.sourceType === 'sftp' ? this.sftpForm : '',\n      urlGroup: this.sourceType === 'url' ? this.urlForm : '',\n      s3Group: this.sourceType === 's3' ? this.s3Form : '',\n    });\n\n    this.project = this._localStorage.getItem('project');\n    if (this.sourceType === 's3') {\n      this.s3Conns = await this._connection\n        .getConnectionsList(this.sourceType)\n        .pipe(takeUntil(this.unsubscribe$))\n        .toPromise();\n    } else if (this.sourceType === 'sftp') {\n      this.sftpConns = await this._connection\n        .getSftpConnectionList()\n        .pipe(takeUntil(this.unsubscribe$))\n        .toPromise();\n    }\n\n    /** Prefills the connection form as per the operation - edit/create */\n    this.prefillConnectionForm(this.dialogData.data);\n    this.dataSource.data = [{ label: '/' }];\n    this.nodes = [\n      {\n        expanded: true,\n        label: '/',\n      },\n    ];\n  }\n\n  previousTree() {\n    // console.log(\"m here**************************\", this.selectedPath);\n    var getPath = this.selectedPath;\n    let lastword, src, finalRec, m;\n    src = getPath.replace('//', '/');\n    lastword = src.lastIndexOf('/');\n    //  console.log(\"************************\", lastword);\n    m = src.substring(lastword + 1);\n    if (lastword === -1) {\n      finalRec = undefined;\n      this.selectedPath = '';\n    } else {\n      finalRec = src.replace('/' + m, '');\n      this.selectedPath = finalRec;\n      finalRec = finalRec.replace('//', '/');\n    }\n    // console.log(\"m finalrec*************************\", finalRec);\n    const conn = this.sftpConns.filter(\n      (item) => item.name === this.sftpForm.get('connection').value.name\n    )[0];\n    this.getSFTPFolders(conn._id, finalRec);\n  }\n  /**\n   * Prefill the connection form for edit/create functionality\n   * @param connectionData selected connectio details\n   */\n  prefillConnectionForm(connectionData: any): void {\n    if (connectionData) {\n      this.isEdit = true;\n      this.dynamicForm.get('dataGroupId').clearValidators();\n      this.dynamicForm.get('dataGroupId').updateValueAndValidity();\n      this.connectionIdToUpdate = connectionData._id;\n      this._data.getSingleDataConnection(this.project._id, connectionData._id).subscribe(\n        (res: any) => {\n          if (res) {\n            if (res.source === 'sftp') {\n              this.sftpDetails = res;\n            } else if (res.source === 'url') {\n              this.urlDetails = res;\n            } else if (res.source === 's3') {\n              this.s3Details = res;\n            }\n            this.s3BucketsArray.push(res.bucket);\n            this.dynamicForm.patchValue({\n              connectionName: res.connectionName,\n              scheduleId: res.scheduleId || 'None',\n              sftpGroup: {\n                connection:\n                  this.sourceType === 'sftp'\n                    ? this.sftpConns.filter((item) => item._id === res.sftpConnectionId)[0]\n                    : null,\n                fileExtension: res.fileExtension || res.fileExtension,\n                folderpath: res.folderPath,\n              },\n              urlGroup: { url: res.url },\n              s3Group: {\n                connection:\n                  this.sourceType === 's3'\n                    ? this.s3Conns?.filter((item) => item._id === res.s3ConnectionId)[0]\n                    : null,\n                fileExtension: res.fileExtension,\n                bucketFolderPath: res.bucketFolderPath,\n                bucket: res.bucket,\n              },\n            });\n            this.dynamicForm.updateValueAndValidity();\n            this.dataFormat = res.dataFormat;\n          }\n        },\n        (err: Error) => {\n          this._toaster.error('Server Error', 'Data Connection');\n        }\n      );\n    } else {\n      // this.dynamicForm.reset();\n      this.dynamicForm.get('dataGroupId').setValue(this.currentDataGroup);\n      this.isEdit = false;\n    }\n  }\n\n  /**\n   * Called when the folder(data group) selection is changed\n   * @param event\n   */\n  folderChangedHandler(event: any): void {\n    this.selectedFolder = event.value;\n    if (this.selectedFolder === 'Add') {\n      this.dynamicForm.get('dataGroupName').setValidators(Validators.required);\n      this.dynamicForm.get('parent_id').setValidators(Validators.required);\n      this.dynamicForm.get('dataGroupName').updateValueAndValidity();\n      this.dynamicForm.get('parent_id').updateValueAndValidity();\n    } else {\n      this.dynamicForm.get('dataGroupName').clearValidators();\n      this.dynamicForm.get('parent_id').clearValidators();\n      this.dynamicForm.get('dataGroupName').updateValueAndValidity();\n      this.dynamicForm.get('parent_id').updateValueAndValidity();\n    }\n  }\n\n  /**\n   *\n   * @param $event\n   */\n  connectionChanged(event: any): void {\n    if (this.sourceType === 's3') {\n      this._spinner.showSpinner();\n      this.getS3Buckets(event);\n    } else {\n      this.getSFTPFolders(event.value._id);\n    }\n  }\n\n  /**\n   * Fetches the selected s3 connection buckets list\n   */\n  getS3Buckets(event: any): void {\n    this._data\n      .getS3BucketsList(event.value._id)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(\n        (res: any) => {\n          this._spinner.stopSpinner();\n          if (isArray(res.buckets)) {\n            this.s3BucketsArray = res.buckets;\n          } else {\n            this._toaster.error(res.buckets || 'Cannot fetch S3 buckets list', 'Data Connection');\n          }\n        },\n        (e: any) => {\n          this._spinner.stopSpinner();\n          this._toaster.error(e.error.message || 'Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Fetches the selected sftp connection folder details (tree)\n   */\n  getSFTPFolders(conId: any, folderName?: string): void {\n    // if (folderName == undefined) {\n    //   console.log(folderName);\n    //   this.nodesArray?.push('/');\n    // }\n    //  console.log(this.nodesArray, folderName);\n    if (!folderName) {\n      this.dataSource.data = [{ label: 'Fetching details from remote server...' }];\n    }\n    this._spinner.showSpinner();\n    this.sftpId = conId;\n    this.dataConnection$ = this._data.getSftpFolderDetails(conId, folderName || 'first').subscribe(\n      (res: any) => {\n        if (res.length) {\n          this.nodes = res;\n          // console.log(this.nodes, folderName);\n          if (folderName !== undefined && folderName !== '') {\n            //   this.dataSource.data.pop();\n            //   this.dataSource.data = res;\n            // } else {\n            // this.nodes[0].map((i: any) => {\n            let label = [];\n            label = folderName.split('/');\n            //  console.log(\"***********************\", label, res[0].label);\n            // if (i.label === res[0].label) {\n            //   i.children = res[0].children;\n            // }\n            this.nodes[0].label = label.slice().pop();\n            // return i;\n            // });\n          }\n          // this.nodes = this.dataSource.data;\n          // this.refreshTreeData();\n          this._spinner.stopSpinner();\n        } else {\n          this._toaster.error('Cannot fetch SFTP folders structure', 'Data Connection');\n          this._spinner.stopSpinner();\n        }\n      },\n      (e: any) => {\n        this.dataSource.data = [{ label: 'Cannot fetch details from remote server' }];\n        this._spinner.stopSpinner();\n        this._toaster.error(e.error.message || 'Server Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Refresh the tree structure to render updated values\n   */\n  refreshTreeData(): void {\n    const data = this.dataSource.data;\n    this.dataSource.data = [];\n    this.dataSource.data = data;\n  }\n\n  /**\n   * Handles the click event on tree nodes and binds the base path, with selected folder name\n   * @param node selected node\n   */\n  treeHandler(node: any): any {\n    this.nodesArray?.push(node.data.label);\n    // console.log(this.nodesArray);\n    this.selectedPath = this.nodesArray.toString().split(',').join('/');\n    const conn = this.sftpConns.filter(\n      (item) => item.name === this.sftpForm.get('connection').value.name\n    )[0];\n    // console.log(this.selectedPath);\n    this.getSFTPFolders(conn._id, this.selectedPath);\n    this.sftpForm.get('folderpath').setValue(this.selectedPath);\n  }\n\n  resetTreeNode() {\n    const conn = this.sftpConns.filter(\n      (item) => item.name === this.sftpForm.get('connection').value.name\n    )[0];\n    // console.log(this.selectedPath);\n    this.getSFTPFolders(conn._id, this.selectedPath);\n  }\n  /** Checks and return true if parent has child nodes */\n  hasChild = (_: number, node: any) => !!node.children && node.children.length > 0;\n\n  /**\n   * Displays the previous node in folder tree structure\n   */\n  showPreviousNode() {\n    // let getPath = this.selectedPath;\n    // let lastword: any;\n    // let src: any;\n    // let finalRec: any;\n    // let m: any;\n    // src = getPath.replace(\"//\", \"/\");\n    // lastword = src.lastIndexOf(\"/\");\n    // m = src.substring(lastword + 1);\n    // if (lastword == 0) {\n    //   finalRec = \"first\";\n    //   this.selectedPath = \"/\";\n    // } else {\n    //   finalRec = src.replace(\"/\" + m, \"\");\n    //   this.selectedPath = finalRec;\n    //   finalRec = finalRec.replace(\"//\", \"/\");\n    // }\n    // this.dataConnection$ = this._data.getSftpFolderDetails(this.sftpId, finalRec).subscribe((res: any) => {\n    //   if (res) {\n    //     this.dataSource.data = res;\n    //   }\n    // }, (err: Error) => {\n    //   this._toaster.error('Server Error', 'Data Connection');\n    // });\n  }\n\n  /**\n   * Navigates to the data source type selection page\n   */\n  goBack(): void {\n    this.goBackFlag.emit(true);\n  }\n\n  /**\n   * Handles the connection type whether DB or SFTP connection\n   * @param formValue connection details\n   */\n  onSubmitConnection(formValue: any): void {\n    this._spinner.showSpinner();\n    if (this.isEdit) {\n      this.updateConnectionHandler(formValue);\n    } else {\n      this.createConnectionHandler(formValue);\n    }\n  }\n\n  /**\n   * Handles the update connection form as per the type - url/sftp\n   * @param formData\n   */\n  updateConnectionHandler(formData: any): void {\n    if (this.sftpDetails) {\n      this.updateSftpConnection(formData);\n    } else if (this.urlDetails) {\n      this.updateUrlConnection(formData);\n    } else if (this.s3Details) {\n      this.updateS3Connection(formData);\n    }\n  }\n\n  /**\n   * Updates the URL data in DB\n   * @param formData\n   */\n  updateUrlConnection(formData: any): void {\n    this.urlDetails.connectionName = formData.connectionName;\n    this.urlDetails.url = formData.urlGroup.url;\n    this.urlDetails.dataFormat = this.dataFormat;\n    this.urlDetails.projectId = this.project._id;\n\n    /** Logic to update schedulars when we edit */\n    if (formData.scheduleId == 'None') {\n      this.urlDetails.statusData = 'None';\n    }\n    if (this.dataschedule === undefined) {\n      this.urlDetails.scheduledata = 'noupdate';\n    } else {\n      this.urlDetails.scheduledata = this.dataschedule;\n    }\n    this.urlDetails.scheduleId\n      ? (this.urlDetails.oldScheduleId = this.urlDetails.scheduleId)\n      : null;\n    formData.scheduleId ? (this.urlDetails.scheduleId = formData.scheduleId) : null;\n\n    this._data\n      .updateDataConnection(this.project._id, this.urlDetails._id, this.urlDetails)\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.closeModal(res);\n            this._toaster.success(\n              `${this.urlDetails.source.toUpperCase()} connection updated successfully`,\n              'Data Connection'\n            );\n          }\n        },\n        (err: Error) => {\n          this._toaster.success('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Updates the SFTP connection details in DB\n   * @param formData\n   */\n  updateSftpConnection(formData: any): void {\n    this.sftpDetails.connectionName = formData.connectionName;\n    this.sftpDetails.folderPath = formData.sftpGroup.folderpath;\n    this.sftpDetails.fileExtension = formData.sftpGroup.fileExtension;\n    this.sftpDetails.projectId = this.project._id;\n\n    /** Logic to update schedulars when we edit */\n    if (formData.scheduleId == 'None') {\n      this.sftpDetails.statusData = 'None';\n    }\n    if (this.dataschedule === undefined) {\n      this.sftpDetails.scheduledata = 'noupdate';\n    } else {\n      this.sftpDetails.scheduledata = this.dataschedule;\n    }\n    this.sftpDetails.scheduleId\n      ? (this.sftpDetails.oldScheduleId = this.sftpDetails.scheduleId)\n      : null;\n    formData.scheduleId ? (this.sftpDetails.scheduleId = formData.scheduleId) : null;\n\n    this._data\n      .updateDataConnection(this.project._id, this.sftpDetails._id, this.sftpDetails)\n      .subscribe(\n        (res: any) => {\n          if (res) {\n            this.closeModal(res);\n            this._toaster.success(\n              `${this.sftpDetails.source.toUpperCase()} connection updated successfully`,\n              'Data Connection'\n            );\n          }\n        },\n        (err: Error) => {\n          this._toaster.success('Server Error', 'Data Connection');\n        }\n      );\n  }\n\n  /**\n   * Updates the S3 connection details in DB\n   * @param formData\n   */\n  updateS3Connection(formData: any): void {\n    this.s3Details.connectionName = formData.connectionName;\n    this.s3Details.fileExtension = formData.s3Group.fileExtension;\n    this.s3Details.projectId = this.project._id;\n    this.s3Details.s3ConnectionId = this.s3Conns?.filter(\n      (item) => item._id === formData.s3Group.connection._id\n    )[0]._id;\n    this.s3Details.bucket = formData.s3Group.bucket;\n    this.s3Details.bucketFolderPath = formData.s3Group.bucketFolderPath;\n\n    /** Logic to update schedulars when we edit */\n    if (formData.scheduleId == 'None') {\n      this.s3Details.statusData = 'None';\n    }\n    if (this.dataschedule === undefined) {\n      this.s3Details.scheduledata = 'noupdate';\n    } else {\n      this.s3Details.scheduledata = this.dataschedule;\n    }\n    this.s3Details.scheduleId ? (this.s3Details.oldScheduleId = this.s3Details.scheduleId) : null;\n    formData.scheduleId ? (this.s3Details.scheduleId = formData.scheduleId) : null;\n\n    this._data.updateDataConnection(this.project._id, this.s3Details._id, this.s3Details).subscribe(\n      (res: any) => {\n        if (res) {\n          this.closeModal(res);\n          this._toaster.success(\n            `${this.s3Details.source.toUpperCase()} connection updated successfully`,\n            'Data Connection'\n          );\n        }\n      },\n      (err: Error) => {\n        this._toaster.success('Server Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Pulls the data from the sftp connection\n   */\n  createConnectionHandler(formData: any): void {\n    let reqObj: any;\n    formData.scheduleId ? formData.scheduleId : delete formData.scheduleId;\n    formData.dataGroupName ? formData.dataGroupName : delete formData.dataGroupName;\n    formData.parent_id ? formData.parent_id : delete formData.parent_id;\n\n    /** Generates dynamic request data as per the source type */\n    if (this.sourceType === 'sftp') {\n      reqObj = {\n        ...formData,\n        ...formData.sftpGroup,\n        source: this.sourceType,\n        isPulling: this.isPulling,\n      };\n    } else if (this.sourceType === 'url') {\n      reqObj = {\n        ...formData,\n        ...formData.urlGroup,\n        source: this.sourceType,\n        dataFormat: this.dataFormat,\n        isPulling: this.isPulling,\n      };\n    } else if (this.sourceType === 's3') {\n      reqObj = {\n        ...formData,\n        ...formData.s3Group,\n        source: this.sourceType,\n        isPulling: this.isPulling,\n      };\n    }\n    delete reqObj.sftpGroup;\n    delete reqObj.urlGroup;\n    delete reqObj.s3Group;\n    this._data.pullData(this.project._id, reqObj).subscribe(\n      (res: any) => {\n        if (res) {\n          this.closeModal(res);\n          this.isPulling\n            ? this._utils.showSnackBar(toasterMsg.pullData)\n            : this._toaster.success(\n                `${this.sourceType.toUpperCase()} connection created successfully`,\n                'Data Connection'\n              );\n        }\n        this._spinner.stopSpinner();\n      },\n      (err: Error) => {\n        this._spinner.stopSpinner();\n        this._toaster.error('Server Error', 'Data Connection');\n      }\n    );\n  }\n\n  /**\n   * Calls whenever the schedular is changed\n   * @param event\n   */\n  schedularChanged(scheduleId: any): void {\n    switch (this.sourceType) {\n      case 'sftp':\n        this.mapSchedular(this.sftpDetails, scheduleId);\n        break;\n      case 'url':\n        this.mapSchedular(this.urlDetails, scheduleId);\n        break;\n      case 's3':\n        this.mapSchedular(this.s3Details, scheduleId);\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Maps the scheduler related data\n   * @param data Selected connection details (SFTP/S3/URL)\n   * @param scheduleId\n   */\n  mapSchedular(data: any, scheduleId: string): void {\n    if (data.scheduleId === undefined) {\n      this.dataschedule = 'new';\n    } else if (data.scheduleId !== scheduleId) {\n      this.dataschedule = 'update';\n    } else {\n      this.dataschedule = 'noupdate';\n    }\n  }\n\n  /**\n   * Fetches algorithms list from DB\n   */\n  fetchAlgorithmsList(): Promise<any> {\n    return this._connection.getSftpConnectionList().pipe(takeUntil(this.unsubscribe$)).toPromise();\n  }\n\n  /**\n   * Navigates the user to the schedular page to create new\n   */\n  navigateToScheduler() {\n    this.closeModal();\n    this._spinner.stopSpinner();\n    this._router.navigateByUrl('/dashboard/scheduler?type=scheduler');\n  }\n\n  /**\n   * Closes the opened modal by sending the data or without data\n   */\n  closeModal(data?: any): void {\n    this._connectionDialogRef.close(data);\n  }\n\n  /**\n   * Unsubscribes the subscriptions, only if they were subscribed\n   */\n  ngOnDestroy() {\n    this.unsubscribe$.next(false);\n    this.unsubscribe$.unsubscribe();\n    if (this.connection$) {\n      this.connection$.unsubscribe();\n    }\n    if (this.dataConnection$) {\n      this.dataConnection$.unsubscribe();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DataConnectionComponent } from './data-connection/data-connection.component';\nimport { RouterModule, Routes } from '@angular/router';\nimport { DataSetComponent } from './data-set/data-set.component';\nimport { DataFlowComponent } from './data-flow/data-flow.component';\nimport { SharedModule } from 'src/app/shared/shared.module';\nimport { DialogHandlerComponent } from './data-connection/dialog-handler/dialog-handler.component';\nimport { FileUploadFormComponent } from './data-connection/file-upload-form/file-upload-form.component';\nimport { DatabaseFormComponent } from './data-connection/database-form/database-form.component';\nimport { SftpAndUrlFormComponent } from './data-connection/sftp-and-url-form/sftp-and-url-form.component';\nimport { DataSetDialogComponent } from './data-set/data-set-dialog/data-set-dialog.component';\nimport { DataFlowStepperComponent } from './data-flow/data-flow-stepper/data-flow-stepper.component';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { AgGridModule } from 'ag-grid-angular';\nimport { GraphsDialogHandlerComponent } from '../models/graphs-dialog-handler/graphs-dialog-handler.component';\nimport { TreeModule } from '@circlon/angular-tree-component';\n\nconst routes: Routes = [\n  {\n    path: 'dataconnection',\n    component: DataConnectionComponent,\n  },\n  {\n    path: 'dataset',\n    component: DataSetComponent,\n  },\n  {\n    path: 'dataflow',\n    component: DataFlowComponent,\n  },\n];\n\n@NgModule({\n  declarations: [DataConnectionComponent, DataSetComponent, DataFlowComponent, DialogHandlerComponent, FileUploadFormComponent, DatabaseFormComponent, SftpAndUrlFormComponent, DataSetDialogComponent, DataFlowStepperComponent],\n  imports: [\n    CommonModule,\n    AgGridModule.withComponents([GraphsDialogHandlerComponent]),\n    RouterModule.forChild(routes),\n    TreeModule,\n    SharedModule,\n    MatBadgeModule\n  ]\n})\nexport class DataModule { }\n"]}